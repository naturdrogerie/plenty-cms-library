{"version":3,"file":"plentymarketsCMStools-1.0.18.min.js","sources":["plentymarketsCMStools-1.0.18.js"],"names":["TemplateCache","global","factory","exports","nodeName","define","amd","Mustache","this","mustache","isFunction","object","typeStr","obj","isArray","escapeRegExp","string","replace","hasProperty","propName","testRegExp","re","regExpTest","call","isWhitespace","nonSpaceRe","escapeHtml","String","s","entityMap","parseTemplate","template","tags","stripSpace","hasTag","nonSpace","spaces","length","tokens","pop","compileTags","tagsToCompile","split","spaceRe","Error","openingTagRe","RegExp","closingTagRe","closingCurlyRe","sections","start","type","value","chr","token","openSection","scanner","Scanner","eos","pos","scanUntil","i","valueLength","charAt","push","scan","tagRe","whiteRe","equalsRe","curlyRe","nestTokens","squashTokens","lastToken","squashedTokens","numTokens","section","nestedTokens","collector","tail","Context","view","parentContext","cache",".","parent","Writer","objectToString","Object","prototype","toString","Array","test","&","<",">","\"","'","/","match","index","substring","search","lookup","name","hasOwnProperty","names","context","lookupHit","indexOf","clearCache","parse","render","partials","renderTokens","originalTemplate","symbol","buffer","undefined","renderSection","renderInverted","renderPartial","unescapedValue","escapedValue","rawValue","subRender","self","j","slice","escape","version","defaultWriter","TypeError","to_html","send","result","$","bindEventCallback","$elem","eventType","callback","params","on","event","eventStack","apply","document","readyState","addCustomEvents","element","is","trigger","radioGroup","attr","each","radio","$radio","parseDirectives","input","thisValue","directivePattern","expressions","directives","expression","trim","console","error","directive","class","method","param","isNaN","parseFloat","toLowerCase","compileComponent","component","componentLevel","dependencyStack","compiledDependencies","dependencies","dependency","inArray","components","factories","PlentyFramework","services","join","setup","instance","getInstance","compare","localVersion","compareVersion","parseInt","get","equals","v","globals","setGlobal","identifier","getGlobal","fallbackValue","directiveName","directiveFunctions","bindDirectives","rootElement","find","getRecentEvent","lastEventIdx","pushEvent","service","serviceName","serviceFunctions","factoryName","factoryFunctions","compileTemplate","data","translate","text","scriptPath","Strings","loadLanguageFile","fileName","ajax","url","dataType","done","response","localeString","warn","compile","first","scripts","getElementsByTagName","path","src","jQuery","pm","AuthenticationService","login","elem","preventDefault","customerLogin","BasketService","addBasketItem","basketItemsList","scheduler","parentForm","parents","$p_id","SchedulerInterval","val","SchedulerRepeating","SchedulerDate","BasketItemItemID","BasketItemPriceID","BasketItemQuantity","BasketItemBranchID","attributeInputsList","attributesList","idx","BasketItemAttributeID","BasketItemAttributeValueID","BasketItemAttributesList","setScheduler","addItem","changeItemQuantity","increment","$quantityInput","maxLength","setItemQuantityToNewValue","updateItemQuantity","convertToFloat","setItemQuantity","basketItemID","fail","basketItem","getItem","quantityInput","isBasketView","timeout","window","clearTimeout","setTimeout","n","isFinite","CheckoutService","setMethodOfPayment","paymentID","confirmAtrigaPaymax","atrigaPaymaxConfirmed","MediaSize","initDropdowns","resetDropdowns","dropdownElements","closableDropdownElements","dropdownList","$current","target","removeClass","unbind","resetEvent","openDropdown","alwaysClickable","$parent","isInterval","Modernizr","touch","showDropdownHideOthers","avoidRedirectinStopPropagation","not","addClass","off","e","stopPropagation","slideDropdown","$elemParent","siblings","slideToggle","removeAttr","MediaSizeService","NavigatorService","to","href","interval","location","assign","toCheckoutTab","tabID","goToID","showTab","tabSelector","tab","initRemoteLabel","groupID","tabGroups","TabGroup","getTab","addTab","addLabel","initRemoteTab","setContent","showRemoteTab","tabs","Tab","zIndex","activeTab","getContent","css","hide","currentZ","show","resetTabs","id","getID","label","$labels","content","$content","SocialShareService","UIFactory","initUIWindowEvents","fireEqualHeight","toTopButtonList","scrollTop","doToArrayElements","showWaitscreen","hideWaitscreen","forceClose","addContentPageSlider","owlCarousel","navigation","navigationText","slideSpeed","paginationSpeed","singleItem","autoPlay","stopOnHover","afterMove","current","equalHeight","mediaSizes","elementExists","maxHeight","$equalTarget","$equalTargetList","children","equalHeightElementList","outerHeight","height","initToTop","click","animate","initLazyload","effect","lazyload","toggleHideShow","log","initSlideToggle","checked","$targetElement","$radioGroupList","visibleOnChecked","change","$self","slideDown","slideUp","toggleClass","duration","slideAction","$target","callbackString","toggleSocialShare","socialShareService","$toggle","append","hasClass","tooltip","getSocialService","cssClass","array","func","ValidationService","validate","form","errorClass","UI","Modal","renewLoginSession","sessionExpirationTimeout","prepare","setTitle","setLabelDismiss","setLabelConfirm","onConfirm","onDismiss","handleError","jqXHR","responseText","parseJSON","printErrors","error_stack","throwError","status","statusText","_get","ignoreErrors","runInBackground","sync","showWaitScreen","async","always","hideWaitScreen","_post","isFile","processData","contentType","JSON","stringify","_put","_delete","_idle","Deferred","resolve","ready","post","put","delete","idle","API","getContainer","containerName","from","layoutGroup","getParams","getCategoryContent","categoryID","CMS","Checkout","checkoutData","getCheckout","copy","checkout","loadCheckout","extend","setCheckout","reloadContainer","container","html","reloadCatContent","catId","reloadItemContainer","isModal","selector","title","modal","setClass","setStatic","isStatic","backdrop","keyboard","labelConfirm","labelDismiss","setContainer","bsModal","getModal","uid","Math","random","substr","filter","script","createElement","innerHTML","init","close","startTimeout","confirmed","timeRemaining","timeStart","Date","getTime","clearInterval","setInterval","paused","secondsRemaining","round","pauseTimeout","continueTimeout","stopTimeout","code","msg","message","errorMessages","errorContainer","has","errorPopup","key","addError","waitScreenCount","waitScreen","WaitScreen","a","b","constructor","cssClasses","active","popup","hideAll","errorCode","hover","foundation","root","validateAddress","addressForms","addressIsValid","addressDoctor","AddressDoctor","requiredFields","isValid","fields","isPackstation","suggestions","AddressList","$form","getFormValues","refreshView","getAddresses","remove","suggestionListVisible","validateInput","houseNoAllowed","$inputs","HouseNo","valueList","getList","$suggestionContainer","buildSuggestionList","focus","positionSuggestionList","suggestionKey","width","outerWidth","left","position","top","values","filterAddress","Street","toUpperCase","ZIP","City","addressInput","suggestionType","street","city","houseNo","country","CountryID","responseLength","currentResponse","address","getAddress","addresses","suggestion","addressCount","results","filteredAddresses","range","resetPassword","validateForm","Email","IsMailSend","loginMail","Password","loginPassword","setInvoiceAddress","invoiceAddress","CustomerInvoiceAddress","registerCustomer","AddressDoctorService","customProp","LoginType","customerInvoiceAddress","CustomerProperty","tmpProperties","CustomerPropertiesList","property","PropertyID","PropertyValue","$tmpEl","article","addArticle","saveOrderParams","itemID","quantity","resp","articleWithParams","getValues","el","attrType","addOrderParamValue","files","orderParamFileUpload","paramValue","orderParamsForm","$artAttr","$unitCombinationId","requestData","ArticleID","refreshBasketPreview","updateArticle","$input","formData","fileData","orderParamUploadFiles","orderParamFileIdStack","FormData","basketList","paramId","BasketItemOrderParamsList","BasketItemOrderParamID","BasketItemOrderParamValue","editItemAttributes","BasketItemID","getBasketItem","attributeSelect","editOrderParams","basketItems","BasketItemsList","removeBasketItem","forceDelete","doDelete","$oldBasketList","$basketListContainer","fadeOut","prepend","fadeIn","deferred","itemName","BasketItemNameMap","item","reject","basketItemIndex","itemQuantityTotal","Totals","TotalsItemSum","addCoupon","couponInput","CouponActiveCouponCode","updateContainer","removeCoupon","Coupon","removeItem","setCustomerSignAndInfo","CheckoutCustomerSign","CheckoutOrderInfoText","CustomerSign","OrderInfoText","saveShippingAddress","shippingAddressID","shippingAddress","addressesAreEqual","CustomerShippingAddress","IsPackstation","PackstationNo","IsPostfiliale","PostfilialNo","CheckoutCustomerShippingAddressID","ID","CheckoutShippingCountryID","updatePaymentAndShippingDependencies","CheckoutMethodOfPaymentID","CheckoutShippingProfileID","registerGuest","address1","address2","setShippingProfile","ShippingProfileID","preparePayment","paymentData","CheckoutMethodOfPaymentRedirectURL","CheckoutMethodOfPaymentAdditionalContent","isBankDetails","saveBankDetails","saveCreditCard","errorStack","$ts","TrustedShopsBuyerProtectionItem","TrustedShopsBuyerProtectionItemIsSelected","CheckoutAtrigapaymaxChecked","atrigaPaymaxChecked","editBankDetails","customerBankDetails","bankDetails","CustomerBankName","bankName","CustomerBLZ","blz","CustomerAccountNumber","accountNo","CustomerAccountOwner","accountOwner","CustomerIBAN","iban","CustomerBIC","bic","editCreditCard","paymentInformationCC","creditCard","Owner","owner","Cvv2","cvv2","Number","number","Year","year","Month","month","Provider","provider","loadAddressSuggestion","postnummer","Postnummer","placeOrder","TermsAndConditionsCheck","termsAndConditionsCheck","WithdrawalCheck","withdrawalCheck","PrivacyPolicyCheck","privacyPolicyCheck","AgeRestrictionCheck","ageRestrictionCheck","NewsletterCheck","newsletterCheck","KlarnaTermsAndConditionsCheck","klarnaTermsAndConditionsCheck","PayoneDirectDebitMandateCheck","payoneDirectDebitMandateCheck","PayoneInvoiceCheck","payoneInvoiceCheck","MethodOfPaymentRedirectURL","MethodOfPaymentAdditionalContent","confirmLabel","paymentIdsToHandle","MethodOfPaymentID","getFeedbacks","setFeedbackInterval","end","feedbackInterval","dateStart","dateEnd","listFeedbacks","articleType","referenceId","feedbackType","ReferenceId","FromDate","ToDate","FeedbackType","feedbackTypes","COMMENTS_AND_RATINGS","between","for","addFeedback","withRating","rating","Rating","withComment","comment","Text","withAuthor","author","mail","customerID","Author","CustomerId","sendFeedback","COMMENTS_ONLY","RATINGS_ONLY","articleTypes","ITEM","CATEGORY","BLOG","ArticleTypes","FeedbackTypes","getInterval","bsInterval","calculateMediaSize","size","matchMedia","matches","oldValue","intervalList","resize","buttonNext","buttonPrev","goTo","next","previous","addEventListener","hash","urlParam","exec","fillNavigation","getCurrentContainer","beforeChange","interceptor","interceptors","afterChange","resolveInterceptors","continueTabChange","currentContainer","targetContainer","ignoreInterceptors","contentChanged","checkoutStates","proceedTabChange","continueChange","containerID","openPostfinderModal","shippingFields","PostfinderItemStreet","PostfinderItemZIP","PostfinderItemCity","PostfinderItemHouseNo","zip","numberOfResults","showErrorMessage","dimension","distInMeters","PostfinderItemDistance","distInKilometers","toFixed","PostfinderItemIsPackstation","PostfinderItemPackstationNo","PostfinderItemPostfilialNo","district","PostfinderItemDistrict","distance","remark","PostfinderItemRemark","packstationID","inputId","closest","getService","facebook-like","socialLangLocale","encodeURIComponent","getURI","facebook-recommend","twitter","getTweetText","google-plus","socialLang","uri","canonical","protocol","host","getMeta","metaContent","creator","getFormControl","validateText","formControl","prop","validateMail","mailRegExp","validateNumber","isNumeric","compareValues","reference","caseSensitive","isNotVisibleOrEnabled","$formControl","formControls","validationKey","currentHasError","group","checkedMin","checkedMax","attrValidate","validationKeys","formControlAttrType","missingFields","hasError","minMax","Function","min","max","distanceTop","$error","errorOffset","offset","$scrollTarget","pageYOffset","innerHeight","$errorElement","fn","inject","child","exp","groupValues","checkbox","plenty"],"mappings":";;;;;;;;;;AAAA,GAAIA,iBAEJA,eAAc,yCAA2C,gMAUzDA,cAAc,sCAAwC,0oBA0BtDA,cAAc,2BAA6B,kMAM3CA,cAAc,yBAA2B,uPAOzCA,cAAc,oBAAsB,2oBAiBpCA,cAAc,8BAAgC,iEAE9C,SAAyBC,EAAOC,GAA6B,gBAAVC,UAAoBA,SAAmC,gBAAnBA,SAAQC,SAAqBF,EAAQC,SAAiC,kBAATE,SAAqBA,OAAOC,IAAKD,QAAQ,WAAWH,IAAcD,EAAOM,YAAYL,EAAQK,YAAaC,KAAK,SAAyBC,GAA0K,QAASC,GAAWC,GAAQ,MAAuB,kBAATA,GAAoB,QAASC,GAAQC,GAAK,MAAOC,GAAQD,GAAK,cAAeA,GAAI,QAASE,GAAaC,GAAQ,MAAOA,GAAOC,QAAQ,8BAA8B,QAAQ,QAASC,GAAYL,EAAIM,GAAU,MAAY,OAALN,GAAwB,gBAANA,IAAgBM,IAAYN,GAAyC,QAASO,GAAWC,EAAGL,GAAQ,MAAOM,GAAWC,KAAKF,EAAGL,GAA4B,QAASQ,GAAaR,GAAQ,OAAOI,EAAWK,EAAWT,GAAgG,QAASU,GAAWV,GAAQ,MAAOW,QAAOX,GAAQC,QAAQ,aAAa,SAAuBW,GAAG,MAAOC,GAAUD,KAAgH,QAASE,GAAcC,EAASC,GAA4G,QAASC,KAAa,GAAGC,IAASC,EAAU,KAAMC,EAAOC,cAAcC,GAAOF,EAAOG,WAAYH,KAAUF,IAAO,EAAMC,GAAS,EAAmD,QAASK,GAAYC,GAA+F,GAAtD,gBAAhBA,KAAyBA,EAAcA,EAAcC,MAAMC,EAAQ,KAAO7B,EAAQ2B,IAAuC,IAAvBA,EAAcJ,OAAW,KAAM,IAAIO,OAAM,iBAAiBH,EAAeI,GAAa,GAAIC,QAAO/B,EAAa0B,EAAc,IAAI,QAAQM,EAAa,GAAID,QAAO,OAAO/B,EAAa0B,EAAc,KAAKO,EAAe,GAAIF,QAAO,OAAO/B,EAAa,IAAI0B,EAAc,KAAjrB,IAAIV,EAAS,QAAS,IAA2Nc,GAAaE,EAAaC,EAAjPC,KAAgBX,KAAcF,KAAcF,GAAO,EAAUC,GAAS,CAAslBK,GAAYR,GAAMvB,EAASuB,KAAmF,KAA7E,GAAsCkB,GAAMC,EAAKC,EAAMC,EAAIC,EAAMC,EAA7DC,EAAQ,GAAIC,GAAQ1B,IAA4DyB,EAAQE,OAAM,CAAyD,GAAxDR,EAAMM,EAAQG,IAAIP,EAAMI,EAAQI,UAAUf,GAAwB,IAAI,GAAIgB,GAAE,EAAEC,EAAYV,EAAMf,OAASyB,EAAFD,IAAgBA,EAAGR,EAAID,EAAMW,OAAOF,GAAMrC,EAAa6B,GAAMjB,EAAO4B,KAAK1B,EAAOD,QAAaF,GAAS,EAAKG,EAAO0B,MAAM,OAAOX,EAAIH,EAAMA,EAAM,IAAIA,GAAO,EAAW,OAANG,GAAWpB,GAAc,KAAIuB,EAAQS,KAAKpB,GAAc,KAAuV,IAAjVX,GAAO,EAAKiB,EAAKK,EAAQS,KAAKC,IAAQ,OAAOV,EAAQS,KAAKE,GAAmB,MAAPhB,GAAYC,EAAMI,EAAQI,UAAUQ,GAAUZ,EAAQS,KAAKG,GAAUZ,EAAQI,UAAUb,IAA6B,MAAPI,GAAYC,EAAMI,EAAQI,UAAUZ,GAAgBQ,EAAQS,KAAKI,GAASb,EAAQI,UAAUb,GAAcI,EAAK,KAASC,EAAMI,EAAQI,UAAUb,IAAkBS,EAAQS,KAAKlB,GAAc,KAAM,IAAIH,OAAM,mBAAmBY,EAAQG,IAA6D,IAAxDL,GAAOH,EAAKC,EAAMF,EAAMM,EAAQG,KAAKrB,EAAO0B,KAAKV,GAAiB,MAAPH,GAAmB,MAAPA,EAAYF,EAASe,KAAKV,OAAY,IAAU,MAAPH,EAAW,CAA4B,GAA3BI,EAAYN,EAASV,OAAUgB,EAAY,KAAM,IAAIX,OAAM,qBAAqBQ,EAAM,QAAQF,EAAO,IAAGK,EAAY,KAAKH,EAAM,KAAM,IAAIR,OAAM,qBAAqBW,EAAY,GAAG,QAAQL,OAAsB,SAAPC,GAAsB,MAAPA,GAAmB,MAAPA,EAAYhB,GAAS,EAAoB,MAAPgB,GAAYX,EAAYY,GAAmC,GAA3BG,EAAYN,EAASV,MAAqB,KAAM,IAAIK,OAAM,qBAAqBW,EAAY,GAAG,QAAQC,EAAQG,IAAK,OAAOW,GAAWC,EAAajC,IAAS,QAASiC,GAAajC,GAAkD,IAAI,GAApBgB,GAAMkB,EAA5BC,KAA8CZ,EAAE,EAAEa,EAAUpC,EAAOD,OAASqC,EAAFb,IAAcA,EAAGP,EAAMhB,EAAOuB,GAAMP,IAAqB,SAAXA,EAAM,IAAakB,GAA0B,SAAfA,EAAU,IAAaA,EAAU,IAAIlB,EAAM,GAAGkB,EAAU,GAAGlB,EAAM,KAAQmB,EAAeT,KAAKV,GAAOkB,EAAUlB,GAAQ,OAAOmB,GAAe,QAASH,GAAWhC,GAAyF,IAAI,GAAlBgB,GAAMqB,EAArEC,KAAoBC,EAAUD,EAAiB3B,KAAsCY,EAAE,EAAEa,EAAUpC,EAAOD,OAASqC,EAAFb,IAAcA,EAAmB,OAAhBP,EAAMhB,EAAOuB,GAAUP,EAAM,IAAI,IAAI,IAAI,IAAI,IAAIuB,EAAUb,KAAKV,GAAOL,EAASe,KAAKV,GAAOuB,EAAUvB,EAAM,KAAM,MAAM,KAAI,IAAIqB,EAAQ1B,EAASV,MAAMoC,EAAQ,GAAGrB,EAAM,GAAGuB,EAAU5B,EAASZ,OAAO,EAAEY,EAASA,EAASZ,OAAO,GAAG,GAAGuC,CAAa,MAAM,SAAQC,EAAUb,KAAKV,GAAQ,MAAOsB,GAAa,QAASnB,GAAQzC,GAAQR,KAAKQ,OAAOA,EAAOR,KAAKsE,KAAK9D,EAAOR,KAAKmD,IAAI,EAA4iB,QAASoB,GAAQC,EAAKC,GAAezE,KAAKwE,KAAKA,EAAKxE,KAAK0E,OAAOC,IAAI3E,KAAKwE,MAAMxE,KAAK4E,OAAOH,EAA2qB,QAASI,KAAS7E,KAAK0E,SAA3uK,GAAII,GAAeC,OAAOC,UAAUC,SAAa3E,EAAQ4E,MAAM5E,SAAS,SAAyBH,GAAQ,MAAqC,mBAA9B2E,EAAe/D,KAAKZ,IAAiVW,EAAWwB,OAAO0C,UAAUG,KAA0ElE,EAAW,KAA4EI,GAAW+D,IAAI,QAAQC,IAAI,OAAOC,IAAI,OAAOC,IAAI,SAASC,IAAI,QAAQC,IAAI,UAAqI9B,EAAQ,MAAUxB,EAAQ,MAAUyB,EAAS,OAAWC,EAAQ,QAAYH,EAAM,oBAAi/FT,GAAQ+B,UAAU9B,IAAI,WAAe,MAAmB,KAAZlD,KAAKsE,MAAWrB,EAAQ+B,UAAUvB,KAAK,SAAc5C,GAAI,GAAI6E,GAAM1F,KAAKsE,KAAKoB,MAAM7E,EAAI,KAAI6E,GAAqB,IAAdA,EAAMC,MAAU,MAAM,EAAG,IAAInF,GAAOkF,EAAM,EAAwE,OAArE1F,MAAKsE,KAAKtE,KAAKsE,KAAKsB,UAAUpF,EAAOqB,QAAQ7B,KAAKmD,KAAK3C,EAAOqB,OAAcrB,GAAQyC,EAAQ+B,UAAU5B,UAAU,SAAmBvC,GAAI,GAA+B6E,GAA3BC,EAAM3F,KAAKsE,KAAKuB,OAAOhF,EAAU,QAAO8E,GAAO,IAAI,GAAGD,EAAM1F,KAAKsE,KAAKtE,KAAKsE,KAAK,EAAG,MAAM,KAAK,GAAEoB,EAAM,EAAG,MAAM,SAAQA,EAAM1F,KAAKsE,KAAKsB,UAAU,EAAED,GAAO3F,KAAKsE,KAAKtE,KAAKsE,KAAKsB,UAAUD,GAA8B,MAAvB3F,MAAKmD,KAAKuC,EAAM7D,OAAc6D,GAAgHnB,EAAQS,UAAUxB,KAAK,SAAcgB,GAAM,MAAO,IAAID,GAAQC,EAAKxE,OAAOuE,EAAQS,UAAUc,OAAO,SAAgBC,GAAM,GAAyBnD,GAArB8B,EAAM1E,KAAK0E,KAAgB,IAAGA,EAAMsB,eAAeD,GAAOnD,EAAM8B,EAAMqB,OAAU,CAA8C,IAA7C,GAAiBE,GAAMN,EAAnBO,EAAQlG,KAAiBmG,GAAU,EAAYD,GAAQ,CAAC,GAAGH,EAAKK,QAAQ,KAAK,EAAoD,IAAjDxD,EAAMsD,EAAQ1B,KAAKyB,EAAMF,EAAK7D,MAAM,KAAKyD,EAAM,EAAe,MAAP/C,GAAa+C,EAAMM,EAAMpE,QAAW8D,IAAQM,EAAMpE,OAAO,IAAEsE,EAAUzF,EAAYkC,EAAMqD,EAAMN,KAAQ/C,EAAMA,EAAMqD,EAAMN,UAAgB/C,GAAMsD,EAAQ1B,KAAKuB,GAAMI,EAAUzF,EAAYwF,EAAQ1B,KAAKuB,EAAM,IAAGI,EAAU,KAAMD,GAAQA,EAAQtB,OAAOF,EAAMqB,GAAMnD,EAAuD,MAA9C1C,GAAW0C,KAAOA,EAAMA,EAAM7B,KAAKf,KAAKwE,OAAa5B,GAAuCiC,EAAOG,UAAUqB,WAAW,WAAsBrG,KAAK0E,UAAUG,EAAOG,UAAUsB,MAAM,SAAe/E,EAASC,GAAM,GAAIkD,GAAM1E,KAAK0E,MAAU5C,EAAO4C,EAAMnD,EAA8E,OAAzD,OAARO,IAAaA,EAAO4C,EAAMnD,GAAUD,EAAcC,EAASC,IAAaM,GAAQ+C,EAAOG,UAAUuB,OAAO,SAAgBhF,EAASiD,EAAKgC,GAAU,GAAI1E,GAAO9B,KAAKsG,MAAM/E,GAAc2E,EAAQ1B,YAAgBD,GAAQC,EAAK,GAAID,GAAQC,EAAM,OAAOxE,MAAKyG,aAAa3E,EAAOoE,EAAQM,EAASjF,IAAWsD,EAAOG,UAAUyB,aAAa,SAAsB3E,EAAOoE,EAAQM,EAASE,GAAuD,IAAI,GAAvB5D,GAAM6D,EAAO/D,EAA3BgE,EAAO,GAAkCvD,EAAE,EAAEa,EAAUpC,EAAOD,OAASqC,EAAFb,IAAcA,EAAGT,EAAMiE,OAAU/D,EAAMhB,EAAOuB,GAAGsD,EAAO7D,EAAM,GAAe,MAAT6D,EAAa/D,EAAM5C,KAAK8G,cAAchE,EAAMoD,EAAQM,EAASE,GAAmC,MAATC,EAAa/D,EAAM5C,KAAK+G,eAAejE,EAAMoD,EAAQM,EAASE,GAAmC,MAATC,EAAa/D,EAAM5C,KAAKgH,cAAclE,EAAMoD,EAAQM,EAASE,GAAmC,MAATC,EAAa/D,EAAM5C,KAAKiH,eAAenE,EAAMoD,GAA0B,SAATS,EAAgB/D,EAAM5C,KAAKkH,aAAapE,EAAMoD,GAA0B,SAATS,IAAgB/D,EAAM5C,KAAKmH,SAASrE,IAAkB+D,SAARjE,IAAkBgE,GAAQhE,EAAM,OAAOgE,IAAQ/B,EAAOG,UAAU8B,cAAc,SAAuBhE,EAAMoD,EAAQM,EAASE,GAAiF,QAASU,GAAU7F,GAAU,MAAO8F,GAAKd,OAAOhF,EAAS2E,EAAQM,GAAhI,GAAIa,GAAKrH,KAAS4G,EAAO,GAAOhE,EAAMsD,EAAQJ,OAAOhD,EAAM,GAA+E,IAAIF,EAAJ,CAAiB,GAAGtC,EAAQsC,GAAQ,IAAI,GAAI0E,GAAE,EAAEhE,EAAYV,EAAMf,OAASyB,EAAFgE,IAAgBA,EAAGV,GAAQ5G,KAAKyG,aAAa3D,EAAM,GAAGoD,EAAQ1C,KAAKZ,EAAM0E,IAAId,EAASE,OAAwB,IAAkB,gBAAR9D,IAAiC,gBAARA,IAAiC,gBAARA,GAAkBgE,GAAQ5G,KAAKyG,aAAa3D,EAAM,GAAGoD,EAAQ1C,KAAKZ,GAAO4D,EAASE,OAAuB,IAAGxG,EAAW0C,GAAO,CAAC,GAA6B,gBAAnB8D,GAA4B,KAAM,IAAItE,OAAM,iEAAkEQ,GAAMA,EAAM7B,KAAKmF,EAAQ1B,KAAKkC,EAAiBa,MAAMzE,EAAM,GAAGA,EAAM,IAAIsE,GAAqB,MAAPxE,IAAYgE,GAAQhE,OAAWgE,IAAQ5G,KAAKyG,aAAa3D,EAAM,GAAGoD,EAAQM,EAASE,EAAkB,OAAOE,KAAQ/B,EAAOG,UAAU+B,eAAe,SAAwBjE,EAAMoD,EAAQM,EAASE,GAAkB,GAAI9D,GAAMsD,EAAQJ,OAAOhD,EAAM,GAAI,QAAIF,GAAOtC,EAAQsC,IAAuB,IAAfA,EAAMf,OAAkB7B,KAAKyG,aAAa3D,EAAM,GAAGoD,EAAQM,EAASE,GAA/F,QAAkH7B,EAAOG,UAAUgC,cAAc,SAAuBlE,EAAMoD,EAAQM,GAAU,GAAIA,EAAJ,CAAoB,GAAI5D,GAAM1C,EAAWsG,GAAUA,EAAS1D,EAAM,IAAI0D,EAAS1D,EAAM,GAAI,OAAU,OAAPF,EAAmB5C,KAAKyG,aAAazG,KAAKsG,MAAM1D,GAAOsD,EAAQM,EAAS5D,GAA3E,SAAmFiC,EAAOG,UAAUiC,eAAe,SAAwBnE,EAAMoD,GAAS,GAAItD,GAAMsD,EAAQJ,OAAOhD,EAAM,GAAI,OAAU,OAAPF,EAAmBA,EAAtB,QAA6BiC,EAAOG,UAAUkC,aAAa,SAAsBpE,EAAMoD,GAAS,GAAItD,GAAMsD,EAAQJ,OAAOhD,EAAM,GAAI,OAAU,OAAPF,EAAmB3C,EAASuH,OAAO5E,GAAtC,QAA8CiC,EAAOG,UAAUmC,SAAS,SAAkBrE,GAAO,MAAOA,GAAM,IAAI7C,EAAS8F,KAAK,cAAc9F,EAASwH,QAAQ,QAAQxH,EAASuB,MAAM,KAAK,KAAM,IAAIkG,GAAc,GAAI7C,EAAO5E,GAASoG,WAAW,WAAsB,MAAOqB,GAAcrB,cAAcpG,EAASqG,MAAM,SAAe/E,EAASC,GAAM,MAAOkG,GAAcpB,MAAM/E,EAASC,IAAOvB,EAASsG,OAAO,SAAgBhF,EAASiD,EAAKgC,GAAU,GAAqB,gBAAXjF,GAAqB,KAAM,IAAIoG,WAAU,wDAA2DvH,EAAQmB,GAAU,kFAAsF,OAAOmG,GAAcnB,OAAOhF,EAASiD,EAAKgC,IAAWvG,EAAS2H,QAAQ,SAAiBrG,EAASiD,EAAKgC,EAASqB,GAAM,GAAIC,GAAO7H,EAASsG,OAAOhF,EAASiD,EAAKgC,EAAU,OAAGtG,GAAW2H,OAAOA,GAAKC,GAAoBA,GAAS7H,EAASuH,OAAOtG,EAAWjB,EAASgD,QAAQA,EAAQhD,EAASsE,QAAQA,EAAQtE,EAAS4E,OAAOA,IAc1vS,SAAUkD,GAiRP,QAASC,GAAmBC,EAAOC,EAAWC,EAAUC,GAEpDH,EAAMI,GAAIH,EAAW,SAAUI,GAG3B,MADAC,GAAW/E,KAAM8E,GACVH,EAASK,MAAO,KAAMJ,KAGL,aAAxBK,SAASC,YAA2C,UAAdR,GAGtCC,EAASK,MAAO,KAAMJ,GAI9B,QAASO,GAAiBC,GAGtB,GAAIX,GAAQF,EAAGa,EAEVX,GAAMY,GAAI,2BAEXZ,EAAMI,GAAI,SAAU,WAGXJ,EAAMY,GAAI,YAEXZ,EAAMa,QAAS,SAIfb,EAAMa,QAAS,aAKtBb,EAAMY,GAAI,wBAEXZ,EAAMI,GAAI,SAAU,WAGhB,GAAIU,GAAad,EAAMe,KAAM,OAE7BjB,GAAG,6BAA+BgB,EAAa,MAAOE,KAAM,SAAU5F,EAAG6F,GAErE,GAAIC,GAASpB,EAAGmB,EACXC,GAAON,GAAI,YAEZM,EAAOL,QAAS,SAIhBK,EAAOL,QAAS,eASpC,QAASM,GAAiBC,EAAOC,GAM7B,IAAM,GAJFC,GAAmB,2CACnBC,EAAmBH,EAAMnH,MAAO,KAChCuH,KAEMpG,EAAI,EAAGA,EAAImG,EAAY3H,OAAQwB,IACzC,CACI,GAAIqG,GAAaF,EAAYnG,GAAGsG,MAEhC,IAAMD,GAKAH,EAAiBpE,KAAMuE,GAA7B,CAMA,GAAIhE,GAAQgE,EAAWhE,MAAO6D,EAE9B,KAAM7D,EAAM,IAAMA,EAAM,GAAG7D,QAAU,EAEjC+H,QAAQC,MAAO,iBAAmBH,EAAa,8BAInD,KAAMhE,EAAM,IAAMA,EAAM,GAAG7D,QAAU,EAEjC+H,QAAQC,MAAO,iBAAmBH,EAAa,0BAFnD,CAMA,GAAII,IACAxB,MAAQ5C,EAAM,IAAM,QACpBqE,QAAQrE,EAAM,GACdsE,OAAQtE,EAAM,GACd0C,UAGJ,IAAO1C,EAAM,IAAMA,EAAM,GAAG7D,OAAS,EAGjC,IAAM,GADFuG,GAAS1C,EAAM,GAAGA,MAAO,yCACnB4B,EAAI,EAAGA,EAAIc,EAAOvG,OAAQyF,IACpC,CACI,GAAI2C,GAAQ7B,EAAOd,GAAGqC,MAChBO,OAAOC,WAAYF,IAIQ,QAAvBA,EAAMG,cAEZN,EAAU1B,OAAO5E,MAAM,GAEM,SAAvByG,EAAMG,cAEZN,EAAU1B,OAAO5E,MAAM,GAEM,QAAvByG,EAAMG,cAEZN,EAAU1B,OAAO5E,KAAM8F,GAIvBQ,EAAU1B,OAAO5E,KAAMyG,EAAMxJ,QAAS,eAAgB,KAhBtDqJ,EAAU1B,OAAO5E,KAAM2G,WAAYF,IAqB/CR,EAAWjG,KAAMsG,KAGrB,MAAOL,GA8NX,QAASY,GAAkBC,EAAWC,EAAgBC,GAElDA,EAAkBA,KAIlB,KAAM,GADFC,MACMpH,EAAI,EAAGA,EAAIiH,EAAUI,aAAa7I,OAAQwB,IACpD,CACI,GAAIsH,GAAaL,EAAUI,aAAarH,EACxC,IAAK0E,EAAE6C,QAASD,EAAYH,GAAoB,EAChD,CAII,GAFAA,EAAgBhH,KAAMmH,GAEjBE,EAAWC,UAAU9E,eAAgB2E,GAC1C,CAEUI,gBAAgBD,UAAU9E,eAAgB2E,IAG5CN,EAAkBQ,EAAWC,UAAUH,GAAa,EAAGH,GAE3DC,EAAqBjH,KAAMuH,gBAAgBD,UAAUH,GACrD,UAGJ,GAAuB,GAAlBJ,GAAuBM,EAAWG,SAAShF,eAAgB2E,GAChE,CAEUI,gBAAgB/F,UAAUgB,eAAgB2E,IAG5CN,EAAkBQ,EAAWG,SAASL,GAAa,EAAGH,GAE1DC,EAAqBjH,KAAMuH,gBAAgB/F,UAAU2F,GACrD,UAGJ,GAAuB,GAAlBJ,GAAuBM,EAAWpB,WAAWzD,eAAgB2E,GAClE,CAEUI,gBAAgBtB,WAAWzD,eAAgB2E,IAG7CN,EAAkBQ,EAAWpB,WAAWkB,GAAa,EAAGH,GAE5DC,EAAqBjH,KAAMuH,gBAAgBtB,WAAWkB,GACtD,UAGJf,QAAQC,MAAO,6BAA+Bc,EAAa,4BAI3Df,SAAQC,MAAO,gCAAkCW,EAAgBS,KAAM,QAAW,OAASN,GAK5E,GAAlBJ,EAEDQ,gBAAgBD,UAAUR,EAAUvE,MAAQuE,EAAUY,MAAM1C,MAAO,KAAMiC,GAEjD,GAAlBF,EAENQ,gBAAgB/F,UAAUsF,EAAUvE,MAAQuE,EAAUY,MAAM1C,MAAO,KAAMiC,GAEjD,GAAlBF,IAENQ,gBAAgBtB,WAAWa,EAAUvE,MAAQuE,EAAUY,MAAM1C,MAAO,KAAMiC,IAxrBlF,GAAIhD,GAAU,SASVoD,GACAC,aACAE,YACAvB,cAQJsB,iBAAkB,YAIlB,IAAII,GAA0B,IAC9BJ,iBAAgBK,YAAc,WAG1B,MADAD,GAAWA,GAAY,GAAIJ,kBAI/BA,gBAAgBtD,QAAU,WAYtB,QAAS4D,GAASA,GAKd,IAAK,GAHDC,GAAe7D,EAAQvF,MAAM,KAC7BqJ,EAAiBF,EAAQnJ,MAAM,KAE1BmB,EAAI,EAAGA,EAAIkI,EAAe1J,OAAQwB,IAEvC,GAAIiI,EAAajI,KAAOkI,EAAelI,IAA4B,MAAtBkI,EAAelI,GAA5D,CAKA,GAAImI,SAASF,EAAajI,IAAMmI,SAASD,EAAelI,IAEpD,MAAO,EAGX,IAAImI,SAASF,EAAajI,IAAMmI,SAASD,EAAelI,IAEpD,MAAO,GAGf,MAAO,GAhCX,OACIoI,IAAK,WACD,MAAOhE,IAEXiE,OAAQ,SAAUC,GACd,MAAqB,IAAdN,EAAQM,IAEnBN,QAASA,MAqCjBN,gBAAgBvE,YAQhBuE,gBAAgBa,WAUhBb,gBAAgBc,UAAY,SAAUC,EAAYlJ,GAE9C,MAAKmI,iBAAgBa,QAAQ5F,eAAgB8F,IAEzClC,QAAQC,MAAO,oBAAsBiC,EAAa,8CAC3C,OAGXf,gBAAgBa,QAAQE,GAAclJ,EAE/BmI,gBAAgBa,QAAQE,KAUnCf,gBAAgBgB,UAAY,SAAUD,EAAYE,GAE9C,MAAKjB,iBAAgBa,QAAQ5F,eAAgB8F,GAItCf,gBAAgBa,QAAQE,GAFpBE,GAUfjB,gBAAgBtB,cAYhBsB,gBAAgBjB,UAAY,SAAUmC,EAAeC,EAAoBxB,GAGrE,MAA8B,gBAAlBuB,OAERrC,SAAQC,MAAO,kEAAqEoC,GAAgB,YAKrE,kBAAvBC,OAERtC,SAAQC,MAAO,qEAAwEqC,GAAqB,aAIhHxB,EAAeA,WAEfG,EAAWpB,WAAWwC,IAClBlG,KAAckG,EACdvB,aAAcA,EACdQ,MAAcgB,MAStBnB,gBAAgB/F,UAAUmH,eAAiB,SAAUC,GAGjDA,EAAcA,GAAe,OAE7BrE,EAAGqE,GAAcC,KAAM,iBAAkBpD,KAAM,SAAU5F,EAAGuF,GAGxD,GAAIa,GAAaL,EAAiBrB,EAAGa,GAAUI,KAAM,eAAiBjB,EAAGa,GAEzE,MAAKa,EAAW5H,QAAU,GAA1B,CAMA8G,EAAiBC,EAEjB,KAAM,GAAIvF,GAAI,EAAGA,EAAIoG,EAAW5H,OAAQwB,IACxC,CACI,GAAIyG,GAAYL,EAAWpG,EAC3B,IAAO0H,gBAAgBtB,WAAWK,EAAAA,WAAoBiB,gBAAgBtB,WAAWzD,eAAgB8D,EAAAA,UACjG,CAEI,GAAI3B,GAAW4C,gBAAgBtB,WAAWK,EAAAA,UAAiBA,EAAUE,OAC9D7B,IAA+B,kBAAZA,GAGE,SAAnB2B,EAAUxB,MAEXH,EAASK,MAAO,KAAMsB,EAAU1B,QAIhCJ,EAAmBD,EAAGa,GAAWkB,EAAUxB,MAAOH,EAAU2B,EAAU1B,QAa1EwB,QAAQC,MAAO,qBAAuBC,EAAUE,OAAS,OAASF,EAAAA,cAMtEF,SAAQC,MAAO,wBAA0BC,EAAAA,cAKrD/B,EAAGU,UAAWK,QAAS,eAAgBsD,GAG3C,IAAI7D,KAEJwC,iBAAgBuB,eAAiB,SAAUpE,GAEvC,GAAIqE,GAAehE,EAAW1G,OAAS,CACvC,KAAMqG,EAEF,MAAOK,GAAWgE,EAIlB,KAAM,GAAIlJ,GAAIkJ,EAAclJ,GAAK,EAAGA,IAEhC,GAAK6E,GAAaK,EAAWlF,GAAGV,KAE5B,MAAO4F,GAAWlF,EAK9B,OAAO,OAIX0H,gBAAgByB,UAAY,SAAUlE,GAElCC,EAAW/E,KAAM8E,IAgKrByC,gBAAgB0B,QAAU,SAAUC,EAAaC,EAAkBjC,GAI/D,MAA4B,gBAAhBgC,OAER9C,SAAQC,MAAO,kEAAqE6C,GAAc,YAKrE,kBAArBC,OAER/C,SAAQC,MAAO,qEAAwE8C,GAAmB,aAI9GjC,EAAeA,WAEfG,EAAWG,SAAS0B,IAChB3G,KAAc2G,EACdhC,aAAcA,EACdQ,MAAcyB,MAWtB5B,gBAAgBD,aAUhBC,gBAAgBrL,QAAU,SAAUkN,EAAaC,EAAkBnC,GAI/D,MAA4B,gBAAhBkC,OAERhD,SAAQC,MAAO,kEAAqE+C,GAAc,YAKrE,kBAArBC,OAERjD,SAAQC,MAAO,qEAAwEgD,GAAmB,aAI9GnC,EAAoCA,WACpCG,EAAWC,UAAU8B,IACjB7G,KAAc6G,EACdlC,aAAcA,EACdQ,MAAc2B,MActB9B,gBAAgB+B,gBAAkB,SAAUvL,EAAUwL,GAUlD,MARAA,GAAiBA,MACjBA,EAAKC,UAAY,WAEb,MAAO,UAAUC,EAAM1G,GAEnB,MAAOA,GAAQwE,gBAAgBiC,UAAWC,MAG3ClN,SAASwG,OAAQ/G,cAAc+B,GAAWwL,IASrDhC,gBAAgBmC,WAAa,GAQ7BnC,gBAAgBoC,WAQhBpC,gBAAgBqC,iBAAmB,SAAUC,GAEzCtF,EAAEuF,MACEC,IAAMxC,gBAAgBmC,WAAaG,EACnCG,SAAU,SACXC,KAAM,SAAUC,GACf3C,gBAAgBoC,QAAUO,KAclC3C,gBAAgBiC,UAAY,SAAUxM,EAAQ4H,GAE1C,GAAIuF,EAgBJ,OAfK5C,iBAAgBoC,QAAQnH,eAAgBxF,GAEzCmN,EAAe5C,gBAAgBoC,QAAQ3M,IAIvCmN,EAAenN,EACfoJ,QAAQgE,KAAM,6BAA+BD,EAAe,OAGzDvF,IAEHuF,EAAe5N,SAASwG,OAAQoH,EAAcvF,IAG3CuF,GASX5C,gBAAgB8C,QAAU,WAGtB,IAAM,GAAInO,KAAWmL,GAAWC,UAEtBC,gBAAgBD,UAAU9E,eAAgBtG,IAG5C2K,EAAkBQ,EAAWC,UAAUpL,GAAU,EAIzD,KAAM,GAAI+M,KAAW5B,GAAWG,SAEtBD,gBAAgB/F,UAAUgB,eAAgByG,IAG5CpC,EAAkBQ,EAAWG,SAASyB,GAAU,EAIxD,KAAM,GAAI3C,KAAae,GAAWpB,WAExBsB,gBAAgBtB,WAAWzD,eAAgB8D,IAG7CO,EAAkBQ,EAAWpB,WAAWK,GAAY,EAM5D,IAAI/B,EAAE,6BAA6BlG,OAAS,EAC1CkJ,gBAAgBmC,WAAanF,EAAE,6BAA6B+F,QAAQf,KAAK,0BAI1E,KAAK,GADAgB,GAAUtF,SAASuF,qBAAsB,UACrC3K,EAAI0K,EAAQlM,OAAS,EAAGwB,GAAK,EAAGA,IAAM,CAC3C,GAAI4K,GAAOF,EAAQ1K,GAAG6K,IAAIxI,MAAO,0BACjC,IAAMuI,EAAO,CACTlD,gBAAgBmC,WAAae,EAAK,EAClC,WAiFdE,QAWF,SAAUpG,EAAGqG,GAEVA,EAAGtE,UAAW,iBAAkB,SAAUuE,GAMtC,QAASC,GAAOC,GAEZH,EAAG9B,iBAAiBkC,iBACpBH,EAAsBI,cAAe1G,EAAGwG,IAP5C,OACID,MAAOA,KAQX,2BAELH,OAAQpD,iBACV,SAAUhD,EAAGqG,GAEVA,EAAGtE,UAAW,SAAU,SAAU4E,GAU9B,QAASC,GAAeJ,GAEpBH,EAAG9B,iBAAiBkC,gBAEpB,IAAII,MACAC,KACA5G,EAAkBF,EAAGwG,GACrBO,EAAkB7G,EAAM8G,QAAS,QACjCC,EAAkBF,EAAWzC,KAAM,wBAEvCwC,GAAUI,kBAAoBH,EAAWzC,KAAM,+BAAgC6C,MAC/EL,EAAUM,mBAAqBL,EAAWzC,KAAM,gCAAiC6C,MACjFL,EAAUO,cAAgBN,EAAWzC,KAAM,mCAAoC6C,MAE/EN,EAAgBS,iBAAqBP,EAAWzC,KAAM,sBAAuB6C,MAC7EN,EAAgBU,kBAAqBR,EAAWzC,KAAM,qBAAsB6C,MAC5EN,EAAgBW,mBAAqBT,EAAWzC,KAAM,6BAA8B6C,MACpFN,EAAgBY,mBAAqBV,EAAWzC,KAAM,4BAA6B6C,MAG9EF,EAAMnN,OAAS,GACbmN,EAAME,MAAQ,IAEjBN,EAAgBU,kBAAoBN,EAAME,MAI9C,IAAIO,GAAsBX,EAAWzC,KAAM,8BACvCqD,IAEJ3H,GAAEkB,KAAMwG,EAAqB,SAAUE,EAAKpB,GAExC,GAAI7I,GAAQ6I,EAAKxI,KAAKL,MAAO,yCACxBA,IAASA,EAAM,IAEhBgK,EAAelM,MACXoM,sBAA4BlK,EAAM,GAClCmK,2BAA4B9H,EAAGwG,GAAOW,UAKpB,GAAzBQ,EAAe7N,SAEhB+M,EAAgBkB,yBAA2BJ,GAGL,mBAAhCb,GAAUI,mBACbJ,EAAUI,kBAAoB,GAEjCP,EAAcqB,aAAclB,GAIhCH,EAAcsB,SAAUpB,IAI5B,QAASqB,GAAoB1B,EAAM2B,GAE/B,GAAIjI,GAAiBF,EAAGwG,GACpB4B,EAAiBlI,EAAM8G,QAAQ,sCAAsC1C,KAAM,6BAC3E+D,EAAiB5E,SAAU2E,EAAenH,KAAM,eAAmB,EACnEpG,EAAiB4I,SAAU2E,EAAejB,OAAUgB,CAExDG,GAA2BpI,EAAOkI,EAAgBC,EAAWxN,GAGjE,QAAS0N,GAAoB/B,GAEzB,GAAItG,GAAQF,EAAGwG,GACX4B,EAAiBlI,EACjBmI,EAAiB5E,SAAU2E,EAAenH,KAAM,eAAmB,EACnEpG,EAAiB2N,EAAgBJ,EAAejB,MAEpDmB,GAA0BpI,EAAOkI,EAAgBC,EAAWxN,GAGhE,QAAS4N,GAAiBC,EAAcpH,GAEpCqF,EAAc8B,gBACVC,EACAjF,SAAUzD,EAAGsB,GAAQ6F,QACvBwB,KAAM,WAGJ,GAAIC,GAAajC,EAAckC,QAASH,EACxC1I,GAAGsB,GAAQ6F,IAAKyB,EAAWpB,sBAInC,QAASc,GAA0BzH,EAASiI,EAAeT,EAAWxN,GAElE,GAAIkO,GAAelI,EAAQmG,QAAS,yBAA0BlN,OAAS,CAEvE,IAAKiP,EACL,EACUlO,EAAQ,IAAIf,QAAUuO,GAAaxN,GAAS,GAE9CiO,EAAc3B,IAAKtM,EAGvB,IAAImO,GAAUnI,EAAQmE,KAAM,UAErBgE,IAEHC,OAAOC,aAAcF,GAGzBA,EAAUC,OAAOE,WAAY,WAEzBL,EAAc/H,QAAS,WACxB,KAEHF,EAAQmE,KAAM,UAAWgE,QAInBnO,EAAQ,IAAIf,QAAUuO,GAAaxN,GAAS,IAE9CiO,EAAc3B,IAAKtM,GACnBgG,EAAQmG,QAAS,QAAS1C,KAAM,6BAA8B6C,IAAKtM,IAM/E,QAAS2N,GAAeY,GAEpB,MADAA,GAAIA,EAAE1Q,QAAQ,IAAK,MACfyJ,MAAMC,WAAWgH,KAAOC,SAASD,GAE5BhH,WAAWgH,GAEb,EA5IX,OACIxC,cAAoBA,EACpBsB,mBAAoBA,EACpBO,gBAAoBA,EACpBF,mBAAqBA,KA2IzB,mBACLnC,OAAQpD,iBAEX,SAAWhD,EAAGqG,GAEVA,EAAGtE,UAAW,WAAY,SAAUuH,GAQhC,QAASC,GAAoBC,GAEzBF,EAAgBC,mBAAoBC,GAGxC,QAASC,GAAqBC,GAE1BJ,EAAgBG,oBAAqBC,GAZzC,OACIH,mBAAoBA,EACpBE,oBAAqBA,KAYzB,qBACJrD,OAAQpD,iBAcX,SAAUhD,EAAGqG,GAEVA,EAAGtE,UAAW,iBAAkB,SAAU4H,GActC,QAASC,KAEL5J,EAAGiJ,QAAS3I,GAAI,+BAAgC,WAEtCN,EAAG,SAAUc,GAAI,YAEnB+I,EAAgBC,GAChBD,EAAgBE,MAK5B,QAASF,GAAgBG,EAAczJ,GAGnC,IAAM,GADF0J,GACM3O,EAAI,EAAGA,EAAI0O,EAAalQ,OAAQwB,IAEtC2O,EAAWjK,EAAGgK,EAAa1O,IACpBiF,EAEgD,IAA9C0J,EAAS3F,KAAMtE,EAAGO,EAAM2J,SAAWpQ,QAChCkG,EAAG,SAAUc,GAAI,YAErBmJ,EAASE,YAAa,QACtBnK,EAAG,QAASoK,OAAQ,mBAAoBC,IAKtCrK,EAAG,SAAUc,GAAI,YAEnBmJ,EAASE,YAAa,QACtBnK,EAAG,QAASoK,OAAQ,mBAAoBC,IAOxD,QAASC,GAAc9D,EAAM+D,GAEzB,GAAIrK,GAAUF,EAAGwG,GACbgE,EAAUtK,EAAMrD,QAKb0N,KAAqBZ,EAAUc,WAAY,WAAgBC,UAAUC,OAAShB,EAAUc,WAAY,aAEjGD,EAAQ1J,GAAI,SAYRZ,EAAMe,KAAM,SAGduJ,EAAQL,YAAa,SAbzBS,EAAwB1K,EAAOsK,GAGzBtK,EAAMe,KAAM,SAEd4J,EAAgCL,EAAQM,IAAK5K,OAenDqK,GAAqBG,UAAUC,OAAShB,EAAUc,WAAY,YAE1DD,EAAQ1J,GAAI,WAEd8J,EAAwB1K,EAAOsK,GAE/BK,EAAgCL,KAUxCxK,EAAG,QAASM,GAAI,mBAAoB+J,GAGxC,QAASO,GAAwBpE,EAAM3J,GAEnC,GAAI2N,GAAUxK,EAAGnD,EAGjBgN,GAAgBE,EAA0BvD,GAGrCxG,EAAE6C,QAAS2H,EAAQ,GAAIT,GAA6B,GAErDA,EAAyBtO,KAAM+O,EAAQ,IAI3CA,EAAQO,SAAU,QAGtB,QAASF,GAAgCrE,GAErC,GAAItG,GAAQF,EAAGwG,EAGfH,GAAG9B,iBAAiBkC,iBAGpBvG,EAAM8K,IAAK,SACX9K,EAAMI,GAAI,QAAS,SAAU2K,GAEzBA,EAAEC,oBAIV,QAASC,GAAe3E,GAEpB,GAAItG,GAAcF,EAAGwG,GACjB4E,EAAclL,EAAMrD,QAInB8M,GAAUc,WAAY,YAEvBW,EAAYL,SAAU,aACtB7K,EAAMmL,SAAU,MAAOC,YAAa,IAAK,WAEhCF,EAAYtK,GAAI,WAAcd,EAAG,SAAUc,GAAI,WAEhDsK,EAAYjB,YAAa,QACzBjK,EAAMmL,SAAU,MAAOE,WAAY,SACnCH,EAAYjB,YAAa,eAIzBiB,EAAYL,SAAU,QACjB/K,EAAE6C,QAASuI,EAAY,GAAItB,GAAqB,GAEjDA,EAAiBrO,KAAM2P,EAAY,QAOnDpL,EAAG,QAASM,GAAI,mBAAoB+J,GAGxC,QAASA,GAAY9J,GAEjBsJ,EAAgBE,EAA0BxJ,GAxK9C,GAAIuJ,MAGAC,IAEJ,QACIH,cAAeA,EACfU,aAAeA,EACfa,cAAeA,KAmKnB,sBACL/E,OAAQpD,iBACV,SAAUhD,EAAGqG,GAEVA,EAAGtE,UAAW,WAAY,SAAUyJ,EAAkBC,GAQlD,QAASC,GAAIC,GAE2B,MAA/BH,EAAiBI,aAEG,gBAATD,IAA0C,IAArBA,EAAKtN,QAAQ,MAAc2B,EAAG2L,GAAO7R,OAAS,EAE3EmP,OAAO4C,SAASC,OAAQ9L,EAAG2L,GAAO1K,KAAM,SAIxCgI,OAAO4C,SAASC,OAAQH,IAKpC,QAASI,GAAeC,GAEpBP,EAAiBQ,OAAQD,GAtB7B,OACIN,GAAeA,EACfK,cAAeA,KAuBnB,mBAAoB,sBACzB3F,OAAQpD,iBACX,SAAWhD,EAAGqG,GAEVA,EAAGtE,UAAW,MAAO,SAAU4H,GAY3B,QAASuC,GAASC,GAEdnM,EAAGmM,GAAcC,IAAK,QAG1B,QAASC,GAAiBnM,EAAO8L,EAAOM,GAE9BC,EAAUD,KAEZC,EAAUD,GAAW,GAAIE,IAGvBD,EAAUD,GAASG,OAAQT,IAE7BO,EAAUD,GAASI,OAAQV,GAG/BO,EAAUD,GAASG,OAAQT,GAAQW,SAAUzM,GAGjD,QAAS0M,GAAe1M,EAAO8L,EAAOM,GAE5BC,EAAUD,KAEZC,EAAUD,GAAW,GAAIE,IAGvBD,EAAUD,GAASG,OAAQT,IAE7BO,EAAUD,GAASI,OAAQV,GAG/BO,EAAUD,GAASG,OAAQT,GAAQa,WAAY3M,GAGnD,QAAS4M,GAAed,EAAOM,EAASV,GAE/BjC,EAAUc,WAAYmB,KAEvBvF,EAAG9B,iBAAiBkC,iBAEb8F,EAAUD,IAAcC,EAAUD,GAASG,OAAQT,IAEtDO,EAAUD,GAASJ,QAASF,IAMxC,QAASQ,KAYL,QAASE,GAAQV,GAGb,MADAe,GAAKf,GAAS,GAAIgB,GAAKhB,GAChBe,EAAKf,GAGhB,QAASE,GAASF,GAEd,GAAIiB,GAAS,CACb,IAAOC,EAGHD,EAASxJ,SAAUyJ,EAAUC,aAAatQ,SAASuQ,IAAK,WACxDF,EAAUG,OACVH,EAAUC,aAAatQ,SAASuQ,IAAK,SAAUH,EAAS,OAG5D,CAEI,IAAM,GAAIb,KAAOW,GAEb,GAAOA,EAAKX,GAAKe,aACjB,CACI,GAAIG,GAAW7J,SAAUsJ,EAAKX,GAAKe,aAAatQ,SAASuQ,IAAK,YAC/C,GAAVH,GAA0BA,EAAXK,KAEhBL,EAASK,GAEbP,EAAKX,GAAKiB,OAIlB,IAAM,GAAIjB,KAAOW,GAENA,EAAKX,GAAKe,cAEbJ,EAAKX,GAAKe,aAAatQ,SAASuQ,IAAK,SAAUH,EAAS,GAOpEC,EAAYH,EAAKf,GACjBkB,EAAUC,aAAatQ,SAASuQ,IAAK,SAAUH,GAC/CC,EAAUK,OAGd,QAASd,GAAQT,GAEb,MAAOe,GAAKf,GAGhB,QAASwB,KAEL,IAAM,GAAIpB,KAAOW,GAENA,EAAKX,GAAKe,cAEbJ,EAAKX,GAAKmB,MAIlBL,GAAY,KAzEhB,GACIA,GADAH,IAGJ,QACIL,OAAWA,EACXR,QAAWA,EACXO,OAAWA,EACXe,UAAWA,GAsEnB,QAASR,GAAKS,GAeV,QAASC,KAEL,MAAO1B,GAGX,QAASW,GAAUgB,GAGf,MADAC,GAAQnS,KAAMkS,GACP1V,KAGX,QAAS4U,GAAYgB,GAGjB,MADAC,GAAWD,EACJ5V,KAGX,QAASkV,KAEL,MAAOW,GAGX,QAASP,KAEL,IAAM,GAAIjS,GAAI,EAAGA,EAAIsS,EAAQ9T,OAAQwB,IAEjCsS,EAAQtS,GAAGyP,SAAU,SAGlB+C,IAEHA,EAASP,OAAOxC,SAAU,MAKlC,QAASsC,KAEL,IAAM,GAAI/R,GAAI,EAAGA,EAAIsS,EAAQ9T,OAAQwB,IAEjCsS,EAAQtS,GAAG6O,YAAa,SAGrB2D,IAEHA,EAAST,OAAOlD,YAAa,MA1DrC,GAAI2D,GACAF,KACA5B,EAAUyB,CAEd,QACId,SAAYA,EACZE,WAAYA,EACZM,WAAYA,EACZO,MAAYA,EACZH,KAAYA,EACZF,KAAYA,GArJpB,GAAId,KAEJ,QACIL,QAAiBA,EACjBG,gBAAiBA,EACjBO,cAAiBA,EACjBE,cAAiBA,KAoMrB,sBACJ1G,OAAQpD,iBASX,SAAUhD,EAAGqG,GAEVA,EAAGtE,UAAW,KAAM,SAAUyJ,EAAkBuC,EAAoBC,GAyBhE,QAASC,KAGLjO,EAAGiJ,QAAS3I,GAAI,4BAA6B,WAEzC4N,MAGJlO,EAAGiJ,QAAS3I,GAAI,gBAAiB,WAExB6N,EAAgBrU,OAAS,IAErBkG,EAAGU,UAAW0N,YAAc,IAE7BC,EAAmBF,EAAiB,WAAY,WAIhDE,EAAmBF,EAAiB,cAAe,cAUnE,QAASG,KAELN,EAAUM,iBAOd,QAASC,GAAgBC,GAErBR,EAAUO,eAAgBC,GAqB9B,QAASC,GAAsBjI,GAE3BxG,EAAGwG,GAAOkI,aACNC,YAAiB,EACjBC,gBAAiB,EACjBC,WAAiB,IACjBC,gBAAiB,IACjBC,YAAiB,EACjBC,SAAiB,IACjBC,aAAiB,EACjBC,UAAiB,SAAUC,GAEvBnP,EAAGmP,GAAU7K,KAAM,gCAAiCvD,QAAS,aAczE,QAASqO,GAAa5I,EAAM6I,EAAYC,GAEpC,GAAIpP,GAAmBF,EAAGwG,GACtB+I,EAAmB,EACnBC,KACAC,EAAmBvP,EAAMoE,KAAM,oCAAqCxK,OAAS,EAAIoG,EAAMoE,KAAM,oCAAuCpE,EAAMwP,UAGzIJ,MAAkB,GAEnBK,EAAuBlU,KAAM+K,EAGjC,KAAM,GAAIlL,GAAImU,EAAiB3V,OAAQwB,GAAK,EAAGA,IAE3CkU,EAAexP,EAAGyP,EAAiBnU,IACnCkU,EAAapC,IAAK,SAAU,IAEvBoC,EAAaI,aAAa,GAASL,IAEpCA,EAAYC,EAAaI,aAAa,MAIxCP,GAAc7D,EAAiBf,WAAY4E,KAE7CI,EAAiBI,OAAQN,GAYjC,QAASO,GAAWtJ,GAEhB,GAAItG,GAAQF,EAAGwG,EAEftG,GAAM6P,MAAO,WAKT,MAHA/P,GAAG,cAAegQ,SACd5B,UAAW,GACZ,MACI,IAGJpO,EAAE6C,QAAS3C,EAAOiO,IAErBA,EAAgB1S,KAAMyE,GAW9B,QAAS+P,GAAczJ,EAAM0J,GAEzB,GAAIhQ,GAAQF,EAAGwG,EAEftG,GAAMiQ,UACFD,OAAQA,IAEPhQ,EAAMY,GAAI,QAEXZ,EAAMI,GAAI,SAAU,WAEhBJ,EAAMkN,IAAK,UAAW,kBAYlC,QAASgD,GAAgB5J,GAGrB3E,QAAQwO,IAAK7J,EAEb,IAAItG,GAAcF,EAAGwG,GACjB4E,EAAclL,EAAMrD,QAExBuO,GAAYL,SAAU,aACtB7K,EAAMmL,SAAU,MAAOC,YAAa,IAAK,WAEhCF,EAAYtK,GAAI,SAEjBsK,EAAYjB,YAAa,QAIzBiB,EAAYL,SAAU,QAE1B7K,EAAMmL,SAAU,MAAOE,WAAY,SACnCH,EAAYjB,YAAa,eAYjC,QAASmG,GAAiB9J,EAAM+J,GAE5B,GAAIrQ,GAAiBF,EAAGwG,GACpBgK,EAAiBxQ,EAAGE,EAAMe,KAAM,mBAEpC,IAAKf,EAAMY,GAAI,uBACf,CAEI,GAAI2P,GAAmBzQ,EAAG,6BAAiCE,EAAMe,KAAM,QAAa,MAChFyP,GAAoBH,GAAsB,WAAXA,CAEnCE,GAAgBE,OAAQ,WAEpB,GAAIC,GAAQ5Q,EAAG/H,KACfuY,GAAexJ,QAAS,oCAAqCoG,IAAK,SAAU,QAEvEwD,EAAM9P,GAAI,aAAgB8P,EAAM,KAAO1Q,EAAM,IAA0B,GAApBwQ,EAGpDF,EAAeK,UAAW,IAAK,WAE3B3C,MAMJsC,EAAeM,QAAS,IAAK,WAEzB5C,YAQZhO,GAAM6P,MAAO,WAIT7P,EAAM6K,SAAU,aAChByF,EAAelF,YAAa,IAAK,WAE7BpL,EAAMiK,YAAa,aACnBjK,EAAM6Q,YAAa,UACnB7C,QAMhB,QAAS2C,GAAW3G,EAAQ8G,GAExBC,EAAajR,EAAGkK,GAAU8G,EAAU,aAGxC,QAASF,GAAS5G,EAAQ8G,GAEtBC,EAAajR,EAAGkK,GAAU8G,EAAU,WAGxC,QAAS1F,GAAapB,EAAQ8G,GAE1BC,EAAajR,EAAGkK,GAAU8G,EAAU,eAGxC,QAASC,GAAaC,EAASF,EAAUG,GAErCH,EAAWA,GAAY,IACvBE,EAAQlK,QAAS,oCAAqCoG,IAAK,SAAU,QACrE8D,EAAQC,GAAiBH,EAAU,WAE/B9C,MA8BR,QAASkD,GAAmB5K,EAAM6K,GAE9B,GAAInR,GAAUF,EAAGwG,GACb8K,EAAUpR,EAAMoE,KAAM,oCAG1BpE,GAAMqR,OAAQ,wCAIRD,EAAQxQ,GAAI,YAEdwQ,EAAQvG,SAAU,OAItBuG,EAAQhR,GAAI,QAAS,WAEZgR,EAAQE,SAAU,SAGiB,WAA/BtR,EAAMe,KAAM,gBAEbf,EAAMuR,QAAS,WAEnBH,EAAQnH,YAAa,OAAQY,SAAU,MAEvC7K,EAAMoE,KAAM,0CAA2C+I,OAEvDnN,EAAMoE,KAAM,qBAAsBiN,OAAQxD,EAAmB2D,iBAAkBL,OAuB3F,QAASN,GAAaY,EAAUzH,EAAQ0B,GAEpC,GAAIsF,GAAUlR,EAAGkK,EAiBjB,IAAKgH,EAAQlK,QAAS,gBAAiBlN,OAAS,EAChD,CACI,GAAIoG,GAAQgR,EAAQxB,SAAU,OAE9B,OADArJ,GAAG3E,WAA2B,eAAEyJ,cAAejL,IACxC,EAGX,GAAOgK,GAAYyH,KAAe/F,GAAYJ,EAAiBf,WAAYmB,IAC3E,CACI,GAAIX,GAAI5E,EAAG9B,gBAOX,OANO0G,IAEHA,EAAExE,iBAGNyK,EAAQH,YAAaY,IACd,GAIf,QAAS5G,GAAU4G,EAAUzH,EAAQ0B,GAEjC,GAAO1B,GAAYyH,KAAe/F,GAAYJ,EAAiBf,WAAYmB,IAC3E,CACI,GAAIX,GAAI5E,EAAG9B,gBAOX,OANO0G,IAEHA,EAAExE,iBAGNzG,EAAGkK,GAASa,SAAU4G,IACf,GAIf,QAASxH,GAAawH,EAAUzH,EAAQ0B,GAEpC,GAAO1B,GAAYyH,KAAe/F,GAAYJ,EAAiBf,WAAYmB,IAC3E,CACI,GAAIX,GAAI5E,EAAG9B,gBAOX,OANO0G,IAEHA,EAAExE,iBAGNzG,EAAGkK,GAASC,YAAawH,IAClB,GAQf,QAASzD,KAEL,IAAM,GAAI5S,GAAIqU,EAAuB7V,OAAS,EAAGwB,GAAK,EAAGA,IAErD8T,EAAaO,EAAuBrU,GAAI,IAAI,GAIpD,QAAS+S,GAAmBuD,EAAOC,EAAMxR,GAErC,IAAM,GAAI/E,GAAIsW,EAAM9X,OAAS,EAAGwB,GAAK,EAAGA,IAEpCsW,EAAMtW,GAAGuW,GAAOxR,GAldxB,GAAIsP,MACAxB,IAEJ,QACIF,mBAAsBA,EACtBK,eAAsBA,EACtBC,eAAsBA,EACtBE,qBAAsBA,EACtBW,YAAsBA,EACtBU,UAAsBA,EACtBG,aAAsBA,EACtBK,gBAAsBA,EACtBO,UAAsBA,EACtBC,QAAsBA,EACtBxF,YAAsBA,EACtB8E,eAAsBA,EACtBgB,kBAAsBA,EACtBL,YAAsBA,EACtBhG,SAAsBA,EACtBZ,YAAsBA,KAmc1B,mBAAoB,qBAAsB,eAC/C/D,OAAQpD,iBACV,SAAUhD,EAAGqG,GAEVA,EAAGtE,UAAW,YAAa,SAAU+P,GAOjC,QAASC,GAAUC,EAAMC,GAErB,MAAOH,GAAkBC,SAAUC,EAAMC,GAN7C,OACIF,SAAUA,KAQd,uBACL3L,OAAQpD,iBAaV,SAAUhD,EAAGqG,GAaVA,EAAG1O,QAAS,aAAc,SAAUua,EAAIC,GAiBpC,QAASC,KAEC/L,EAAGrC,UAAW,kBAKbqO,GAEHnJ,aAAcmJ,GAGlBA,EAA2BlJ,WAAY,WAEnCnJ,EAAGiJ,QAASlI,QAAS,iBAEiB,aAAjCsF,EAAGrC,UAAW,eAEfmO,EAAMG,UACDC,SAAUlM,EAAGpB,UAAW,8BACxB4H,WAAYxG,EAAGpB,UAAW,8CAC1BuN,gBAAiB,MACjBC,gBAAiBpM,EAAGpB,UAAW,OAC/ByN,UAAW,WAERzJ,OAAO4C,SAASC,OAAQ,OAE3B6G,UAAW,WAER1J,OAAO4C,SAASC,OAAQ,OAE3ByB,QAGVlH,EAAGrC,UAAW,4BAarB,QAAS4O,GAAaC,GAElB,IAEI,GAAIC,GAAe9S,EAAE+S,UAAWF,EAAMC,aACtCZ,GAAGc,YAAaF,EAAahR,MAAMmR,aAEvC,MAAQhI,GAEJiH,EAAGgB,WAAYL,EAAMM,OAAQN,EAAMO,aAiB3C,QAASC,GAAM7N,EAAKnF,EAAQiT,EAAcC,EAAiBC,GAQvD,MALMD,IAEFrB,EAAGuB,iBAGAzT,EAAEuF,KACLC,GAEI5K,KAAU,MACVoK,KAAU3E,EACVoF,SAAU,OACViO,OAAWF,EACX1R,MAAU,SAAU+Q,GAEVS,GAEFV,EAAaC,MAI3Bc,OAAQ,WAEAJ,GAEFrB,EAAG0B,iBAEPxB,MAkBR,QAASyB,GAAOrO,EAAKR,EAAMsO,EAAcC,GAGrC,GAAIlT,IACAzF,KAAU,OACV6K,SAAU,OACV3D,MAAU,SAAU+Q,GAEVS,GAEFV,EAAaC,IAuBzB,OAlBO7N,IAAQA,EAAK8O,QAEhBzT,EAAO1D,MAAcqI,EAAKrI,MAC1B0D,EAAO0T,YAAc/O,EAAK+O,YAC1B1T,EAAO2E,KAAcA,EAAKA,KAC1B3E,EAAO2T,aAAc,IAIrB3T,EAAO2E,KAAciP,KAAKC,UAAWlP,GACrC3E,EAAO2T,YAAc,oBAGnBT,GAEFrB,EAAGuB,iBAGAzT,EAAEuF,KACLC,EAAKnF,GACPsT,OAAQ,WAEAJ,GAEFrB,EAAG0B,iBAEPxB,MAiBR,QAAS+B,GAAM3O,EAAKR,EAAMsO,EAAcC,GAQpC,MALMA,IAEFrB,EAAGuB,iBAGAzT,EAAEuF,KACLC,GAEI5K,KAAa,MACboK,KAAaiP,KAAKC,UAAWlP,GAC7BS,SAAa,OACbuO,YAAa,mBACblS,MAAa,SAAU+Q,GAEbS,GAEFV,EAAaC,MAI3Bc,OAAQ,WAEAJ,GAEFrB,EAAG0B,iBAEPxB,MAkBR,QAASgC,GAAS5O,EAAKR,EAAMsO,EAAcC,GAQvC,MALMA,IAEFrB,EAAGuB,iBAGAzT,EAAEuF,KACLC,GAEI5K,KAAa,SACboK,KAAaiP,KAAKC,UAAWlP,GAC7BS,SAAa,OACbuO,YAAa,mBACblS,MAAa,SAAU+Q,GAEbS,GAEFV,EAAaC,MAI3Bc,OAAQ,WAEAJ,GAEFrB,EAAG0B,iBAEPxB,MAUR,QAASiC,KAEL,MAAOrU,GAAEsU,WAAWC,UAxRxB,GAAIlC,GAA2B,IAM/B,OALArS,GAAGU,UAAW8T,MAAO,WAEjBpC,OAIA1O,IAAQ2P,EACRoB,KAAQZ,EACRa,IAAQP,EACRQ,SAAQP,EACRQ,KAAQP,KAgRZ,YAAa,kBAClBjO,OAAQpD,iBAcV,SAAUqD,GAaPA,EAAG1O,QAAS,aAAc,SAAUkd,GAwBhC,QAASC,GAAcC,EAAe1U,GAGlC,QAAS2U,GAAMC,GAEX,MAAOJ,GAAInR,IAAK,SAAWuR,EAAY5S,cAAgB,cAAgB0S,EAAc1S,cAAgB,IAAKhC,GAG9G,OACI2U,KAAMA,GAoBd,QAASE,GAAWH,EAAe1U,GAG/B,QAAS2U,GAAMC,GAEX,MAAOJ,GAAInR,IAAK,SAAWuR,EAAY5S,cAAgB,IAAM0S,EAAc1S,cAAgB,IAAKhC,GAGpG,OACI2U,KAAMA,GAWd,QAASG,GAAoBC,GAEzB,MAAOP,GAAInR,IAAK,sDAAwD0R,GAxE5E,OACIN,aAAoBA,EACpBI,UAAoBA,EACpBC,mBAAoBA,KAwExB,gBACLnS,iBAaF,SAAUqD,GAePA,EAAG1O,QAAS,kBAAmB,SAAUkd,EAAKQ,EAAKnD,GAkB/C,QAASoD,KAEL,MAAOC,GAQX,QAASC,GAAaC,GAOlB,MALMC,IAAaH,GAEfI,GAAc,GAGXF,EAEIzV,EAAE4V,QAAQ,KAAUL,GAExBG,EASX,QAASC,GAAcnC,GAGnB,MAAOqB,GAAInR,IAAK,kBAAmB,MAAM,GAAO,EAAO8P,GAClD9N,KAAM,SAAUC,GAENA,GAEH4P,EAAe5P,EAASX,KACxB0Q,EAAe,GAAIJ,IAInBpD,EAAGgB,WAAY,EAAG,iFAWlC,QAAS2C,KAGL,MAAOhB,GAAIH,IAAK,iBAAkBgB,GAC7BhQ,KAAM,SAAUC,GAENA,GAEH4P,EAAe5P,EAASX,KACxB0Q,EAAe,GAAIJ,IAInBpD,EAAGgB,WAAY,EAAG,iFAclC,QAAS4C,GAAiBC,GAGtB,MAAOV,GAAIP,aAAc,WAAaiB,GAAYf,KAAM,YACnDtP,KAAM,SAAUC,GAEb3F,EAAG,mCAAqC+V,EAAY,MAC/C7U,KAAM,SAAU5F,EAAGkL,GAEhBxG,EAAGwG,GAAOwP,KAAMrQ,EAASX,KAAK,IAC9BqB,EAAGhD,cAAce,eAAgBoC,GACjCxG,EAAGiJ,QAASlI,QAAS,sBAczC,QAASkV,GAAkBC,GAGvB,MAAOb,GAAIF,mBAAoBe,GAC1BxQ,KAAM,SAAUC,GAEb3F,EAAG,qCAAuCkW,EAAQ,MAC7ChV,KAAM,SAAU5F,EAAGkL,GAEhBxG,EAAGwG,GAAOwP,KAAMrQ,EAASX,KAAK,IAC9BqB,EAAGhD,cAAce,eAAgBoC,GACjCxG,EAAGiJ,QAASlI,QAAS,sBAezC,QAASoV,GAAqBJ,GAG1B,MAAOV,GAAIP,aAAc,WAAaiB,GAAYf,KAAM,YACnDtP,KAAM,SAAUC,GAEb3F,EAAG,mCAAqC+V,EAAY,MAC/C7U,KAAM,SAAU5F,EAAGkL,GAEhBxG,EAAGwG,GAAOwP,KAAMrQ,EAASX,KAAK,IAC9BqB,EAAGhD,cAAce,eAAgBoC,GACjCxG,EAAGiJ,QAASlI,QAAS,sBA7JzC,GAAIwU,GAGAG,CAEJ,QACIF,YAAqBA,EACrBK,YAAqBA,EACrBF,aAAqBA,EACrBG,gBAAqBA,EACrBG,iBAAqBA,EACrBE,oBAAqBA,KAyJzB,aAAc,aAAc,eACjCnT,iBAaF,SAAUhD,EAAGqG,GAQVA,EAAG1O,QAAS,eAAgB,WAcxB,QAASye,GAASJ,GAEd,MAAOhT,iBAAgBvE,SAAS0T,MAAMiE,QAASJ,GAQnD,QAAS1D,GAAS+D,GAEd,MAAO,IAAIlE,GAAOkE,GAUtB,QAASlE,GAAOkE,GA8HZ,QAAS9D,GAAU+D,GAGf,MADAC,GAAMD,MAAQA,EACPre,KAGX,QAASue,GAAU7E,GAGf,MADA4E,GAAM5E,SAAWA,EACV1Z,KASX,QAASwe,GAAWC,GAOhB,MALKA,KAEDH,EAAMI,SAAW,SACjBJ,EAAMK,UAAW,GAEd3e,KASX,QAAS4U,GAAYgB,GAGjB,MADA0I,GAAM1I,QAAUA,EACT5V,KAUX,QAASwa,GAAiB9E,GAGtB,MADA4I,GAAMM,aAAelJ,EACd1V,KAUX,QAASua,GAAiB7E,GAGtB,MADA4I,GAAMO,aAAenJ,EACd1V,KAUX,QAASya,GAAWtS,GAGhB,MADAmW,GAAM7D,UAAYtS,EACXnI,KASX,QAAS0a,GAAWvS,GAGhB,MADAmW,GAAM5D,UAAYvS,EACXnI,KASX,QAAS8e,GAAchB,GAGnB,MADAQ,GAAMR,UAAYA,EACX9d,KASX,QAASkR,GAAYH,GAGjB,MADAuN,GAAMvN,QAAUA,EACT/Q,KASX,QAASsV,KAEL,GAAOgJ,EAAMF,SAETW,EAAUhX,EAAGuW,EAAMF,cAGvB,CACSD,EAASG,EAAM1I,SAEhBmJ,EAAUhU,gBAAgBvE,SAAS0T,MAAM8E,SAAUV,EAAM1I,UAIzD0I,EAAMW,IAAM,IAAMC,KAAKC,SAASla,SAAS,IAAIma,OAAO,EAAG,GACvDL,EAAUhX,EAAGgD,gBAAgB+B,gBAAiB,mBAAoBwR,IAC7DS,EAAQT,OAETS,EAAQT,MAAOA,IAIvBvW,EAAGuW,EAAMR,WAAYxE,OAAQyF,EAG7B,IAAIhR,GAAUhG,EAAGuW,EAAM1I,SAAUyJ,OAAQ,SACpCtR,GAAQlM,OAAS,GAElBkM,EAAQ9E,KAAM,SAAU5F,EAAGic,GAEvB,GAAI1W,GAAgBH,SAAS8W,cAAe,SAC5C3W,GAAQjG,KAAY,kBACpBiG,EAAQ4W,UAAYzX,EAAGuX,GAASrS,OAChClF,EAAGuW,EAAMR,WAAYxE,OAAQ1Q,KAMzCmC,gBAAgBvE,SAAS0T,MAAMuF,KAAMV,EAAST,GAC9CS,EAAQ1S,KAAM,iCAAkCyL,MAAO,WAEnD,GAAI4H,GAAQpB,EAAM7D,WAEG,oBAATiF,KAERA,GAAQ,GAGPA,GAEDtK,GAAM,KAIdrN,EAAEU,UAAUJ,GAAG,qBAAsB0W,EAAS,WAC1CT,EAAM5D,cAGV3P,gBAAgBvE,SAAS0T,MAAM5E,KAAMyJ,GAEhCT,EAAMvN,QAAU,GAEjB4O,IAUR,QAASvK,GAAMwK,GAEX7U,gBAAgBvE,SAAS0T,MAAM9E,KAAM2J,GAE/Ba,GAEFtB,EAAM5D,YASd,QAASiF,KAELE,EAAgBvB,EAAMvN,QACtB+O,GAAgB,GAAKC,OAAQC,UAE7BjP,EAAUC,OAAOE,WAAY,WAEzBF,OAAOiP,cAAetM,GACtByB,KACDkJ,EAAMvN,SAETgO,EAAQ1S,KAAM,+BAAgCY,KAAM4S,EAAgB,KACpElM,EAAW3C,OAAOkP,YAAa,WAE3B,IAAMC,EACN,CACI,GAAIC,GAAmBP,GAAgB,GAAKE,OAAQC,UAAYF,CAChEM,GAAuBlB,KAAKmB,MAAOD,EAAmB,KACtDrB,EAAQ1S,KAAM,+BAAgCY,KAAMmT,KAEzD,KAQP,QAASE,KAELH,GAAS,EACTN,IAAiB,GAAKE,OAAQC,UAAYF,EAC1C9O,OAAOC,aAAcF,GAQzB,QAASwP,KAELJ,GAAY,EACZL,GAAY,GAAKC,OAAQC,UACzBjP,EAAYC,OAAOE,WAAY,WAE3BkE,IACApE,OAAOiP,cAAetM,IACvBkM,GAQP,QAASW,KAELxP,OAAOC,aAAcF,GACrBC,OAAOiP,cAAetM,GAvY1B,GAAI2K,GAAate,IACjBse,GAAMF,SAAWA,EASjBE,EAAMW,IAAW,GASjBX,EAAMD,MAAQ,GAEdC,EAAM5E,SAAW,GASjB4E,EAAM1I,QAAU,GAShB0I,EAAMO,aAAezQ,EAAGpB,UAAW,UASnCsR,EAAMM,aAAexQ,EAAGpB,UAAW,WAUnCsR,EAAM7D,UAAY,aAWlB6D,EAAM5D,UAAY,aAWlB4D,EAAMR,UAAY,OASlBQ,EAAMvN,QAAU,GAEhBuN,EAAMlJ,KAAkBA,EACxBkJ,EAAMqB,aAAkBA,EACxBrB,EAAMkC,YAAkBA,EACxBlC,EAAMgC,aAAkBA,EACxBhC,EAAMiC,gBAAkBA,CAExB,IAAIxB,GACAhO,EAAS4C,EACTkM,EAAeC,EACfK,GAAS,CAEb,QACI7F,SAAiBA,EACjBiE,SAAiBA,EACjB3J,WAAiBA,EACjBkK,aAAiBA,EACjBtE,gBAAiBA,EACjBD,gBAAiBA,EACjBE,UAAiBA,EACjBC,UAAiBA,EACjBxJ,WAAiBA,EACjBoE,KAAiBA,EACjBF,KAAiBA,EACjBoJ,UAAiBA,GAtJzB,OACInE,QAASA,EACT8D,QAASA,MA8alBhQ,OAAQpD,iBAcV,SAAUhD,EAAGqG,GAQVA,EAAG1O,QAAS,YAAa,WA2BrB,QAASub,GAAYwF,EAAMC,GAEvB3F,IAAe0F,KAAMA,EAAME,QAASD,KAUxC,QAAS3F,GAAY6F,GACjB,GAAIC,GAAiB9Y,EAAE,OACnBA,GAAE,QAAQ+Y,IAAI,wBAAwBjf,SACxCgf,EAAiB9Y,EAAE,wBAAwB+F,WAGxCiT,GAAcF,EAAeC,IAAIC,GAAalf,QAAU,KACzDkf,EAAahZ,EAAGqG,EAAGtB,gBAAgB,0BACnC+T,EAAevH,OAAQyH,GACvB3S,EAAG5H,SAASpE,MAAMqd,KAAMsB,IAG5BhZ,EAAEkB,KAAM2X,EAAe,SAAUI,EAAKnX,GAGlCuE,EAAG5H,SAASpE,MAAM6e,SAAUF,EAAYhZ,EAAGqG,EAAGtB,gBAAiB,0BAA2BjD,OAG9FuE,EAAG5H,SAASpE,MAAMkT,KAAMyL,GAExBpF,GAAgB,GAQpB,QAASH,KAeL,MAbA0F,GAAkBA,GAAmB,IAG/BC,GAAcpZ,EAAG,QAAS+Y,IAAKK,GAAatf,QAAU,KAExDsf,EAAapZ,EAAGqG,EAAGtB,gBAAiB,+BACpC/E,EAAG,QAASuR,OAAQ6H,IAGxB/S,EAAG5H,SAAS4a,WAAW9L,KAAM6L,GAG7BD,IACOA,EASX,QAASvF,GAAgBpF,GAarB,MATA2K,MAIwB,GAAnBA,GAA0B3K,KAE3B2K,EAAkB,EAClB9S,EAAG5H,SAAS4a,WAAWhM,KAAM+L,IAE1BD,EA9FX,GACIC,GADAD,EAAkB,EAElBH,EAAkB,IAEtB,QACI9F,WAAgBA,EAChBF,YAAgBA,EAChBS,eAAgBA,EAChBG,eAAgBA,MA0FzBxN,OAAQpD,iBAWXhG,OAAO2G,OAAS,SAAU2V,EAAGC,GAEzB,GAAKD,IAAMC,EAEP,OAAO,CAEX,MAAOD,YAAatc,SAAauc,YAAavc,SAE1C,OAAO,CAEX,IAAKsc,EAAEE,cAAgBD,EAAEC,YAErB,OAAO,CAGX,KAAM,GAAIP,KAAOK,GAEb,GAAMA,EAAErb,eAAgBgb,GAAxB,CAIA,IAAMM,EAAEtb,eAAgBgb,GAEpB,OAAO,CAEX,IAAKK,EAAEL,KAASM,EAAEN,GAAlB,CAIA,GAA0B,gBAAbK,GAAEL,GAEX,OAAO,CAEX,KAAMjc,OAAO2G,OAAQ2V,EAAEL,GAAMM,EAAEN,IAE3B,OAAO,GAIf,IAAM,GAAIA,KAAOM,GAEb,GAAKA,EAAEtb,eAAgBgb,KAAUK,EAAErb,eAAgBgb,GAE/C,OAAO,CAIf,QAAO,GAGXjW,gBAAgByW,YAEZC,OAAQ,UAGZ,SAAW1Z,EAAGqG,GAGVA,EAAG5H,SAASpE,OAMRqd,KAAM,SAAUiC,GAEZ3Z,EAAG2Z,GAAQrV,KAAM,UAAWyL,MAAO,WAE/B1J,EAAG5H,SAASpE,MAAMuf,aAS1BV,SAAU,SAAUS,EAAO7X,GAEvB,GAAI+X,GAAY7Z,EAAG8B,GAAQb,KAAM,yBAE5BjB,GAAG2Z,GAAQrV,KAAM,4BAA8BuV,EAAY,MAAO/f,QAAU,GAE7EkG,EAAG2Z,GAAQrV,KAAM,wBAAyBiN,OAAQzP,IAQ1DyL,KAAM,SAAUoM,GAEZ3Z,EAAG2Z,GAAQpM,QAGfqM,QAAS,WACL5Z,EAAG,sBAAuBqN,OAC1BrN,EAAG,sBAAuBsE,KAAM,wBAAyB0R,KAAM,OAKvE5P,OAAQpD,iBACX,SAAUhD,EAAGqG,GAGVA,EAAG5H,SAAS0T,OAORuF,KAAM,SAAW7W,EAAS0V,GAEtB1V,EAAQP,GAAG,sBAAuB,gBAAiB,WAE/CiW,EAAMlJ,QACDkJ,EAAMF,WAOXE,EAAMvN,QAAU,IAGhBnI,EAAQP,GAAG,qBAAsB,gBAAiBiW,EAAMkC,aACxD5X,EAAQiZ,MAAO,WAEXvD,EAAMgC,gBACP,WAEK1X,EAAQC,GAAG,UAEXyV,EAAMiC,sBAUtBjL,KAAM,SAAW1M,GAEbA,EAAQkZ,WAAW,SAAS,SAOhC1M,KAAM,SAAWxM,GAEbA,EAAQkZ,WAAW,SAAU,UAQjC3D,QAAS,SAAWJ,GAEhB,MAAOhW,GAAEgW,GAAMsB,OAAO,iBAAkBxd,OAASkG,EAAEgW,GAAM1R,KAAK,iBAAkBxK,OAAS,GAQ7Fmd,SAAU,SAAUjB,GAEhB,GAAIO,GAAQvW,EAAGgW,EAMf,OALKO,GAAMzc,OAAS,IAEhByc,EAAQvW,EAAGgW,GAAOsB,OAAQ,kBAAqBtX,EAAGgW,GAAO1R,KAAM,kBAG5DiS,KAKhBnQ,OAAQpD,iBAEX,SAAWhD,GAGPA,EAAGU,UAAWJ,GAAI,eAAgB,SAAU2K,EAAG+O,OAS/C5T,QAEJ,SAAWpG,EAAGqG,GAGVA,EAAG5H,SAAS4a,YAMR9L,KAAM,SAAU1M,GAEZA,EAAQkK,SAAU,OAOtBsC,KAAM,SAAUxM,GAEZA,EAAQsJ,YAAa,SAK7B/D,OAAQpD,iBAUX,SAAUhD,EAAGqG,GAEVA,EAAG3B,QAAS,uBAAwB,SAAUmQ,GAM1C,QAASoF,GAAiBC,GAEtB,GAAIC,IAAiB,CAarB,OAZAD,GAAqBA,GAAgB,+BACrCla,EAAGka,GAAe5C,OAAQ,wCAAyCpW,KAAM,SAAU5F,EAAG0W;AAElF,GAAIoI,GAAiB,GAAIC,GAAerI,GACpCsI,EAAiBta,EAAGgS,GAAO/Q,KAAM,8BAA+BvI,QAAS,MAAO,IAAKyB,MAAO,IAC1FigB,GAAcG,QAASD,KAEzBH,GAAiB,KAKlBA,EAGX,QAASE,GAAerI,GAkBpB,QAASuI,GAASC,GAGd,MAAKC,MAEM,GAGXC,EAAiB,GAAIC,GAAaC,EAAMC,iBACxCP,EAAiBE,EAEjBM,IAE4C,GAArCJ,EAAYK,eAAejhB,QAGtC,QAASghB,KAEL9a,EAAG,oBAAqBgb,QAGxB,KAAM,GADFC,IAAwB,EAClB3f,EAAI,EAAGA,EAAIgf,EAAexgB,OAAQwB,IAElC4f,EAAeZ,EAAehf,GAAI2f,KAEpCL,EAAM7Z,QAAS,oBACfka,GAAwB,EAI3BP,GAAYS,eAAgBC,EAAQC,QAAQlU,QAAgD,GAArCuT,EAAYK,eAAejhB,QAEnFshB,EAAQC,QAAQlR,YAAa,SAC7ByQ,EAAMtW,KAAM,cAAgB8W,EAAQC,QAAQpa,KAAM,MAAS,MAAOkJ,YAAa,SAE/EiR,EAAQC,QAAQtQ,SAAU,WAC1B6P,EAAMtW,KAAM,cAAgB8W,EAAQC,QAAQpa,KAAM,MAAS,MAAO8J,SAAU,aAI5EqQ,EAAQC,QAAQlR,YAAa,WAC7ByQ,EAAMtW,KAAM,cAAgB8W,EAAQC,QAAQpa,KAAM,MAAS,MAAOkJ,YAAa,WAE/EiR,EAAQC,QAAQtQ,SAAU,SAC1B6P,EAAMtW,KAAM,cAAgB8W,EAAQC,QAAQpa,KAAM,MAAS,MAAO8J,SAAU,UAIpF,QAASmQ,GAAejC,EAAKgC,GAEzB,GAAIK,GAAYZ,EAAYa,QAAStC,EAOrC,OALOuC,GAAqBvC,IAExBuC,EAAqBvC,GAAK+B,SAGxBI,EAAQnC,GAKW,GAApBqC,EAAUxhB,QAEXshB,EAAQnC,GAAK9R,IAAKmU,EAAU,IAE5BF,EAAQnC,GAAK9O,YAAa,SAC1ByQ,EAAMtW,KAAM,cAAgB8W,EAAQnC,GAAKhY,KAAM,MAAS,MAAOkJ,YAAa,SAE5EiR,EAAQnC,GAAKlO,SAAU,WACvB6P,EAAMtW,KAAM,cAAgB8W,EAAQnC,GAAKhY,KAAM,MAAS,MAAO8J,SAAU,YAClE,IAIPqQ,EAAQnC,GAAK9O,YAAa,WAC1ByQ,EAAMtW,KAAM,cAAgB8W,EAAQnC,GAAKhY,KAAM,MAAS,MAAOkJ,YAAa,WAE5EiR,EAAQnC,GAAKlO,SAAU,SACvB6P,EAAMtW,KAAM,cAAgB8W,EAAQnC,GAAKhY,KAAM,MAAS,MAAO8J,SAAU,SAEnEkQ,GAEFQ,EAAqBL,EAAQnC,GAAMqC,GAEvCF,EAAQnC,GAAKjO,IAAK,SAClBoQ,EAAQnC,GAAKyC,SACN,IA5BA,EAiCf,QAASC,GAAwBnR,EAASoR,GAEtCJ,EAAqBI,GAAexO,KAChCyO,MAASrR,EAAQsR,YAAY,GAC7BC,KAASvR,EAAQwR,WAAWD,KAC5BE,IAASzR,EAAQwR,WAAWC,IAAMzR,EAAQoF,aAAa,KAI/D,QAAS6L,GAAqBjR,EAAS0R,GAEnC,GAAIN,GAAgBpR,EAAQvJ,KAAM,OAGlCua,GAAqBI,GAAiB5b,EAAGqG,EAAGtB,gBAAiB,yCAA0CmX,OAAQA,KAE/GP,EAAwBnR,EAASoR,GAEjC5b,EAAGiJ,QAAS3I,GAAI,aAAc,WAE1Bqb,EAAwBnR,EAASoR,KAIrCJ,EAAqBI,GAAetX,KAAM,wBAAyBpD,KAAM,SAAU5F,EAAGkL,GAGlF,GAAItG,GAAQF,EAAGwG,GACX3L,EAAQqF,EAAMe,KAAM,qBAExBf,GAAM6P,MAAO,WAGTvF,EAAQrD,IAAKtM,EAGb,IAAIshB,KACJA,GAAc3R,EAAQvJ,KAAM,SAAYpG,EACxC6f,EAAYpD,OAAQ6E,GAGpBrB,QAORtQ,EAAQ3N,SAAS0U,OAAQiK,EAAqBI,IAGlD,QAASnB,KAEL,MAA+C,eAAtCW,EAAQgB,OAAOjV,MAAMkV,eAAwE,eAAtCjB,EAAQgB,OAAOjV,MAAMkV,cAjKzF,GASI3B,GACAJ,EAVAM,EAAuB5a,EAAGgS,GAC1BoJ,GACAgB,OAASxB,EAAMtW,KAAM,wBACrBgY,IAAS1B,EAAMtW,KAAM,qBACrBiY,KAAS3B,EAAMtW,KAAM,sBACrB+W,QAAST,EAAMtW,KAAM,0BAErBkX,IAKJ,QACIjB,QAASA,GAyJjB,QAASI,GAAa6B,GAalB,QAAS9E,KAEL7C,EAAInR,IAAK,gDACL+Y,eAAgB,gBAChBC,OAAgBF,EAAaJ,OAC7BE,IAAgBE,EAAaF,IAC7BK,KAAgBH,EAAaD,KAC7BK,QAAgBJ,EAAanB,QAC7BwB,QAAgBL,EAAaM,YAC9B,GAAO,GAAO,GAAOpX,KAAM,SAAUC,GAKpC,IAAM,GAFFoX,GAAiBpX,EAASX,KAAKlL,OAEzBwB,EAAI,EAAOyhB,EAAJzhB,EAAoBA,IACrC,CACI,GAAI0hB,GAAkBrX,EAASX,KAAK1J,GAEhC2hB,EAAUC,EAAYF,EACpBC,GAOFA,EAAQ5B,QAAQ5f,KAAMuhB,EAAgB3B,UALtC2B,EAAgB3B,SAAW2B,EAAgB3B,SAC3C8B,EAAU1hB,KAAMuhB,OAYhC,QAASE,GAAYE,GAIjB,IAAM,GAFFC,GAAeF,EAAUrjB,OAEnByF,EAAI,EAAO8d,EAAJ9d,EAAkBA,IAE/B,GAAK6d,EAAWhB,QAAUe,EAAU5d,GAAG6c,QAAUe,EAAUb,KAAOa,EAAU5d,GAAG+c,KAAOc,EAAWb,MAAQY,EAAU5d,GAAGgd,KAElH,MAAOY,GAAU5d,EAIzB,OAAO,MAIX,QAASwb,KAEL,MAAOoC,GAGX,QAAS5B,GAAStC,GAKd,IAAM,GAHFqE,MACAD,EAAeF,EAAUrjB,OAEnBwB,EAAI,EAAO+hB,EAAJ/hB,EAAkBA,IACnC,CACI,GAAI2hB,GAAUE,EAAU7hB,EACnB0E,GAAE6C,QAASoa,EAAQhE,GAAMqE,GAAY,GAEtCA,EAAQ7hB,KAAMwhB,EAAQhE,IAI9B,MAAOqE,GAGX,QAAShG,GAAQ6E,GAKb,IAAM,GAHFoB,MACAF,EAAoBF,EAAUrjB,OAExBwB,EAAI,EAAO+hB,EAAJ/hB,EAAkBA,IACnC,CACI,GAAI2hB,GAAUE,EAAU7hB,IAChB6gB,EAAcC,QAAUD,EAAcC,QAAUa,EAAQb,QACtDD,EAAcG,KAAOH,EAAcG,KAAOW,EAAQX,KAClDH,EAAcI,MAAQJ,EAAcI,MAAQU,EAAQV,OAE1DgB,EAAkB9hB,KAAMwhB,GAIhCE,EAAYI,EAGhB,QAASpC,GAAgByB,GAErBA,EAAUnZ,SAAUmZ,EAIpB,KAAM,GAFFS,GAAeF,EAAUrjB,OAEnBwB,EAAI,EAAO+hB,EAAJ/hB,EAAkBA,IAI/B,IAAM,GAFF2hB,GAAUE,EAAU7hB,GAEdiE,EAAI,EAAGA,EAAI0d,EAAQ5B,QAAQvhB,OAAQyF,IAC7C,CACI,GAAIie,GAAQP,EAAQ5B,QAAQ9b,GAAGpF,MAAO,IACtC,IAAuB,GAAhBqjB,EAAM1jB,QAAe8iB,GAAWY,EAAM,IACtB,GAAhBA,EAAM1jB,QAAe8iB,GAAWY,EAAM,IAAMZ,GAAWY,EAAM,GAEhE,OAAO,EAKnB,OAAO,EA3HX,GAAIL,KAIJ,OAFAzF,MAGIqD,aAAgBA,EAChBQ,QAAgBA,EAChBjE,OAAgBA,EAChB6D,eAAgBA,GAxMxB,OACIlB,gBAAiBA,KA8TrB,gBACL7T,OAAQpD,iBAcV,SAAUhD,EAAGqG,GAaVA,EAAG3B,QAAS,wBAAyB,SAAUmQ,EAAKS,EAAUpD,GAkB1D,QAASuL,KAGL,GAAIzL,GAAOhS,EAAG,4CAEd,IAAKgS,EAAK0L,eACV,CAEI,GAAIxB,GAASlK,EAAK6I,gBAEdxa,GACAsd,MAAOzB,EAAOyB,MAGlB,OAAO9I,GAAIJ,KAAM,+BAAgCpU,GAC5CqF,KAAM,SAAUC,GAEoB,GAA5BA,EAASX,KAAK4Y,aAEf5d,EAAG,sDAAuDqN,OAC1DrN,EAAG,uDAAwDuN,WAgB/E,QAAS7G,GAAesL,GAEpB,GAAKA,EAAK0L,eACV,CACI,GAAIxB,GAASlK,EAAK6I,gBAEdxa,GACAsd,MAAUzB,EAAO2B,UACjBC,SAAU5B,EAAO6B,cAIrB,OADA7L,GAAGuB,iBACIoB,EAAIJ,KAAM,wBAAyBpU,GACrCqF,KAAM,WAGHuD,OAAO4C,SAASC,OAAQkG,EAAK/Q,KAAM,cAcnD,QAAS+c,GAAmBC,GAGxB,MAAOpJ,GAAIJ,KAAM,yCAA0CwJ,GACtDvY,KAAM,SAAUC,GAEb2P,EAASE,cAAc0I,uBAAyBvY,EAASX,OAarE,QAASmZ,KAEL,GAAInM,GAAOhS,EAAG,qDAEd,IAAKgS,EAAK0L,gBAAkBrX,EAAGhD,cAAc+a,qBAAqBnE,kBAClE,CACI,GAAIiC,GAAelK,EAAK6I,gBACpBwD,EAAere,EAAGgS,GAAO1N,KAAM,iCAGnC,IAFA4X,EAAOoC,UAAY,EAEdpC,EAAOxG,UACLwG,EAAOxG,SAAS6I,wBAChBrC,EAAOxG,SAAS6I,uBAAuBC,iBAC9C,CACI,GAAIC,GAA4BvC,EAAOxG,SAAS6I,uBAAuBC,gBACvEtC,GAAOwC,uBAAyBxC,EAAOwC,0BAEvC,KAAM,GAAIC,KAAYF,GAEbA,EAAcE,IAEfzC,EAAOwC,uBAAuBjjB,MAC1BmjB,WAAeD,EACfE,cAAeJ,EAAcE,SAKxC,IAAKN,EAAWvkB,OAAS,EAC9B,CACIoiB,EAAOwC,yBACP,KAAM,GAAIpjB,GAAI+iB,EAAWvkB,OAAS,EAAGwB,GAAK,EAAGA,IAC7C,CACI,GAAIwjB,GAAS9e,EAAGqe,EAAW/iB,GAC3B4gB,GAAOwC,uBAAuBjjB,MAEtBmjB,WAAeE,EAAO7d,KAAM,2BAC5B4d,cAAeC,EAAO3X,SAKtC,MAAO6W,GAAmB9B,GACrBxW,KAAM,WAEHuD,OAAO4C,SAASC,OAAQkG,EAAK/Q,KAAM,cAjJnD,OACIwc,cAAmBA,EACnB/W,cAAmBA,EACnBsX,kBAAmBA,EACnBG,iBAAmBA,KAiJvB,aAAc,kBAAmB,eAEtC/X,OAAQpD,iBAaV,SAAUhD,EAAGqG,GAgBVA,EAAG3B,QAAS,gBAAiB,SAAUmQ,EAAK3C,EAAImD,EAAKC,EAAUnD,GAuB3D,QAASvL,GAAemY,GAGbA,IAGE/e,EAAG,qCAAsCsE,KAAM,6BAA8BxK,OAAS,EAGvFklB,EAAYC,EAAiBF,IAI7BlK,EAAInR,IAAK,4BAA8B,0BAA0BrB,cAAgB,KAEzE6c,OAAUH,EAAQ,GAAGzX,iBACrB6X,SAAUJ,EAAQ,GAAGvX,qBACtB,GAAO,GAAO9B,KAAM,SAAU0Z,GAG5BA,EAAKpa,KAAK,GAAG3G,QAAS,cAAiB,EAExC8T,EAAMG,UACDzF,WAAYuS,EAAKpa,KAAK,IACtBuN,SAAUlM,EAAGpB,UAAW,4BACxBwN,gBAAiBpM,EAAGpB,UAAW,SAC/ByN,UAAW,WAGR,MAAK1S,GAAG,iDAAkD0d,gBAGtDsB,EAAYC,EAAiBF,KAGtB,IAIA,IAGdxR,OAILyR,EAAYD,MAchC,QAASE,GAAiBI,GA2BtB,QAASC,GAAW1kB,EAAM2kB,GAKtB,GAHA3O,EAAW5Q,EAAGuf,GACdC,EAAW5O,EAAM3P,KAAM,SAEJ,YAAZue,GAA0B5O,EAAM9P,GAAI,aAC1B,SAAZ0e,GAAuB5O,EAAM9P,GAAI,aACrB,SAAZ0e,GAAmC,YAAZA,IAAwC,QAAZA,GAAkC,UAAZA,EAC9E,CAEI,GAAc,eAAT5kB,EAED,GAAI+C,GAAQiT,EAAM,GAAG5S,KAAKL,MAAO,+BAErC,IAAc,oBAAT/C,EAED,GAAI+C,GAAQiT,EAAM,GAAG5S,KAAKL,MAAO,oCAErC0hB,GAAoBI,EAAoBJ,EAAmB1hB,EAAM,GAAIA,EAAM,GAAIiT,EAAMzJ,WAGpF,IAAiB,QAAZqY,EAEN,GAAK5O,EAAM,GAAG8O,OAAS9O,EAAM,GAAG8O,MAAM5lB,OAAS,EAE3CulB,EAAoBM,EAAsB/O,EAAOyO,OAGrD,CACI,GAAc,eAATzkB,EAED,GAAI+C,GAAaiT,EAAM,GAAG5S,KAAKL,MAAO,oCAClCiiB,EAAa5f,EAAG,yCAA2CrC,EAAM,GAAK,KAAOA,EAAM,GAAK,OAAQwJ,KAExG,IAAc,oBAATvM,EAED,GAAI+C,GAAaiT,EAAM,GAAG5S,KAAKL,MAAO,yCAClCiiB,EAAa5f,EAAG,kDAAoDrC,EAAM,GAAK,KAAOA,EAAM,GAAK,OAAQwJ,KAGjHkY,GAAoBI,EAAoBJ,EAAmB1hB,EAAM,GAAIA,EAAM,GAAIiiB,IAhE3F,GAGIjiB,GAHAkiB,EAAkB7f,EAAG,iDACrB4Q,KACA4O,EAAkB,EAmEtB,OA/DAK,GAAgBvb,KAAM,wBAAyBpD,KAAM,WAEjDvD,EAAoB1F,KAAK+F,KAAKL,MAAO,gCACrC0hB,EAAoBI,EAAoBJ,EAAmB1hB,EAAM,GAAIqC,EAAG/H,MAAOkP,MAAOnH,EAAG/H,MAAOkP,SAIpG0Y,EAAgBvb,KAAM,wBAAyBpD,KAAM,WAEjDoe,EAAW,aAAcrnB,QAI7B+H,EAAG,0CAA2CsE,KAAM,6BAA8BpD,KAAM,WAEpFoe,EAAW,kBAAmBrnB,QAgD3BonB,EAGX,QAASL,GAAYD,GAEjBlK,EAAIJ,KAAM,kCAAmCsK,GAAS,GACjDrZ,KAAM,WAGH4P,EAASK,eACJjQ,KAAM,WAEH,GAAIoa,GAAqB9f,EAAG,4BACxB+f,EAAqBhB,EAAQ,GAAGxX,kBAChCyY,GAAsBC,UAAWlB,EAAQ,GAAGzX,iBAE3CwY,GAAS3Y,MAAQ,EAElB2Y,EAAS5e,KAAM,SAAU5F,EAAGT,GAExBA,EAAoCmF,EAAGnF,GACvCmlB,EAAYnlB,EAAMoG,KAAM,SAAYpG,EAAMsM,QAGxC4Y,GAAsBA,EAAqB,IAEjDC,EAA+B,kBAAID,GAGvCG,IAGA7K,EAAIP,aAAc,0CAA2CkL,GAAchL,KAAM,YAC5EtP,KAAM,SAAUC,GAEb,GAAIqD,GAAU3C,EAAGrC,UAAW,6BAA8B,KACtDuS,EAAUpE,EAAMG,UAAUzF,WAAYlH,EAASX,KAAK,GAEnDgE,GAAU,GAEXuN,EAAMpN,WAAYH,GAGtBuN,EAAMhJ,aAGtB5E,KAAM,SAAUkK,GAGpBX,EAAGc,YAAaiB,KAAK1V,MAAOsU,EAAMC,cAAehR,MAAMmR,eAI/D,QAASkN,GAAepB,GAEpBlK,EAAIH,IAAK,kCAAmCqK,GACvCrZ,KAAM,WAGH4P,EAASW,iBAAkB5P,EAAGrC,UAAW,gBACzCsR,EAASK,eACJjQ,KAAM,WAEHwa,QAKpB,QAASP,GAAsBS,EAAQf,GAEnC,GAGIgB,GACAC,EAJArH,EAAwBmH,EAAO,GAAG3S,GAClC8S,KACAC,KAGAngB,GACAzF,KAAa,OACboK,QACA8O,QAAa,EACbnX,OAAa,EACb8I,SAAa,OACbsO,aAAa,EACbC,aAAa,EAGjBuM,GAAsBtH,GAAOmH,EAAO,GAAGV,MAGM,IAAxCc,EAAsBniB,QAAS4a,IAEhCuH,EAAsB/kB,KAAMwd,EAGhC,KAAM,GAAI3d,GAAI,EAAGxB,EAAS0mB,EAAsB1mB,OAAYA,EAAJwB,IAAcA,EAElE+kB,EAAW,GAAII,UACfH,EAAWC,EAAsBC,EAAsBllB,IACvD+kB,EAAS9O,OAAQ,IAAK+O,EAAS,GAAIA,EAAS,GAAGtiB,MAE/CqC,EAAO2E,KAAOqb,EAEdxL,EAAIJ,KAAM,iCAAkCpU,EAGhD,IAAI1C,GAAQyiB,EAAO,GAAGpiB,KAAKL,MAAO,mCAMlC,OALMA,KAEFA,EAAQyiB,EAAO,GAAGpiB,KAAKL,MAAO,0CAG3B8hB,EAAoBJ,EAAmB1hB,EAAM,GAAIA,EAAM,GAAI4iB,EAAsBtH,GAAK,GAAS,MAa1G,QAASwG,GAAoBiB,EAAY1E,EAAU2E,EAASf,GAwBxD,MAtBK5D,GAAW,GAA6Bld,QAAxB4hB,EAAW1E,KAE5B0E,EAAW1E,GAAsChc,EAAE4V,QAAQ,KAAU8K,EAAW,IAChFA,EAAW1E,GAAU4E,8BAGI9hB,QAAxB4hB,EAAW1E,KAEZ0E,EAAW1E,GAAUxU,mBAAqB,EACa1I,QAAlD4hB,EAAW1E,GAAU4E,4BAEtBF,EAAW1E,GAAU4E,8BAEpBhB,GAEDc,EAAW1E,GAAU4E,0BAA0BnlB,MAC3ColB,uBAA2BF,EAC3BG,0BAA2BlB,KAKhCc,EAGX,QAASK,GAAoBC,GAEzB,GAAIzK,GAAQvW,EAAG,6BAA+BghB,EAAe,KAC7DzK,GAAMwD,WAAW,SAAS,QAC1BxD,EAAMjS,KAAM,iCAAkChE,GAAI,QAAS,WAEvD,GAAIsI,GAAiBqY,EAAeD,GAChCrZ,IAGJ4O,GAAMjS,KAAM,iEAAkEpD,KAAM,SAAU5F,EAAG4lB,GAE7F,GAAIvjB,GAAQujB,EAAgBljB,KAAKL,MAAO,yCACnCA,IAASA,EAAM,IAEhBgK,EAAelM,MACXoM,sBAA4BlK,EAAM,GAClCmK,2BAA4B9H,EAAGkhB,GAAkB/Z,UAM/B,GAAzBQ,EAAe7N,SAEhB8O,EAAWb,yBAA2BJ,GAG1CwY,GAAgBvX,MAKxB,QAASuY,GAAiBH,GAGtB,GAAIpY,GAAaqY,EAAeD,EAGhCpY,GAAWgY,6BAEX/L,EAAInR,IAAK,4BAA8B,0BAA0BrB,cAAgB,KAC7E6c,OAActW,EAAWtB,iBACzB6X,SAAcvW,EAAWpB,mBACzBkB,aAAcsY,IACdtb,KAAM,SAAU0Z,GAGhBjN,EAAMG,UACDzF,WAAYuS,EAAKpa,KAAK,IACtBuN,SAAUlM,EAAGpB,UAAW,0BACxBwN,gBAAiBpM,EAAGpB,UAAW,SAC/ByN,UAAW,WAGR,MAAK1S,GAAG,iDAAkD0d,gBAGtDyC,EAAelB,GAAkBrW,MAG1B,IAIA,IAGd2E,SAIb,QAAS0T,GAAeD,GAGpB,IAAM,GADFI,GAAc9L,EAASE,cAAc6L,gBAC/B/lB,EAAI,EAAGA,EAAI8lB,EAAYtnB,OAAQwB,IAErC,GAAK8lB,EAAY9lB,GAAG0lB,cAAgBA,EAEhC,MAAOI,GAAY9lB,EAI3B,OAAO,MAUX,QAASgmB,GAAkBN,EAAcO,GASrC,QAASC,KAEL3M,EAAAA,UAAY,wDAA0DmM,GACjEtb,KAAM,WAEH4P,EAASK,eAAejQ,KAAM,YAIpB4P,EAASE,cAAc6L,iBAAmB/L,EAASE,cAAc6L,gBAAgBvnB,QAAU,EAE7Fwb,EAASW,iBAAkB5P,EAAGrC,UAAW,iBAMgC,IAApEhE,EAAG,qDAAsDlG,OAE1D+a,EAAInR,IAAK,qDAAsDgC,KAAM,SAAUC,GAE3E,GAAI8b,GAAuBzhB,EAAG,yBAA0BgH,QAAS,MAC7D0a,EAAuBD,EAAeza,QAAS,cACnDya,GAAeE,QAAS,WAEpB3hB,EAAG/H,MAAOoT,SAAU,2CAA4C2P,SAChEhb,EAAG/H,MAAO+iB,SACV0G,EAAqBE,QAAS5hB,EAAG2F,EAASX,KAAK,KAAOqI,OAAOwU,OAAQ,WAEjExb,EAAGhD,cAAce,eAAgBsd,SAO7CpM,EAASQ,gBAAiB,mBAE9BR,EAASQ,gBAAiB,WAG9BoK,IAEA4B,EAASvN,cAjDzB,GAAIuN,GAAW9hB,EAAEsU,WAGbyN,EAAWd,EAAeD,GAAegB,kBAAkB,EA2E/D,OAxBMT,GAqBFC,IAlBArP,EAAMG,UACDC,SAAUlM,EAAGpB,UAAW,mBACxB4H,WAAY,MAAQxG,EAAGpB,UAAW,6DAAgEgd,KAAMF,IAAc,QACtHpP,UAAW,WAIRmP,EAASI,WAEZxP,UAAW,WAER8O,MAEH/O,gBAAiBpM,EAAGpB,UAAW,WAC/BsI,OAOFuU,EAUX,QAASrZ,GAAiBuY,EAAcxZ,GAGpC,GAA2B,GAAtBA,EAED,MAAO8Z,GAAkBN,EAQ7B,KAAM,GAHFpY,GACAuZ,EAHAL,EAAW9hB,EAAEsU,WACbjU,EAAWiV,EAASE,cAAc6L,gBAI5B/lB,EAAI,EAAGA,EAAI+E,EAAOvG,OAAQwB,IAEhC,GAAK+E,EAAO/E,GAAG0lB,cAAgBA,EAC/B,CACImB,EAAkB7mB,EAClBsN,EAAkBvI,EAAO/E,EACzB,OAKR,MAAOsN,IAAcA,EAAWpB,oBAAsBA,GAElDnH,EAAO8hB,GAAiB3a,mBAAqB/D,SAAU+D,GAEhDqN,EAAIJ,KAAM,kCAAmCpU,GAC/CqF,KAAM,WAEH4P,EAASO,cAAcnQ,KAAM,WAEzB4P,EAASW,iBAAkB5P,EAAGrC,UAAW,gBACzCkc,IACA4B,EAASvN,cAEb5L,KAAM,SAAShD,GAEjB2P,EAASW,iBAAkB5P,EAAGrC,UAAW,gBACzCkc,IACA4B,EAASvN,aAIZuN,EAQX,QAAS5B,KAGL5K,EAASa,oBAAqB,qBACzBzQ,KAAM,WAGH1F,EAAG,8BAA+BkB,KAAM,SAAU5F,EAAGkL,GAEjD,GAAIuK,GAAc/Q,EAAGwG,GAAOvF,KAAM,2BAC7BqU,GAASE,cAAc6L,gBAAgBvnB,QAAU,EAElDkG,EAAGwG,GAAOuE,SAAUgG,GAIpB/Q,EAAGwG,GAAO2D,YAAa4G,MAOvC,IAAIqR,GAAoB,CACxBpiB,GAAEkB,KAAMoU,EAASE,cAAc6L,gBAAiB,SAAU/lB,EAAGsN,GAEzDwZ,GAAqB5Z,EAAgBI,EAAWpB,sBAGpDxH,EAAG,kDAAkDkF,KAAMoQ,EAASE,cAAc6L,gBAAgBvnB,QAClGkG,EAAG,oDAAqDkF,KAAMkd,GAC9DpiB,EAAG,gDAAiDkF,KAAMoQ,EAASE,cAAc6M,OAAOC,eAG5F,QAAS9Z,GAAeY,GAEpB,MAAkB,gBAANA,GAEDA,GAEXA,EAAIA,EAAE1Q,QAAQ,IAAK,MACfyJ,MAAMC,WAAWgH,KAAOC,SAASD,GAE1BhH,WAAWgH,GAEf,GAWX,QAASmZ,GAAUjhB,GAEf,GAAIkhB,GAAcxiB,EAAG,2CACA,oBAAVsB,IACLtB,EAAEsB,GAAO0F,QAAQ,4CAA4ClN,SAC/D0oB,EAAcxiB,EAAEsB,GAAO0F,QAAQ,4CAA4C1C,KAAK,4CAIpF,IAAIjE,IACAoiB,uBAAwBD,EAAYrb,MAGxC,OAAO0N,GAAIJ,KAAM,yBAA0BpU,GACtCqF,KAAM,WAEH4P,EAASO,cACJnQ,KAAM,WAGHgd,QAWpB,QAASC,KAEL,GAAItiB,IACAoiB,uBAAwBnN,EAASE,cAAcoN,OAAOH,uBAG1D,OAAO5N,GAAAA,UAAY,yBAA0BxU,GACxCqF,KAAM,WAEH4P,EAASO,cACJnQ,KAAM,iBAEI4P,GAASE,cAAcoN,OAE9BF,QAMpB,QAASA,KAELpN,EAASQ,gBAAiB,UAErB9V,EAAG,4CAA6ClG,OAAS,GAE1Dwb,EAASQ,gBAAiB,UAWlC,QAAS9N,GAAalB,GAElB,MAAO+N,GAAIH,IAAI,2BAA4B5N,GACtCpB,KAAM,WAEHgd,MA5pBZ,OACIza,QAAoBrB,EACpBic,WAAoBvB,EACpBzY,QAAoBoY,EACpBxY,gBAAoBA,EACpBsY,mBAAoBA,EACpBI,gBAAoBA,EACpBoB,UAAoBA,EACpBI,aAAoBA,EACpB3a,aAAoBA,KAupBxB,aAAc,YAAa,aAAc,kBAAmB,kBACjE5B,OAAQpD,iBAcV,SAAUhD,EAAGqG,GAeVA,EAAG3B,QAAS,kBAAmB,SAAUmQ,EAAK3C,EAAImD,EAAKC,EAAUnD,GAsB7D,QAASuF,KAELpC,EAASK,cAAc,GAU3B,QAASmN,KAEL,GAAI9Q,GAAShS,EAAG,yCACZkc,EAASlK,EAAK6I,eAYlB,OATMvF,GAASE,cAAcuN,uBAEzBzN,EAASE,cAAcuN,qBAAuB,IAE5CzN,EAASE,cAAcwN,wBAEzB1N,EAASE,cAAcwN,sBAAwB,IAG5C1N,EAASE,cAAcuN,uBAAyB7G,EAAO+G,cAAgBjjB,EAAGgS,GAAO1N,KAAM,yBAA0BxK,OAAS,GACxHwb,EAASE,cAAcwN,wBAA0B9G,EAAOgH,eAAiBljB,EAAGgS,GAAO1N,KAAM,0BAA2BxK,OAAS,GAGlIwb,EAASE,cAAcuN,qBAAwB7G,EAAO+G,aACtD3N,EAASE,cAAcwN,sBAAwB9G,EAAOgH,cAE/C5N,EAASO,eAMThB,EAAID,OAYnB,QAASuO,GAAqBzF,GAE1B,GAAI1L,GAAOhS,EAAG,gDAEd,KAAM0d,IAAiB1L,EAAK0L,eAExB,OAAO,CAGX,KAAMA,IAAiBrX,EAAGhD,cAAc+a,qBAAqBnE,gBAAiBjI,GAE1E,OAAO,CAGX,IAAIkK,GAAoBlK,EAAK6I,gBACzBuI,EAAoBpjB,EAAG,sCAAuCmH,KAIlE,IAFA6K,EAAK+H,WAAW,SAAU,SAED,EAApBqJ,EACL,CAEI,GAAIC,GAAkBnH,CAEtB,OAAMoH,GAAmBD,EAAiB/N,EAASE,cAAc+N,yBA2BtD1O,EAAID,QAzBoB,eAA1ByO,EAAgBjH,QAEjBiH,EAAgBG,cAAgB,EAChCH,EAAgBI,cAAgBJ,EAAgBhI,SAEhB,eAA1BgI,EAAgBjH,SAEtBiH,EAAgBK,cAAgB,EAChCL,EAAgBM,aAAgBN,EAAgBhI,SAI7CxG,EAAIJ,KAAM,0CAA2C4O,GACvD3d,KAAM,SAAUC,GAGb2P,EAASE,cAAcoO,kCAAoCje,EAASX,KAAK6e,GACzEvO,EAASE,cAAcsO,0BAAoCne,EAASX,KAAK8X,UAEzEiH,OAYZ,MAAKX,IAAqB9N,EAASE,cAAcoO,kCAStC/O,EAAID,QANXU,EAASE,cAAcoO,kCAAoCR,MAE3DW,MASZ,QAASA,KAKL,aAHOzO,GAASE,cAAcwO,gCACvB1O,GAASE,cAAcyO,0BAEvB3O,EAASO,cAAcnQ,KAAM,WAEhC4P,EAASQ,gBAAiB,wBAC1BR,EAASQ,gBAAiB,wBAEsC,GAA3DR,EAASE,cAAc0I,uBAAuBI,WAE/ChJ,EAASQ,gBAAiB,6BAYtC,QAASoO,KAEL,GAAIlS,GAAOhS,EAAG,mDAEVie,EAAuBjM,EAAK6I,gBAC5BwD,EAAuBre,EAAGgS,GAAO1N,KAAM,iCAI3C,IAHA2Z,EAAeK,UAAY,EAGtBL,EAAevI,UACbuI,EAAevI,SAAS6I,wBACxBN,EAAevI,SAAS6I,uBAAuBC,iBACtD,CACI,GAAIC,GAAoCR,EAAevI,SAAS6I,uBAAuBC,gBACvFP,GAAeS,uBAAyBT,EAAeS,0BAEvD,KAAM,GAAIC,KAAYF,GAEbA,EAAcE,IAEfV,EAAeS,uBAAuBjjB,MAClCmjB,WAAeD,EACfE,cAAeJ,EAAcE,SAKxC,IAAKN,EAAWvkB,OAAS,EAC9B,CACImkB,EAAeS,yBACf,KAAM,GAAIpjB,GAAI+iB,EAAWvkB,OAAS,EAAGwB,GAAK,EAAGA,IAC7C,CACI,GAAIwjB,GAAS9e,EAAGqe,EAAW/iB,GAC3B2iB,GAAeS,uBAAuBjjB,MAE9BmjB,WAAeE,EAAO7d,KAAM,2BAC5B4d,cAAeC,EAAO3X,SAKtC,MAAMmc,GAAmBrF,EAAgB3I,EAASE,cAAc0I,wBAUrDiF,IARAtO,EAAIJ,KAAM,yCAA0CwJ,GACtDvY,KAAM,SAAUC,GAEbwd,IAAsBzd,KAAM4P,EAASK,gBAiBrD,QAAS2N,GAAmBa,EAAUC,GAElC,IAAM,GAAInL,KAAOkL,GAEb,GAAKA,EAASlL,GAAO,IAAOmL,EAASnL,GAAO,IAAc,gBAARA,EAE9C,OAAO,CAGf,QAAO,EAUX,QAASoL,KAGL,GAAInI,GAASlc,EAAG,uDAAwD6a,eAMxE,OAJAvF,GAASE,cAAcyO,0BAA4B/H,EAAOoI,wBACnDhP,GAASE,cAAcoO,wCACvBtO,GAASE,cAAcwO,0BAEvB1O,EAASO,cACXnQ,KAAM,WAEH4P,EAASQ,gBAAiB,0BAWtC,QAASyO,KAEL,GAAI/a,GAAc8L,EAASE,cAAcwO,0BACrCQ,EAAcxkB,EAAG,wDAA0DwJ,EAAY,MAAO3M,SAASge,eAC3G,OAAOhG,GAAIJ,KAAM,iCAAkC+P,GAAa,GAC3D9e,KAAM,SAAUC,GAEb,GAAyD,IAApDA,EAASX,KAAKyf,mCAGf/jB,SAASmL,SAASC,OAAQnG,EAASX,KAAKyf,wCAGvC,IAAO9e,EAASX,KAAK0f,yCAC1B,CAEI,GAAIC,GAAgB3kB,EAAG2F,EAASX,KAAK0f,0CAA2CpgB,KAAM,6CAA8CxK,OAAS,CAC7IqY,GAAMG,UACDzF,WAAYlH,EAASX,KAAK0f,0CAC1BhS,UAAW,WAER,MAAKiS,GAEMC,IAIAC,MAGdtX,UAGZ5E,KAAM,SAAUkK,GAEb,IAKI,IAAM,GAHFlN,GAAW3F,EAAE+S,UAAWF,EAAMC,cAE9BgS,KACMxpB,EAAI,EAAGA,EAAIqK,EAAS7D,MAAMmR,YAAYnZ,OAAQwB,IAET,KAAtCqK,EAAS7D,MAAMmR,YAAY3X,GAAGod,KAG/BpD,EAASQ,gBAAiB,wBAAyBpQ,KAAM,WAErD1F,EAAGU,UAAWK,QAAS,mCAK3B+jB,EAAWrpB,KAAMkK,EAAS7D,MAAMmR,YAAY3X,GAK/CwpB,GAAWhrB,OAAS,GAErBoY,EAAGc,YAAa8R,GAGxB,MAAQ7Z,GAEJiH,EAAGgB,WAAYL,EAAMM,OAAQN,EAAMO,eAcnD,QAAS7J,GAAoBC,GAwBzB,GATMA,IAGFA,EAAYxJ,EAAG,2CAA4CmH,OAG/DmO,EAASE,cAAcwO,0BAA4Bxa,EAG9CxJ,EAAG,4CAA6ClG,OAAS,EAC9D,CACI,GAAIirB,GAA6C/kB,EAAG,2CACpDsV,GACKE,cACAwP,gCACAC,0CAA4CF,EAAIjkB,GAAI,YAY7D,MARMuF,GAAGrC,UAAW,4CAEhBsR,EAASE,cAAc0P,6BAA8B,SAGlD5P,GAASE,cAAcoO,wCACvBtO,GAASE,cAAcyO,0BAEvB3O,EAASO,cACXnQ,KAAM,WAEH4P,EAASQ,gBAAiB,0BAItC,QAASrM,GAAqB0b,GAG1B,MADA7P,GAASE,cAAc0P,8BAAgCC,EAChDtQ,EAAIH,IAAK,kBACZwQ,8BAA+BC,IASvC,QAASC,KAGL/P,EAAIP,aAAc,yCAA0CE,KAAM,YAC7DtP,KAAM,SAAUC,GAEbwM,EAAMG,UACDzF,WAAYlH,EAASX,KAAK,IAC1B2N,UAAW,WAER3S,EAAG,mCAAoCkB,KAAM,SAAU5F,EAAG6F,GAEjDnB,EAAGmB,GAAQgG,OAASmO,EAASE,cAAcwO,0BAE5ChkB,EAAGmB,GAAQF,KAAM,UAAW,WAI5BjB,EAAGmB,GAAQoK,WAAY,eAG/BmH,UAAW,WAEf,MAAOkS,OAENrX,SAWjB,QAASqX,KAEL,GAAI5S,GAAOhS,EAAG,4CAEd,IAAKgS,EAAK0L,eACV,CACI,GAAIxB,GAASlK,EAAK6I,gBAAgBnF,SAAS2P,oBAEvCC,GACAC,iBAAuBrJ,EAAOsJ,SAC9BC,YAAuBvJ,EAAOwJ,IAC9BC,sBAAuBzJ,EAAO0J,UAC9BC,qBAAuB3J,EAAO4J,aAC9BC,aAAuB7J,EAAO8J,KAC9BC,YAAuB/J,EAAOgK,IAYlC,OATArR,GAAIJ,KAAM,gDAAiD6Q,GACtD5f,KAAM,WAEH4P,EAASK,eAAejQ,KAAM,WAE1B6D,EAAoB,GACpB+L,EAASQ,gBAAiB,6BAG/B,EAIP,OAAO,EAQf,QAASqQ,KAGL9Q,EAAIP,aAAc,wCAAyCE,KAAM,YAC5DtP,KAAM,SAAUC,GAEbwM,EAAMG,UACDzF,WAAYlH,EAASX,KAAK,IAC1B2N,UAAW,WAER3S,EAAG,mCAAoCkB,KAAM,SAAU5F,EAAG6F,GAEjDnB,EAAGmB,GAAQgG,OAASmO,EAASE,cAAcwO,0BAE5ChkB,EAAGmB,GAAQF,KAAM,UAAW,WAI5BjB,EAAGmB,GAAQoK,WAAY,eAG/BmH,UAAW,WAEf,MAAOmS,OAENtX,SAUjB,QAASsX,KAEL,GAAI7S,GAAOhS,EAAG,2CAEd,IAAKgS,EAAK0L,eACV,CAEI,GAAIxB,GAASlK,EAAK6I,gBAAgBnF,SAAS0Q,qBAEvCC,GACAC,MAAUpK,EAAOqK,MACjBC,KAAUtK,EAAOuK,KACjBC,OAAUxK,EAAOyK,OACjBC,KAAU1K,EAAO2K,KACjBC,MAAU5K,EAAO6K,MACjBC,SAAU9K,EAAO+K,SAQrB,OALApS,GAAIJ,KAAM,+CAAgD4R,GACrD3gB,KAAM,WAEH4P,EAASK,kBAEV,EAIP,OAAO,EAQf,QAASuR,GAAuBtsB,GAI5B,GAAgE,GAA3D0a,EAASE,cAAc0I,uBAAuBI,UAE/C,GAAIpC,GAASlc,EAAG,iDAAkD6a,oBAIlE,IAAIqB,GAASlc,EAAG,mDAAoD6a,eAGxE,IAAIxa,IACAqc,OAAgBR,EAAOE,OACvBQ,QAAgBV,EAAOb,QACvBiB,IAAgBJ,EAAOI,IACvBK,KAAgBT,EAAOK,KACvB4K,WAAgBjL,EAAOkL,WACvB3K,eAAgB,aAGpBpH,GAAIP,aAAc,uCAAwCzU,GAAS2U,KAAM,YACpEtP,KAAM,SAAUC,GAEbwM,EAAMG,UACDzF,WAAYlH,EAASX,KAAK,IAC1BuI,SAWjB,QAAS8Z,KAEL,GAAIrV,GAAOhS,EAAG,2CACd,IAAKgS,EAAK0L,eACV,CAEI,GAAIxB,GAASlK,EAAK6I,gBAGdxa,GACAinB,wBAA+BpL,EAAOqL,yBAA2B,EACjEC,gBAA+BtL,EAAOuL,iBAAmB,EACzDC,mBAA+BxL,EAAOyL,oBAAsB,EAC5DC,oBAA+B1L,EAAO2L,qBAAuB,EAC7DC,gBAA+B5L,EAAO6L,iBAAmB,EACzDC,8BAA+B9L,EAAO+L,+BAAiC,EACvEC,8BAA+BhM,EAAOiM,+BAAiC,EACvEC,mBAA+BlM,EAAOmM,oBAAsB,EAGhE,OAAOxT,GAAIJ,KAAM,6BAA8BpU,GAC1CqF,KAAM,SAAUC,GAEb,GAAiD,IAA5CA,EAASX,KAAKsjB,2BAGfrf,OAAO4C,SAASC,OAAQnG,EAASX,KAAKsjB,gCAGrC,IAAuD,IAAlD3iB,EAASX,KAAKujB,iCACxB,CAMI,GAAIC,GAAqBniB,EAAGpB,UAAW,WACnCwjB,GAAsB,KAAM,KAAM,KACjCA,GAAmBpqB,QAASsH,EAASX,KAAK0jB,oBAAuB,GAAK/iB,EAASX,KAAKujB,iCAAiClqB,QAAQ,qDAAuD,KAErLmqB,EAAe,IAGnBrW,EAAMG,UACDzF,WAAYlH,EAASX,KAAKujB,kCAC1B/V,gBAAiB,IACjBC,gBAAiB+V,GACjB/R,UAA4B,KAAjB+R,GACX7V,UAAW,WAER1J,OAAO4C,SAASC,OAAQkG,EAAK/Q,KAAM,aAEtCyR,UAAW,WAERzJ,OAAO4C,SAASC,OAAQkG,EAAK/Q,KAAM,aAEtCsM,WAMLtE,QAAO4C,SAASC,OAAQkG,EAAK/Q,KAAM,cA/oBvD,OACIyW,KAAwBA,EACxBoL,uBAAwBA,EACxBoB,cAAwBA,EACxBG,mBAAwBA,EACxBlB,oBAAwBA,EACxB+D,sBAAwBA,EACxB3C,eAAwBA,EACxBhb,mBAAwBA,EACxBE,oBAAwBA,EACxB2b,gBAAwBA,EACxBe,eAAwBA,EACxBkB,WAAwBA,KA0oB5B,aAAc,YAAa,aAAc,kBAAmB,kBACjEjhB,OAAQpD,iBAcV,SAAUhD,EAAGqG,GAGVA,EAAG3B,QAAS,kBAAmB,SAAUmQ,GAerC,QAAS8T,KAYL,QAASC,GAAqBjuB,EAAOkuB,GAIjC,MAFAC,GAAiBC,UAAYpuB,EAC7BmuB,EAAiBE,QAAYH,EACtB5wB,KAGX,QAASgxB,GAAeC,EAAaC,EAAaC,GAG9C,GAAI/oB,IACAgpB,YAAcF,EACdG,SAAcR,EAAiBC,UAC/BQ,OAAcT,EAAiBE,QAC/BQ,aAAcJ,GAAgBK,IAAgBC,qBAElD,OAAO7U,GAAInR,IAAK,kBAAoBwlB,EAAc,IAAK7oB,GA1B3D,GAAIyoB,IACAC,UAAW,KACXC,QAAW,KAGf,QACIW,QAASf,EACTgB,MAASX,GAgCjB,QAASY,KAkBL,QAASC,GAAYC,GAGjB,MADA1pB,GAAO2pB,OAASD,EACT9xB,KAGX,QAASgyB,GAAaC,GAGlB,MADA7pB,GAAO8pB,KAAOD,EACPjyB,KAGX,QAASmyB,GAAYC,EAAQC,EAAMC,GAW/B,MATAlqB,GAAOmqB,OAASH,EACTC,IAEHjqB,EAAOsd,MAAQ2M,GAEZC,IAEHlqB,EAAOoqB,WAAaF,GAEjBtyB,KAGX,QAASyyB,GAAcxB,EAAaC,GAEhC,MAAOtU,GAAIJ,KAAM,kBAAoByU,EAAc,IAAK7oB,GA3C5D,GAAIA,IACA2pB,OAAY,EACZG,KAAY,GACZK,OAAY,GACZ7M,MAAY,GACZ8M,WAAY,EAGhB,QACIX,WAAaA,EACbG,YAAaA,EACbG,WAAaA,EACb1e,GAAagf,GAqCrB,QAASjB,KAEL,OACIkB,cAAsB,gBACtBC,aAAsB,eACtBlB,qBAAsB,yBAI9B,QAASmB,KAEL,OACIC,KAAU,OACVC,SAAU,WACVC,KAAU,QAvHlB,OACIrC,aAAeA,EACfkB,YAAeA,EACfoB,aAAeJ,IACfK,cAAezB,OAuHnB,gBACLrjB,OAAQpD,iBAaV,SAAUhD,EAAGqG,GAYVA,EAAG3B,QAAS,mBAAoB,WAqB5B,QAASymB,KAOL,MALOC,IAEHC,IAGGD,EAQX,QAASC,KAEL,GAAIC,EAuCJ,IAlCQA,EAJDriB,OAAOsiB,WAELtiB,OAAOsiB,WAAY,sBAAuBC,QAEpC,KAEDviB,OAAOsiB,WAAY,qBAAsBC,QAExC,KAEDviB,OAAOsiB,WAAY,qBAAsBC,QAExC,KAIA,KAKNxrB,EAAGiJ,QAAS4S,SAAW,KAEjB,KAED7b,EAAGiJ,QAAS4S,SAAW,IAEtB,KAED7b,EAAGiJ,QAAS4S,SAAW,IAEtB,KAIA,KAGVyP,GAAQF,GAAuB,OAATE,EAC3B,CACI,GAAIG,GAAWL,CACfA,GAAeE,EACftrB,EAAGiJ,QAASlI,QAAS,cAAeqqB,EAAYK,KAIxD,QAAShhB,GAAYmB,GAGjB,IAAM,GADF8f,GAAe9f,EAASlT,QAAS,MAAO,IAAKyB,MAAO,KAC9CmB,EAAI,EAAGA,EAAIowB,EAAa5xB,OAAQwB,IAEtC,GAAKowB,EAAapwB,IAAM8vB,EAEpB,OAAO,CAGf,QAAO,EA5FX,GAAIA,EAQJ,OALAprB,GAAGiJ,QAAS0iB,OAAQN,GAGpBrrB,EAAGU,UAAW8T,MAAO6W,IAGjBzf,SAAYuf,EACZ1gB,WAAYA,MAuFrBrE,OAAQpD,iBAaV,SAAUhD,EAAGqG,GASVA,EAAG3B,QAAS,mBAAoB,SAAU2Q,EAAKC,GAkD3C,QAASoC,KASL,GALA/I,EAAa3O,EAAG,4CAChB+V,EAAa/V,EAAG,4CAChB4rB,EAAa5rB,EAAG,iCAChB6rB,EAAa7rB,EAAG,iCAEX2O,EAAW7U,QAAUic,EAAUjc,QAAUic,EAAUjc,OAAS,EACjE,CACmBwb,EAASE,aAExBO,GAAU1I,OAGVsB,EAAWzN,KAAM,SAAU5F,EAAGkL,GAE1BxG,EAAGwG,GAAOuE,SAAU,YAEpB/K,EAAGwG,GAAOuJ,MAAO,WAEP/P,EAAG/H,MAAO6I,GAAI,cAEhBgrB,EAAMxwB,OAKlBswB,EAAW3qB,KAAM,WAAY,YAC7B2qB,EAAW7b,MAAO,WAEdgc,MAGJF,EAAW5qB,KAAM,WAAY,YAC7B4qB,EAAW9b,MAAO,WAEdic,MAGJ/iB,OAAOgjB,iBAAkB,aAAc,WAE9BhjB,OAAO4C,SAASqgB,KAAKpyB,OAAS,EAE/BmS,EAAQhD,OAAO4C,SAASqgB,MAIxBJ,EAAM,KAEX,GAIH9rB,EAAEmsB,SAAW,SAAUnuB,GAEnB,GAAIsf,GAAU,GAAI/iB,QAAQ,OAAUyD,EAAO,aAAcouB,KAAMnjB,OAAO4C,SAASF,KAC/E,OAAgB,OAAX2R,EAEM,KAIAA,EAAQ,IAAM,EAI7B,IAAIpb,GAAQlC,EAAEmsB,SAAU,UAEY,IAA/BljB,OAAO4C,SAASqgB,KAAKpyB,QAAiBoI,GAASlC,EAAG,6BAA+BkC,EAAQ,MAAOpI,OAAS,EAE1GmP,OAAO4C,SAASqgB,KAAOhqB,EAKvB4pB,GAFO7f,EAAQhD,OAAO4C,SAASqgB,OAAU/c,GAAW,EAE9CA,EAIA,GAGVkd,IACArsB,EAAGiJ,QAAS3I,GAAI,aAAc+rB,GAC9BrsB,EAAGiJ,QAAS0iB,OAAQ,WAEqC,MAAhDtlB,EAAGhD,cAAcmI,iBAAiBI,YAEnCygB,OAYhB,QAASC,KAEL,MAAKnd,IAAW,GAGR1B,GAAOzN,EAAG+V,EAAU5G,IAAWlO,KAAM,2BACrCrD,MAAOuR,GAKJ,KAmBf,QAASod,GAAcC,GAGnB,MADAC,GAAaF,aAAa9wB,KAAM+wB,GACzBnmB,EAAGhD,cAAcoI,iBAS5B,QAASihB,GAAaF,GAGlB,MADAC,GAAaC,YAAYjxB,KAAM+wB,GACxBnmB,EAAGhD,cAAcoI,iBAY5B,QAASkhB,GAAqB5oB,EAAYnG,GAEtC,GAAIgvB,IAAoB,CAExB,IAAKzd,GAAW,GAAoB,gBAAfpL,EACrB,CAEI,GAAI8oB,GAAmBP,IACnBQ,GACAlvB,MAAOA,EACP6P,GAAOzN,EAAG+V,EAAUnY,IAASqD,KAAM,2BAGvCjB,GAAEkB,KAAMurB,EAAa1oB,GAAa,SAAUzI,EAAGkxB,GAE3C,MAAKA,GAAaK,EAAkBC,MAAsB,GAEtDF,GAAoB,GACb,GAHX,SAQR,MAAOA,GAUX,QAASd,GAAMluB,EAAOmvB,GAGlB,GAAIC,GAAiB7d,IAAYvR,IAE5BovB,GAAmBD,GAEdJ,EAAqB,eAAgB/uB,MAM/CuR,EAAUvR,GAEJZ,OAAO2G,OAAQspB,EAAe9d,GAAUmG,EAASE,aAAa,KAAYwX,GAAoBhtB,EAAG+V,EAAU5G,IAAWlO,KAAM,iCAE9HgsB,EAAe9d,GAAWmG,EAASE,aAAa,GAEhDH,EAAIF,mBAAoBnV,EAAG+V,EAAU5G,IAAWlO,KAAM,iCACjDyE,KAAM,SAAUC,GAEb3F,EAAG+V,EAAU5G,IAAW6G,KAAMrQ,EAASX,KAAK,IAE5CkoB,EAAkBF,GAClB3mB,EAAGhD,cAAce,eAAgB2R,EAAU5G,IAC3CnP,EAAGiJ,QAASlI,QAAS,qBAM7BmsB,EAAkBF,IAM1B,QAASE,GAAkBF,GAIvBhtB,EAAG+V,GAAY1I,MAGf,IAAInN,EACJF,GAAG2O,GAAazN,KAAM,SAAU5F,EAAGkL,GAE/BtG,EAAQF,EAAGwG,GACXtG,EAAMiK,YAAa,mBAEnBjK,EAAMoE,KAAM,gBAAiBrD,KAAM,gBAAiB,SAE3CkO,EAAJ7T,EAGD4E,EAAM6K,SAAU,WAIXzP,GAAK6T,GAENjP,EAAM6K,SAAU,kBAChB7K,EAAMoE,KAAM,gBAAiBrD,KAAM,gBAAiB,SAI/C3F,EAAI6T,IAAYjP,EAAMY,GAAI,aAG3BZ,EAAM6K,SAAU,cAKhCshB,IAGgB,GAAXld,EAED0c,EAAW5qB,KAAM,WAAY,YAI7B4qB,EAAWtgB,WAAY,YAItB4D,EAAU,GAAKR,EAAW7U,OAE3B8xB,EAAW3qB,KAAM,WAAY,YAI7B2qB,EAAWrgB,WAAY,YAI3BvL,EAAG+V,EAAU5G,IAAW5B,OAGnB4B,EAAU,EAEXlG,OAAO4C,SAASqgB,KAAOlsB,EAAG+V,EAAU5G,IAAWlO,KAAM,2BAIhDgI,OAAO4C,SAASqgB,KAAKpyB,OAAS,IAE/BmP,OAAO4C,SAASqgB,KAAO,IAI1Bc,GAEDL,EAAqB,cAAexd,GAS5C,QAASge,GAAgBL,GAErBhB,EAAMgB,EAAgBlvB,OAAO,GAYjC,QAASmuB,KAEA5c,EAAUR,EAAW7U,OAAS,GAE/BgyB,EAAM3c,EAAU,GAQxB,QAAS6c,KAEA7c,EAAU,GAEX2c,EAAM3c,EAAU,GAUxB,QAASlD,GAAQmhB,GAEb,MAAoB,QAAfA,GAEDrB,KACO,GAEc,QAAfqB,GAENpB,KACO,IAIPoB,EAAcA,EAAY10B,QAAS,IAAK,IACxCsH,EAAG+V,GAAY7U,KAAM,SAAU5F,EAAGkL,GAE9B,MAAKxG,GAAGwG,GAAOvF,KAAM,4BAA+BmsB,GAEhDtB,EAAMxwB,IACC,GAHX,UAQD,GAQX,QAAS+wB,KAGL,OAxbJ,GAAI1d,MACAoH,KACA5G,EAAU,GACV0c,KACAD,KACAa,GACAF,gBACAG,gBAEAO,IAEJ,QACIvV,KAAqBA,EACrB4U,oBAAqBA,EACrBR,KAAqBA,EACrBS,aAAqBA,EACrBG,YAAqBA,EACrBS,eAAqBA,EACrBpB,KAAqBA,EACrBC,SAAqBA,EACrB/f,OAAqBA,EACrBogB,eAAqBA,KAmfzB,aAAc,qBAEnBjmB,OAAQpD,iBAYV,SAAUhD,EAAGqG,GAEVA,EAAG3B,QAAS,oBAAqB,SAAUmQ,EAAK1C,EAAOnE,GAYnD,QAASyM,KAEL,GAAIiC,GAAS1c,EAAG,wBAAyBmH,KACzC,OAAiC,eAAxBuV,EAAOL,eAA0D,eAAxBK,EAAOL,cAG7D,QAASgR,KAELC,GACIC,qBAAuBvtB,EAAG,uBAAwB,iDAClDwtB,kBAAuBxtB,EAAG,oBAAqB,iDAC/CytB,mBAAuBztB,EAAG,qBAAsB,iDAChD0tB,sBAAuB1tB,EAAG,wBAAyB,kDAIvDstB,EAAeC,qBAAqBpmB,IAAK,IAEnCmmB,EAAeE,kBAAkBrmB,MAAMrN,OAAS,GAAKwzB,EAAeG,mBAAmBtmB,MAAMrN,OAAS,EAGxG+a,EAAInR,IAAK,iDAED+Y,eAAgB,aAChBkR,IAAgBL,EAAeE,kBAAkBrmB,MACjDwV,KAAgB2Q,EAAeG,mBAAmBtmB,QAGrDzB,KAAM,SAAUC,GAEb5F,EAAkB4F,EAASX,KAC3B4oB,EAAkB7tB,EAAOjG,OAED,GAAnB8zB,GAEDC,GAOJ,KAAM,GAJFxtB,IACA8c,cAGM7hB,EAAI,EAAOsyB,EAAJtyB,EAAqBA,IACtC,CACI,GAAIwyB,GAAmB,KACnBC,EAAmBhuB,EAAOzE,GAAG0yB,uBAC7BC,EAAmBF,EAAe,GACtCE,IAAyB9W,KAAKmB,MAA0B,IAAnB2V,GAA2B,KAAKC,QAAS,GAAKx1B,QAAS,IAAK,KAE7E,IAAfq1B,IAEDE,EAAmBF,EACnBD,EAAmB,KAGvBztB,EAAO8c,UAAU1hB,MACbmC,MAAWtC,EACXwyB,UAAWA,EACXlzB,KAAWmF,EAAOzE,GAAG6yB,4BAA8B,cAAgB,cACnExH,OAAW5mB,EAAOzE,GAAG6yB,4BAA8BpuB,EAAOzE,GAAG8yB,4BAA8BruB,EAAOzE,GAAG+yB,2BACrG3R,OAAW3c,EAAOzE,GAAGiyB,qBACrB3Q,QAAW7c,EAAOzE,GAAGoyB,sBACrBC,IAAW5tB,EAAOzE,GAAGkyB,kBACrB7Q,KAAW5c,EAAOzE,GAAGmyB,mBACrBa,SAAWvuB,EAAOzE,GAAGizB,uBACrBC,SAAWP,EACXQ,OAAW1uB,EAAOzE,GAAGozB,uBAI7B,GAAI1Y,GAAO3P,EAAGtB,gBAAiB,qCAAsC1E,EAErE8R,GAAMG,UACDC,SAAUlM,EAAGpB,UAAW,+CACxB4H,WAAYmJ,GACZQ,SAAU,YACV9D,UAAW,WA+BR,MA7BA4a,GAAeG,mBAAmBtjB,YAAa,SAAUY,SAAU,WACnE/K,EAAG,cAAgBstB,EAAeG,mBAAmBxsB,KAAM,MAAS,MAAOkJ,YAAa,SAAUY,SAAU,WAE5GuiB,EAAeE,kBAAkBrjB,YAAa,SAAUY,SAAU,WAClE/K,EAAG,cAAgBstB,EAAeE,kBAAkBvsB,KAAM,MAAS,MAAOkJ,YAAa,SAAUY,SAAU,WAE3GuiB,EAAeC,qBAAqBpjB,YAAa,SAAUY,SAAU,WACrE/K,EAAG,cAAgBstB,EAAeC,qBAAqBtsB,KAAM,MAAS,MAAOkJ,YAAa,SAAUY,SAAU,WAE9GuiB,EAAeI,sBAAsBvjB,YAAa,SAAUY,SAAU,WACtE/K,EAAG,cAAgBstB,EAAeI,sBAAsBzsB,KAAM,MAAS,MAAOkJ,YAAa,SAAUY,SAAU,WAE/G4jB,EAAgB3uB,EAAG,kDAAmDmH,MAEjEpH,EAAO4uB,GAAeR,6BAEvBnuB,EAAGstB,EAAeC,sBAAuBpmB,IAAK,eAC9CnH,EAAGstB,EAAeI,uBAAwBvmB,IAAKpH,EAAO4uB,GAAeP,+BAIrEpuB,EAAGstB,EAAeC,sBAAuBpmB,IAAK,eAC9CnH,EAAGstB,EAAeI,uBAAwBvmB,IAAKpH,EAAO4uB,GAAeN,6BAEzEruB,EAAGstB,EAAeC,sBAAuBxsB,QAAS,UAElDf,EAAGstB,EAAeG,oBAAqBtmB,IAAKpH,EAAO4uB,GAAelB,oBAClEztB,EAAGstB,EAAeE,mBAAoBrmB,IAAKpH,EAAO4uB,GAAenB,mBACjExtB,EAAG,yBAA0B+Z,WAAW,SAAS,SAC1C,IAEVxM,SAKbsgB,IAKR,QAASA,KAEL7f,EAAUkF,WAAY,EAAG7M,EAAGpB,UAAW,2CAEvCqoB,EAAeG,mBAAmBtjB,YAAa,WAAYY,SAAU,SACrE/K,EAAG,cAAgBstB,EAAeG,mBAAmBxsB,KAAM,MAAS,MAAOkJ,YAAa,WAAYY,SAAU,SAE9GuiB,EAAeE,kBAAkBrjB,YAAa,WAAYY,SAAU,SACpE/K,EAAG,cAAgBstB,EAAeE,kBAAkBvsB,KAAM,MAAS,MAAOkJ,YAAa,WAAYY,SAAU,SAE7GuiB,EAAeG,mBAAmB/R,MAAO,WAErC1b,EAAG/H,MAAOkS,YAAa,QACvB,IAAIykB,GAAU5uB,EAAG/H,MAAOgJ,KAAM,KAC9BjB,GAAG/H,MAAO42B,QAAS,eAAgBvqB,KAAM,SAAWsqB,EAAU,MAAOzkB,YAAa,WAGtFmjB,EAAeE,kBAAkB9R,MAAO,WAEpC1b,EAAG/H,MAAOkS,YAAa,QACvB,IAAIykB,GAAU5uB,EAAG/H,MAAOgJ,KAAM,KAC9BjB,GAAG/H,MAAO42B,QAAS,eAAgBvqB,KAAM,SAAWsqB,EAAU,MAAOzkB,YAAa,WAtJ1F,GAAIwkB,GAAkB,GAClBrB,KACAM,KACA7tB,IAEJ,QACIstB,oBAAqBA,EACrB5S,cAAqBA,KAkJzB,aAAc,eAAgB,eAEnCrU,OAAQpD,iBAcV,SAAUhD,EAAGqG,GAQVA,EAAG3B,QAAS,qBAAsB,WAuB9B,QAASoqB,GAAY/qB,GAEjB,GAAId,IACA8rB,gBAAiB,2DACFC,iBACb,aAAeC,mBAAoBC,KACnC,qQAQFC,qBAAsB,2DACPH,iBACb,aAAeC,mBAAoBC,KACnC,0QAQFE,QAAW,qEACCH,mBAAoBC,KAC9B,aAAeG,IACf,2IAGFC,cAAe,wDAGGJ,IAAW,mEACkCK,WAAa,sQAGhF,OAAOtsB,GAASc,GASpB,QAASmrB,KAEL,GAAIM,GAAY9uB,SAASmL,SAASF,KAC9B8jB,EAAYzvB,EAAG,uBAAwBiB,KAAM,OAWjD,OATKwuB,IAAaA,EAAU31B,OAAS,IAE5B21B,EAAUpxB,QAAS,QAAW,IAE/BoxB,EAAY/uB,SAASmL,SAAS6jB,SAAW,KAAOhvB,SAASmL,SAAS8jB,KAAOF,GAE7ED,EAAMC,GAGHD,EASX,QAASI,GAAS5xB,GAEd,GAAI6xB,GAAc7vB,EAAG,cAAgBhC,EAAO,MAAOiD,KAAM,UACzD,OAAO4uB,IAAe,GAS1B,QAASR,KAEL,GAAI/Y,GAAUsZ,EAAS,YACnBE,EAAUF,EAAS,aAWvB,OATKtZ,GAAMxc,OAAS,GAAKg2B,EAAQh2B,OAAS,EAEtCwc,GAAS,MAAQwZ,EAIjBxZ,EAAQtW,EAAG,SAAUkF,OAGlB+pB,mBAAoB3Y,GA1G/B,MATiC,mBAAtB,oBAEP0Y,iBAAmB,SAEI,mBAAhB,cAEPO,WAAa,OAIb7d,iBAAkBod,MA8G3B1oB,OAAQpD,iBAaV,SAAUhD,EAAGqG,GAQVA,EAAG3B,QAAS,oBAAqB,WAc7B,QAASqrB,GAAgBlvB,GAGrB,MADAA,GAAUb,EAAGa,GACRA,EAAQC,GAAI,UAAaD,EAAQC,GAAI,WAAcD,EAAQC,GAAI,YAEzDD,EAIFA,EAAQyD,KAAM,SAAUxK,OAAS,EAE3B+G,EAAQyD,KAAM,SAGfzD,EAAQyD,KAAM,UAAWxK,OAAS,EAEjC+G,EAAQyD,KAAM,UAGfzD,EAAQyD,KAAM,YAAaxK,OAAS,EAEnC+G,EAAQyD,KAAM,YAKd,KAanB,QAAS0rB,GAAcC,GAGnB,MAAKA,GAAYnvB,GAAI,UAAamvB,EAAYnvB,GAAI,WAAcmvB,EAAYnvB,GAAI,YAGrEd,EAAE4B,KAAMquB,EAAY9oB,OAAQrN,OAAS,GAK5C+H,QAAQC,MAAO,+CAAiDmuB,EAAYC,KAAM,WAAc,MACzF,GAWf,QAASC,GAAcF,GAEnB,GAAIG,GAAa;AACjB,MAAKJ,GAAcC,GAERG,EAAWhzB,KAAM4C,EAAE4B,KAAMquB,EAAY9oB,SAIrC,EAWf,QAASkpB,GAAgBJ,GAErB,MAAKD,GAAcC,GAERjwB,EAAEswB,UAAWtwB,EAAE4B,KAAMquB,EAAY9oB,SAIjC,EAaf,QAASopB,GAAeN,EAAaO,EAAWC,GAQ5C,MANAR,GAAcjwB,EAAE4B,KAAMquB,EAAY9oB,OAClCqpB,EAAcxwB,EAAE4B,KACZ5B,EAAGwwB,GAAY12B,OAAS,EAClBkG,EAAGwwB,GAAYrpB,MACfqpB,GAELC,EAEMR,GAAeO,EAEnBP,EAAY5tB,eAAiBmuB,EAAUnuB,cAGlD,QAASquB,GAAuBT,GAE5B,OAASA,EAAYnvB,GAAI,cAAiBmvB,EAAYnvB,GAAI,YAoD9D,QAASiR,GAAUC,EAAMC,GAErB,GAAI0e,GAAcC,EAAcC,EAAeC,EAAiBC,EAAOxgB,EAASygB,EAAYC,EAAYC,EAAcC,EAAgBC,EAClIxW,EAAgB5a,EAAGgS,EACvBC,GAAoBA,GAAc,OAClC,IAAIof,MACAC,GAAgB,CAGpB1W,GAAMtW,KAAM,qCAAsCpD,KAAM,SAAU5F,EAAGkL,GAEjE0qB,EAAiBlxB,EAAGwG,GAAOvF,KAAM,wBACjC2vB,EAAiBb,EAAgBvpB,GAEjC2qB,EAAmBD,EAAeA,EAAe,OACjDC,EAAiBA,EAAeh3B,MAAO,IAEvC,KAAM,GAAImB,GAAI,EAAGxB,EAAS82B,EAAa92B,OAAYA,EAAJwB,EAAYA,IAC3D,CAKI,GAJAq1B,EAAsB3wB,EAAG4wB,EAAat1B,IACtC81B,EAAsBT,EAAa1vB,KAAM,QAGpCyvB,EAAuBC,GAExB,MAOJ,IAJAE,EAAkBM,EAAe71B,GAAGsG,QAAUuvB,EAAe,GAAGvvB,OAChEkvB,GAAkB,EAGZH,EAAa7vB,GAAI,UACO,SAAvBswB,GACuB,YAAvBA,GACAT,EAAa7vB,GAAI,YAEpB,OAAS+vB,GAGL,IAAK,OACDC,GAAmBd,EAAcW,EACjC,MAEJ,KAAK,OACDG,GAAmBX,EAAcQ,EACjC,MAEJ,KAAK,SACDG,GAAmBT,EAAgBM,EACnC,MAEJ,KAAK,QACDG,GAAmBP,EAAeI,EAAc3wB,EAAGwG,GAAOvF,KAAM,gCAAiE,aAA9B0vB,EAAaxyB,QAAQvD,KACxH,MAEJ,KAAK,OAED,KAEJ,SACIiH,QAAQC,MAAO,sDAAwDovB,EAAe,SAI7F,KAAKP,EAAa7vB,GAAI,UACI,SAAvBswB,GACsB,YAAvBA,EAqBF,CAAA,IAAKT,EAAa7vB,GAAI,UAQvB,WADAe,SAAQC,MAAO,0BAA4B9B,EAAGwG,GAAO0pB,KAAM,WAAc,oCAJzEY,GAA0C,IAAtBH,EAAaxpB,OAAqC,MAAtBwpB,EAAaxpB,UAvBjE,CAKI,GAHA4pB,EAAUJ,EAAa1vB,KAAM,QAC7BsP,EAAUqK,EAAMtW,KAAM,eAAiBysB,EAAQ,cAAej3B,OAElC,SAAvBs3B,EAEDJ,EAAa,EACbC,EAAa,MAGjB,CACI,GAAIM,GAAS,GAAKC,UAAU,UAAYN,OAAsBO,IAAK,EAAGC,IAAK,EAC3EV,GAAaO,EAAOE,IACpBR,EAAaM,EAAOG,IAGxBZ,EAA8BE,EAAVzgB,GAAwBA,EAAU0gB,EAcrDH,IAEDQ,GAAW,EACXD,EAAc51B,KAAMk1B,GAEfC,EAAa92B,OAAS,GAEvB62B,EAAa5lB,SAAUkH,GACvB2I,EAAMtW,KAAM,cAAgBqsB,EAAa1vB,KAAM,MAAS,MAAO8J,SAAUkH,IAIzEjS,EAAGwG,GAAOuE,SAAUkH,OAQpC2I,EAAMta,GAAI,mBAAoB,WAE1B,GAAIqxB,GAAgB,GAChBC,EAAgBhX,EAAMtW,KAAM,IAAM2N,GAAalM,QAC/C8rB,EAAgBD,EAAOE,SAAS7V,IAChC8V,EAAgB/xB,EAAG,aAGlB4a,GAAM5T,QAAS,UAAWlN,OAAS,GAEpCi4B,EAAgBnX,EAAM5T,QAAS,UAAW1C,KAAM,eAChDutB,EAAgBE,EAAc3jB,aAAgB2jB,EAAcD,SAAS7V,IAAM2V,EAAOE,SAAS7V,MAGrFrB,EAAM9Z,GAAI,YAEhBixB,EAAgBnX,EAAMtW,KAAM,eAC5ButB,EAAgBE,EAAc3jB,aAAgB2jB,EAAcD,SAAS7V,IAAM2V,EAAOE,SAAS7V,OAI1F4V,EAAcF,EAAc1oB,OAAO+oB,aAAeH,EAAe5oB,OAAO+oB,YAAc/oB,OAAOgpB,cAE9FF,EAAc/hB,SACV5B,UAAWyjB,EAAcF,MAKhCL,IAGD1W,EAAMtW,KAAM,IAAM2N,GAAa/Q,KAAM,SAAU5F,EAAGkL,GAE9CmqB,EAAe3wB,EAAG+vB,EAAgBvpB,IAClCmqB,EAAarwB,GAAI,cAAe,WAG5B,GAAI4xB,GAAgBlyB,EAAGwG,EACvB0rB,GAAc/nB,YAAa8H,GAC3B2I,EAAMtW,KAAM,cAAgBtE,EAAG/H,MAAOgJ,KAAM,MAAS,MAAOkJ,YAAa8H,OAIjF2I,EAAM7Z,QAAS,oBAAqBswB,IAGxC,IAAIjxB,GAAWwa,EAAM3Z,KAAM,uBAE3B,KAAMqwB,GAAclxB,GAAwB,UAAZA,GAAmD,kBAApB6I,QAAO7I,GACtE,CAEI,GAAIoa,KAcJ,OAbAI,GAAMtW,KAAM,2BAA4BpD,KAAM,WAET,YAA5BlB,EAAG/H,MAAOgJ,KAAM,QAEjBuZ,EAAOxa,EAAG/H,MAAOgJ,KAAM,SAAYjB,EAAG/H,MAAO6I,GAAI,YAIjD0Z,EAAOxa,EAAG/H,MAAOgJ,KAAM,SAAYjB,EAAG/H,MAAOkP,QAIrD8B,OAAO7I,GAAWoa,IACX,EAIP,OAAQ8W,EApXhB,OACIvf,SAAUA,KA6XlB/R,EAAEmyB,GAAGzU,aAAe,WAEhB,MAAOrX,GAAGhD,cAAcyO,kBAAkBC,SAAU9Z,OAOxD+H,EAAEmyB,GAAGtX,cAAgB,WAMjB,QAASuX,GAAQpW,EAAUnhB,GAEvB,GAAI8C,GAAQqe,EAASre,MAAO,gBAE5B,IAAOA,EAAM,GACb,CACI,GACI00B,GADAC,EAAW,eAEX5iB,IAEJ,KADAA,EAAS,GAAM/R,EAAM,GACsB,QAAlC00B,EAAQC,EAAIlG,KAAMzuB,EAAM,MAE7B+R,EAASjU,KAAM42B,EAAM,GAGzB,KAAM,GAAI/2B,GAAIoU,EAAS5V,OAAS,EAAGwB,GAAK,EAAGA,IAC3C,CACI,GAAI6L,KACJA,GAAIuI,EAASpU,IAAMT,EACnBA,EAAmBsM,EAEvB+U,EAASlc,EAAE4V,QAAQ,EAAMsG,EAAQrhB,OAIjCqhB,GAAOve,EAAM,IAAM9C,EA5B3B,GAAImX,GAAS/Z,KACTikB,IA2DJ,OA5BAlK,GAAK1N,KAAM,2BAA4BpD,KAAM,SAAU5F,EAAGkL,GAEtD,GAAOxG,EAAGwG,GAAOvF,KAAM,QAEnB,GAAiC,YAA5BjB,EAAGwG,GAAOvF,KAAM,QACrB,CAEI,GAAIsxB,KACJvyB,GAAGgS,GAAO1N,KAAM,UAAYtE,EAAGwG,GAAOvF,KAAM,QAAW,cAAeC,KAAM,SAAU3B,EAAGizB,GAErFD,EAAY92B,KAAMuE,EAAGwyB,GAAWrrB,SAEpCirB,EAAQpyB,EAAGwG,GAAOvF,KAAM,QAAUsxB,OAEA,SAA5BvyB,EAAGwG,GAAOvF,KAAM,QAEjBjB,EAAGwG,GAAO1F,GAAI,aAEfsxB,EAAQpyB,EAAGwG,GAAOvF,KAAM,QAAUjB,EAAGwG,GAAOW,OAKhDirB,EAAQpyB,EAAGwG,GAAOvF,KAAM,QAAUjB,EAAGwG,GAAOW,SAKjD+U,IAEZ9V,OAAQpD,iBA0BXA,gBAAgB8C,SAGhB,IAAI2sB,QAASzvB,gBAAgBK,aAQ7B+C,QAAQ1F,UAAW8T,MAAO,WAEtBie,OAAOruB","sourcesContent":["var TemplateCache = {};\n\nTemplateCache[\"addressSuggestions/addressDoctor.html\"] = \"<ul class=\\\"suggestion-list\\\">\\n\" +\n   \"    {{#values}}\\n\" +\n   \"    <li>\\n\" +\n   \"        <a href=\\\"javascript:void(0)\\\" data-address-value=\\\"{{.}}\\\">\\n\" +\n   \"            {{.}}\\n\" +\n   \"        </a>\\n\" +\n   \"    </li>\\n\" +\n   \"    {{/values}}\\n\" +\n   \"</ul>\";\n\nTemplateCache[\"addressSuggestions/postFinder.html\"] = \"<div class=\\\"scrollPane\\\">\\n\" +\n   \"{{#addresses}}\\n\" +\n   \"<label>\\n\" +\n   \"  <span class=\\\"row collapse\\\">\\n\" +\n   \"    <span class=\\\"columns small-1\\\">\\n\" +\n   \"      <input type=\\\"radio\\\" value=\\\"{{index}}\\\" name=\\\"postfinder\\\">\\n\" +\n   \"    </span>\\n\" +\n   \"    <span class=\\\"columns small-11\\\">\\n\" +\n   \"      <span class=\\\"row uncollapse\\\">\\n\" +\n   \"\t\t\t\t<span class=\\\"medium-6 small-12 columns\\\">\\n\" +\n   \"\t\t\t\t\t<strong>{{type}} {{number}}</strong><br>\\n\" +\n   \"\t\t\t\t\t{{street}} {{houseNo}}<br>\\n\" +\n   \"\t\t\t\t\t{{zip}} {{city}}<br><br>\\n\" +\n   \"\t\t\t\t</span>\\n\" +\n   \"\t\t\t\t<span class=\\\"medium-6 small-12 columns\\\">\\n\" +\n   \"\t\t\t\t\t<strong>{{distance}} {{dimension}}</strong><br>\\n\" +\n   \"\t\t\t\t\t{{remark}}<br><br>\\n\" +\n   \"\t\t\t\t</span>\\n\" +\n   \"\t\t\t</span>\\n\" +\n   \"    </span>\\n\" +\n   \"  </span>\\n\" +\n   \"</label>\\n\" +\n   \"{{/addresses}}\\n\" +\n   \"</div>\\n\" +\n   \"\";\n\nTemplateCache[\"error/errorMessage.html\"] = \"<div class=\\\"plentyErrorBoxContent\\\" data-plenty-error-code=\\\"{{code}}\\\">\\n\" +\n   \"    <span class=\\\"PlentyErrorCode\\\">Code {{code}}:</span>\\n\" +\n   \"    <span class=\\\"PlentyErrorMsg\\\">{{{message}}}</span>\\n\" +\n   \"</div>\\n\" +\n   \"\";\n\nTemplateCache[\"error/errorPopup.html\"] = \"<div data-alert class=\\\"alert-box alert radius plentyErrorBox\\\" id=\\\"CheckoutErrorPane\\\">\\n\" +\n   \"  <div class=\\\"plentyErrorBoxInner\\\">\\n\" +\n   \"  </div>\\n\" +\n   \"  <button tabindex=\\\"0\\\" class=\\\"close\\\" aria-label=\\\"{{#translate}}Close{{/translate}}\\\">&times;</button>\\n\" +\n   \"</div>\\n\" +\n   \"\";\n\nTemplateCache[\"modal/modal.html\"] = \"<div class=\\\"reveal-modal medium {{cssClass}}\\\" data-reveal aria-labelledby=\\\"modalTitle{{uid}}\\\" aria-hidden=\\\"true\\\" role=\\\"dialog\\\">\\n\" +\n   \"    {{#title}}\\n\" +\n   \"    <h2 id=\\\"modalTitle{{uid}}\\\">{{{title}}}</h2>\\n\" +\n   \"    {{/title}}\\n\" +\n   \"\\n\" +\n   \"    {{{content}}}\\n\" +\n   \"\\n\" +\n   \"    {{#labelConfirm}}\\n\" +\n   \"    <button type=\\\"button\\\" class=\\\"button right\\\" data-dismiss=\\\"modal\\\" data-plenty-modal=\\\"confirm\\\">{{labelConfirm}}</button>\\n\" +\n   \"    {{/labelConfirm}}\\n\" +\n   \"    {{#labelDismiss}}\\n\" +\n   \"    <button type=\\\"button\\\" class=\\\"button secondary\\\" data-dismiss=\\\"modal\\\">{{labelDismiss}}</button>\\n\" +\n   \"    {{/labelDismiss}}\\n\" +\n   \"    <a class=\\\"close-reveal-modal\\\" aria-label=\\\"{{#translate}}Close{{/translate}}\\\">&#215;</a>\\n\" +\n   \"</div>\\n\" +\n   \"\";\n\nTemplateCache[\"waitscreen/waitscreen.html\"] = \"<div id=\\\"PlentyWaitScreen\\\" class=\\\"overlay overlay-wait\\\"></div>\";\n\n(function defineMustache(global,factory){if(typeof exports===\"object\"&&exports&&typeof exports.nodeName!==\"string\"){factory(exports)}else if(typeof define===\"function\"&&define.amd){define([\"exports\"],factory)}else{global.Mustache={};factory(Mustache)}})(this,function mustacheFactory(mustache){var objectToString=Object.prototype.toString;var isArray=Array.isArray||function isArrayPolyfill(object){return objectToString.call(object)===\"[object Array]\"};function isFunction(object){return typeof object===\"function\"}function typeStr(obj){return isArray(obj)?\"array\":typeof obj}function escapeRegExp(string){return string.replace(/[\\-\\[\\]{}()*+?.,\\\\\\^$|#\\s]/g,\"\\\\$&\")}function hasProperty(obj,propName){return obj!=null&&typeof obj===\"object\"&&propName in obj}var regExpTest=RegExp.prototype.test;function testRegExp(re,string){return regExpTest.call(re,string)}var nonSpaceRe=/\\S/;function isWhitespace(string){return!testRegExp(nonSpaceRe,string)}var entityMap={\"&\":\"&amp;\",\"<\":\"&lt;\",\">\":\"&gt;\",'\"':\"&quot;\",\"'\":\"&#39;\",\"/\":\"&#x2F;\"};function escapeHtml(string){return String(string).replace(/[&<>\"'\\/]/g,function fromEntityMap(s){return entityMap[s]})}var whiteRe=/\\s*/;var spaceRe=/\\s+/;var equalsRe=/\\s*=/;var curlyRe=/\\s*\\}/;var tagRe=/#|\\^|\\/|>|\\{|&|=|!/;function parseTemplate(template,tags){if(!template)return[];var sections=[];var tokens=[];var spaces=[];var hasTag=false;var nonSpace=false;function stripSpace(){if(hasTag&&!nonSpace){while(spaces.length)delete tokens[spaces.pop()]}else{spaces=[]}hasTag=false;nonSpace=false}var openingTagRe,closingTagRe,closingCurlyRe;function compileTags(tagsToCompile){if(typeof tagsToCompile===\"string\")tagsToCompile=tagsToCompile.split(spaceRe,2);if(!isArray(tagsToCompile)||tagsToCompile.length!==2)throw new Error(\"Invalid tags: \"+tagsToCompile);openingTagRe=new RegExp(escapeRegExp(tagsToCompile[0])+\"\\\\s*\");closingTagRe=new RegExp(\"\\\\s*\"+escapeRegExp(tagsToCompile[1]));closingCurlyRe=new RegExp(\"\\\\s*\"+escapeRegExp(\"}\"+tagsToCompile[1]))}compileTags(tags||mustache.tags);var scanner=new Scanner(template);var start,type,value,chr,token,openSection;while(!scanner.eos()){start=scanner.pos;value=scanner.scanUntil(openingTagRe);if(value){for(var i=0,valueLength=value.length;i<valueLength;++i){chr=value.charAt(i);if(isWhitespace(chr)){spaces.push(tokens.length)}else{nonSpace=true}tokens.push([\"text\",chr,start,start+1]);start+=1;if(chr===\"\\n\")stripSpace()}}if(!scanner.scan(openingTagRe))break;hasTag=true;type=scanner.scan(tagRe)||\"name\";scanner.scan(whiteRe);if(type===\"=\"){value=scanner.scanUntil(equalsRe);scanner.scan(equalsRe);scanner.scanUntil(closingTagRe)}else if(type===\"{\"){value=scanner.scanUntil(closingCurlyRe);scanner.scan(curlyRe);scanner.scanUntil(closingTagRe);type=\"&\"}else{value=scanner.scanUntil(closingTagRe)}if(!scanner.scan(closingTagRe))throw new Error(\"Unclosed tag at \"+scanner.pos);token=[type,value,start,scanner.pos];tokens.push(token);if(type===\"#\"||type===\"^\"){sections.push(token)}else if(type===\"/\"){openSection=sections.pop();if(!openSection)throw new Error('Unopened section \"'+value+'\" at '+start);if(openSection[1]!==value)throw new Error('Unclosed section \"'+openSection[1]+'\" at '+start)}else if(type===\"name\"||type===\"{\"||type===\"&\"){nonSpace=true}else if(type===\"=\"){compileTags(value)}}openSection=sections.pop();if(openSection)throw new Error('Unclosed section \"'+openSection[1]+'\" at '+scanner.pos);return nestTokens(squashTokens(tokens))}function squashTokens(tokens){var squashedTokens=[];var token,lastToken;for(var i=0,numTokens=tokens.length;i<numTokens;++i){token=tokens[i];if(token){if(token[0]===\"text\"&&lastToken&&lastToken[0]===\"text\"){lastToken[1]+=token[1];lastToken[3]=token[3]}else{squashedTokens.push(token);lastToken=token}}}return squashedTokens}function nestTokens(tokens){var nestedTokens=[];var collector=nestedTokens;var sections=[];var token,section;for(var i=0,numTokens=tokens.length;i<numTokens;++i){token=tokens[i];switch(token[0]){case\"#\":case\"^\":collector.push(token);sections.push(token);collector=token[4]=[];break;case\"/\":section=sections.pop();section[5]=token[2];collector=sections.length>0?sections[sections.length-1][4]:nestedTokens;break;default:collector.push(token)}}return nestedTokens}function Scanner(string){this.string=string;this.tail=string;this.pos=0}Scanner.prototype.eos=function eos(){return this.tail===\"\"};Scanner.prototype.scan=function scan(re){var match=this.tail.match(re);if(!match||match.index!==0)return\"\";var string=match[0];this.tail=this.tail.substring(string.length);this.pos+=string.length;return string};Scanner.prototype.scanUntil=function scanUntil(re){var index=this.tail.search(re),match;switch(index){case-1:match=this.tail;this.tail=\"\";break;case 0:match=\"\";break;default:match=this.tail.substring(0,index);this.tail=this.tail.substring(index)}this.pos+=match.length;return match};function Context(view,parentContext){this.view=view;this.cache={\".\":this.view};this.parent=parentContext}Context.prototype.push=function push(view){return new Context(view,this)};Context.prototype.lookup=function lookup(name){var cache=this.cache;var value;if(cache.hasOwnProperty(name)){value=cache[name]}else{var context=this,names,index,lookupHit=false;while(context){if(name.indexOf(\".\")>0){value=context.view;names=name.split(\".\");index=0;while(value!=null&&index<names.length){if(index===names.length-1)lookupHit=hasProperty(value,names[index]);value=value[names[index++]]}}else{value=context.view[name];lookupHit=hasProperty(context.view,name)}if(lookupHit)break;context=context.parent}cache[name]=value}if(isFunction(value))value=value.call(this.view);return value};function Writer(){this.cache={}}Writer.prototype.clearCache=function clearCache(){this.cache={}};Writer.prototype.parse=function parse(template,tags){var cache=this.cache;var tokens=cache[template];if(tokens==null)tokens=cache[template]=parseTemplate(template,tags);return tokens};Writer.prototype.render=function render(template,view,partials){var tokens=this.parse(template);var context=view instanceof Context?view:new Context(view);return this.renderTokens(tokens,context,partials,template)};Writer.prototype.renderTokens=function renderTokens(tokens,context,partials,originalTemplate){var buffer=\"\";var token,symbol,value;for(var i=0,numTokens=tokens.length;i<numTokens;++i){value=undefined;token=tokens[i];symbol=token[0];if(symbol===\"#\")value=this.renderSection(token,context,partials,originalTemplate);else if(symbol===\"^\")value=this.renderInverted(token,context,partials,originalTemplate);else if(symbol===\">\")value=this.renderPartial(token,context,partials,originalTemplate);else if(symbol===\"&\")value=this.unescapedValue(token,context);else if(symbol===\"name\")value=this.escapedValue(token,context);else if(symbol===\"text\")value=this.rawValue(token);if(value!==undefined)buffer+=value}return buffer};Writer.prototype.renderSection=function renderSection(token,context,partials,originalTemplate){var self=this;var buffer=\"\";var value=context.lookup(token[1]);function subRender(template){return self.render(template,context,partials)}if(!value)return;if(isArray(value)){for(var j=0,valueLength=value.length;j<valueLength;++j){buffer+=this.renderTokens(token[4],context.push(value[j]),partials,originalTemplate)}}else if(typeof value===\"object\"||typeof value===\"string\"||typeof value===\"number\"){buffer+=this.renderTokens(token[4],context.push(value),partials,originalTemplate)}else if(isFunction(value)){if(typeof originalTemplate!==\"string\")throw new Error(\"Cannot use higher-order sections without the original template\");value=value.call(context.view,originalTemplate.slice(token[3],token[5]),subRender);if(value!=null)buffer+=value}else{buffer+=this.renderTokens(token[4],context,partials,originalTemplate)}return buffer};Writer.prototype.renderInverted=function renderInverted(token,context,partials,originalTemplate){var value=context.lookup(token[1]);if(!value||isArray(value)&&value.length===0)return this.renderTokens(token[4],context,partials,originalTemplate)};Writer.prototype.renderPartial=function renderPartial(token,context,partials){if(!partials)return;var value=isFunction(partials)?partials(token[1]):partials[token[1]];if(value!=null)return this.renderTokens(this.parse(value),context,partials,value)};Writer.prototype.unescapedValue=function unescapedValue(token,context){var value=context.lookup(token[1]);if(value!=null)return value};Writer.prototype.escapedValue=function escapedValue(token,context){var value=context.lookup(token[1]);if(value!=null)return mustache.escape(value)};Writer.prototype.rawValue=function rawValue(token){return token[1]};mustache.name=\"mustache.js\";mustache.version=\"2.1.3\";mustache.tags=[\"{{\",\"}}\"];var defaultWriter=new Writer;mustache.clearCache=function clearCache(){return defaultWriter.clearCache()};mustache.parse=function parse(template,tags){return defaultWriter.parse(template,tags)};mustache.render=function render(template,view,partials){if(typeof template!==\"string\"){throw new TypeError('Invalid template! Template should be a \"string\" '+'but \"'+typeStr(template)+'\" was given as the first '+\"argument for mustache#render(template, view, partials)\")}return defaultWriter.render(template,view,partials)};mustache.to_html=function to_html(template,view,partials,send){var result=mustache.render(template,view,partials);if(isFunction(send)){send(result)}else{return result}};mustache.escape=escapeHtml;mustache.Scanner=Scanner;mustache.Context=Context;mustache.Writer=Writer});\n\n/**\n * Licensed under AGPL v3\n * (https://github.com/plentymarkets/plenty-cms-library/blob/master/LICENSE)\n * =====================================================================================\n * @copyright   Copyright (c) 2015, plentymarkets GmbH (http://www.plentymarkets.com)\n * @author      Felix Dausch <felix.dausch@plentymarkets.com>\n * =====================================================================================\n */\n\n/**\n * @module PlentyFramework\n */\n(function( $ )\n{\n    // will be overridden by grunt\n    var version = \"1.0.18\";\n\n    /**\n     * Collection of uncompiled registered factories & services.\n     * See {{#crossLink \"PlentyFramework/compile:method\"}}.compile(){{/crossLink}}\n     * @attribute components\n     * @static\n     * @type {{factories: {}, services: {}}}\n     */\n    var components = {\n        factories : {},\n        services  : {},\n        directives: {}\n    };\n\n    /**\n     * Framework providing client functions for plentymarkets Webshops.\n     * @class PlentyFramework\n     * @constructor\n     */\n    PlentyFramework = function()\n    {\n    };\n\n    var instance                = null;\n    PlentyFramework.getInstance = function()\n    {\n        instance = instance || new PlentyFramework();\n        return instance;\n    };\n\n    PlentyFramework.version = (function() {\n\n        return {\n            get: function() {\n                return version;\n            },\n            equals: function( v ) {\n                return compare(v) == 0;\n            },\n            compare: compare\n        };\n\n        function compare( compare )\n        {\n            var localVersion = version.split(\".\");\n            var compareVersion = compare.split(\".\");\n\n            for( var i = 0; i < compareVersion.length; i++ )\n            {\n                if( localVersion[i] === compareVersion[i] || compareVersion[i] === \"*\" )\n                {\n                    continue;\n                }\n\n                if( parseInt(localVersion[i]) < parseInt(compareVersion[i]) )\n                {\n                    return -1;\n                }\n\n                if( parseInt(localVersion[i]) > parseInt(compareVersion[i]) )\n                {\n                    return 1;\n                }\n            }\n            return 0;\n        }\n\n    })();\n\n    /**\n     * Customizable controls for partials will be injected here.\n     * (e.g. Modal)\n     * @attribute\n     * @static\n     * @type {object}\n     */\n    PlentyFramework.partials = {};\n\n    /**\n     * Collection of registered global variables\n     * @attribute\n     * @static\n     * @type {object}\n     */\n    PlentyFramework.globals = {};\n\n    /**\n     * Set a global variable.\n     * @function setGlobal\n     * @static\n     * @param {string}  identifier  A unique identifier to reference this variable\n     * @param {*}       value       The value to set\n     * @return {*}                  The value\n     */\n    PlentyFramework.setGlobal = function( identifier, value )\n    {\n        if ( PlentyFramework.globals.hasOwnProperty( identifier ) )\n        {\n            console.error( 'Global variable \"' + identifier + '\" already exists and cannot be overridden.' );\n            return null;\n        }\n\n        PlentyFramework.globals[identifier] = value;\n\n        return PlentyFramework.globals[identifier];\n    };\n\n    /**\n     * Get the value of a global variable or undefined if not exists\n     * @function getGlobal\n     * @static\n     * @param  identifier  The identifier of the requested variable\n     * @return {*}         The value of the variable\n     */\n    PlentyFramework.getGlobal = function( identifier, fallbackValue )\n    {\n        if( !PlentyFramework.globals.hasOwnProperty( identifier ) )\n        {\n            return fallbackValue;\n        }\n        return PlentyFramework.globals[identifier];\n    };\n\n    /**\n     * Collection of registered directives\n     * @type {Array}\n     * @static\n     */\n    PlentyFramework.directives = {};\n\n    /**\n     * Register directive. Directives can be bound to dynamically added nodes by calling pm.bindPlentyFunctions();\n     * @function directive\n     * @static\n     * @param   {string}    selector        jQuery selector of the DOM-elements to bind the directive to\n     * @param   {function}  callback        Function to add directives behaviour\n     * @param   {Array}     dependencies    List of required services. Services will be passed to callback function\n     * @param   {boolean}   allowDuplicates Defines if a directive can be bound to the same element multiple times\n     * @return  {object}                    The created directive\n     */\n    PlentyFramework.directive = function( directiveName, directiveFunctions, dependencies )\n    {\n        // Catch type mismatching for 'directiveName'\n        if ( typeof directiveName !== 'string' )\n        {\n            console.error( \"Type mismatch: Expect first parameter to be a 'string', '\" + typeof directiveName + \"' given.\" );\n            return;\n        }\n\n        // Catch type mismatching for 'serviceFunctions'\n        if ( typeof directiveFunctions !== 'function' )\n        {\n            console.error( \"Type mismatch: Expect second parameter to be a 'function', '\" + typeof directiveFunctions + \"' given.\" );\n            return;\n        }\n\n        dependencies = dependencies || [];\n\n        components.directives[directiveName] = {\n            name        : directiveName,\n            dependencies: dependencies,\n            setup       : directiveFunctions\n        };\n    };\n\n    /**\n     * Bind registered directives.\n     * @function bindDirectives\n     * @param {string} [directiveSelector] restrict binding to elements matching this selector\n     */\n    PlentyFramework.prototype.bindDirectives = function( rootElement )\n    {\n\n        rootElement = rootElement || 'html';\n\n        $( rootElement ).find( '[data-plenty]' ).each( function( i, element )\n        {\n\n            var directives = parseDirectives( $( element ).attr( 'data-plenty' ), $( element ) );\n\n            if ( directives.length <= 0 )\n            {\n                // continue\n                return;\n            }\n\n            addCustomEvents( element );\n\n            for ( var i = 0; i < directives.length; i++ )\n            {\n                var directive = directives[i];\n                if ( !!PlentyFramework.directives[directive.class] && PlentyFramework.directives.hasOwnProperty( directive.class ) )\n                {\n\n                    var callback = PlentyFramework.directives[directive.class][directive.method];\n                    if ( !!callback && typeof callback == \"function\" )\n                    {\n\n                        if ( directive.event == \"ready\" )\n                        {\n                            callback.apply( null, directive.params );\n                        }\n                        else\n                        {\n                            bindEventCallback( $( element ), directive.event, callback, directive.params );\n                            /*\n                             $( element ).on( directive.event, function( e )\n                             {\n                             directive = injectEvent( directive, e );\n                             return callback.apply( null, directive.params );\n                             } );\n                             */\n                        }\n\n                    }\n                    else\n                    {\n                        console.error( \"Method not found: \" + directive.method + \" in \" + directive.class );\n                    }\n\n                }\n                else\n                {\n                    console.error( \"Directive not found: \" + directive.class );\n                }\n            }\n        } );\n\n        $( document ).trigger( 'initPartials', rootElement );\n    };\n\n    var eventStack = [];\n\n    PlentyFramework.getRecentEvent = function( eventType )\n    {\n        var lastEventIdx = eventStack.length - 1;\n        if ( !eventType )\n        {\n            return eventStack[lastEventIdx];\n        }\n        else\n        {\n            for ( var i = lastEventIdx; i >= 0; i-- )\n            {\n                if ( eventType == eventStack[i].type )\n                {\n                    return eventStack[i];\n                }\n            }\n        }\n\n        return null;\n\n    };\n\n    PlentyFramework.pushEvent = function( event )\n    {\n        eventStack.push( event );\n    };\n\n    /**\n     * Bind event to element by eventType.\n     * If cms says \"click:Foo.bar(this, event)\" eventType is \"click\".\n     *\n     * @param $elem - jQuery object on which event was triggered\n     * @param eventType - type of event\n     * @param callback - callback function of directive [example: \"bar(this, event)\"]\n     * @param params - list of parameters for callback function.\n     */\n    function bindEventCallback( $elem, eventType, callback, params )\n    {\n        $elem.on( eventType, function( event )\n        {\n            eventStack.push( event );\n            return callback.apply( null, params );\n        } );\n\n        if( document.readyState === \"complete\" && eventType === \"ready\" )\n        {\n            // execute 'ready' directives directly if document is already loaded\n            callback.apply( null, params );\n        }\n    }\n\n    function addCustomEvents( element )\n    {\n\n        var $elem = $( element );\n\n        if ( $elem.is( 'input[type=\"checkbox\"]' ) )\n        {\n            $elem.on( 'change', function()\n            {\n\n                if ( $elem.is( ':checked' ) )\n                {\n                    $elem.trigger( 'check' );\n                }\n                else\n                {\n                    $elem.trigger( 'uncheck' );\n                }\n            } );\n        }\n\n        if ( $elem.is( 'input[type=\"radio\"]' ) )\n        {\n            $elem.on( 'change', function()\n            {\n\n                var radioGroup = $elem.attr( 'name' );\n\n                $( 'input[type=\"radio\"][name=\"' + radioGroup + '\"]' ).each( function( i, radio )\n                {\n                    var $radio = $( radio );\n                    if ( $radio.is( ':checked' ) )\n                    {\n                        $radio.trigger( 'check' );\n                    }\n                    else\n                    {\n                        $radio.trigger( 'uncheck' );\n                    }\n\n                } );\n\n            } );\n        }\n    }\n\n    function parseDirectives( input, thisValue )\n    {\n        var directivePattern = /^(([\\w]+):)?([\\w]+)\\.([\\w]+)(\\((.*)\\))?$/;\n        var expressions      = input.split( ';' );\n        var directives       = [];\n\n        for ( var i = 0; i < expressions.length; i++ )\n        {\n            var expression = expressions[i].trim();\n\n            if ( !expression )\n            {\n                continue;\n            }\n\n            if ( !directivePattern.test( expression ) )\n            {\n                // console.warn( \"Invalid directive: \" + expression );\n                continue;\n            }\n\n            var match = expression.match( directivePattern );\n\n            if ( !match[3] || match[3].length <= 0 )\n            {\n                console.error( \"Cannot parse '\" + expression + \"': Class name not set.\" );\n                continue;\n            }\n\n            if ( !match[4] || match[4].length <= 0 )\n            {\n                console.error( \"Cannot parse '\" + expression + \"': Method not set.\" );\n                continue;\n            }\n\n            var directive = {\n                event : match[2] || 'ready',\n                class : match[3],\n                method: match[4],\n                params: []\n            };\n\n            if ( !!match[6] && match[6].length > 0 )\n            {\n                var params = match[6].match( /(['][^']+['])|([\\w-]+)|([\"][^\"]+[\"])/g );\n                for ( var j = 0; j < params.length; j++ )\n                {\n                    var param = params[j].trim();\n                    if ( !isNaN( parseFloat( param ) ) )\n                    {\n                        directive.params.push( parseFloat( param ) );\n                    }\n                    else if ( param.toLowerCase() == 'true' )\n                    {\n                        directive.params.push( true );\n                    }\n                    else if ( param.toLowerCase() == 'false' )\n                    {\n                        directive.params.push( false );\n                    }\n                    else if ( param.toLowerCase() == 'this' )\n                    {\n                        directive.params.push( thisValue );\n                    }\n                    else\n                    {\n                        directive.params.push( param.replace( /^['\"]|['\"]$/g, '' ) );\n                    }\n                }\n            }\n\n            directives.push( directive );\n\n        }\n        return directives;\n    }\n\n    /**\n     * Register a new service\n     * @function service\n     * @static\n     * @param {string}      serviceName        Unique identifier of the service to get/ create\n     * @param {function}    serviceFunctions   Callback containing all public functions of this service.\n     * @param {Array}       [dependencies]     Identifiers of required services to inject in serviceFunctions\n     * @return {object}                        The object described in serviceFunctions(). Can be received via\n     *     PlentyFramework.[serviceName]\n     */\n    PlentyFramework.service = function( serviceName, serviceFunctions, dependencies )\n    {\n\n        // Catch type mismatching for 'serviceName'\n        if ( typeof serviceName !== 'string' )\n        {\n            console.error( \"Type mismatch: Expect first parameter to be a 'string', '\" + typeof serviceName + \"' given.\" );\n            return;\n        }\n\n        // Catch type mismatching for 'serviceFunctions'\n        if ( typeof serviceFunctions !== 'function' )\n        {\n            console.error( \"Type mismatch: Expect second parameter to be a 'function', '\" + typeof serviceFunctions + \"' given.\" );\n            return;\n        }\n\n        dependencies = dependencies || [];\n\n        components.services[serviceName] = {\n            name        : serviceName,\n            dependencies: dependencies,\n            setup       : serviceFunctions\n        };\n\n    };\n\n    /**\n     * Collection of compiled factories\n     * @attribute factories\n     * @static\n     * @type {object}\n     */\n    PlentyFramework.factories = {};\n\n    /**\n     * Register a new factory\n     * @function factory\n     * @static\n     * @param {string}      factoryName         A unique name of the new factory\n     * @param {function}    factoryFunctions    The function describing the factory\n     * @param {Array}       dependencies        List of required factories to inject\n     */\n    PlentyFramework.factory = function( factoryName, factoryFunctions, dependencies )\n    {\n\n        // Catch type mismatching for 'serviceName'\n        if ( typeof factoryName !== 'string' )\n        {\n            console.error( \"Type mismatch: Expect first parameter to be a 'string', '\" + typeof factoryName + \"' given.\" );\n            return;\n        }\n\n        // Catch type mismatching for 'serviceFunctions'\n        if ( typeof factoryFunctions !== 'function' )\n        {\n            console.error( \"Type mismatch: Expect second parameter to be a 'function', '\" + typeof factoryFunctions + \"' given.\" );\n            return;\n        }\n\n        dependencies                      = dependencies || [];\n        components.factories[factoryName] = {\n            name        : factoryName,\n            dependencies: dependencies,\n            setup       : factoryFunctions\n        }\n\n    };\n\n    /**\n     * Renders html template. Will provide given data to templates scope.\n     * Uses <a href=\"https://github.com/janl/mustache.js/\" target=\"_blank\">Mustache syntax</a> for data-binding.\n     * @function compileTemplate\n     * @static\n     * @param {String} template relative path to partials template to load. Base path = '/src/partials/'\n     * @param {Object} data     data to privide to templates scope.\n     * @returns {String}        The rendered html string\n     */\n    PlentyFramework.compileTemplate = function( template, data )\n    {\n        data           = data || {};\n        data.translate = function()\n        {\n            return function( text, render )\n            {\n                return render( PlentyFramework.translate( text ) );\n            };\n        };\n        return Mustache.render( TemplateCache[template], data );\n    };\n\n    /**\n     * The path on the server where the script is located in.\n     * @attribute\n     * @static\n     * @type {String}\n     */\n    PlentyFramework.scriptPath = '';\n\n    /**\n     * Collection of locale strings will be injected here after reading language file.\n     * @attribute\n     * @static\n     * @type {Object}\n     */\n    PlentyFramework.Strings = {};\n\n    /**\n     * Load language file containing translations of locale strings.\n     * @function loadLanguageFile\n     * @static\n     * @param fileName  relative path to language file.\n     */\n    PlentyFramework.loadLanguageFile = function( fileName )\n    {\n        $.ajax({\n            url:  PlentyFramework.scriptPath + fileName,\n            dataType: 'json'\n        }).done( function( response ) {\n            PlentyFramework.Strings = response;\n        });\n    };\n\n    /**\n     * Try to get locale translation of given string.\n     * Render translated string using <a href=\"https://github.com/janl/mustache.js/\" target=\"_blank\">Mustache syntax</a>\n     * if additional parameters are given.\n     * @function translate\n     * @static\n     * @param {String} string   The string to translate\n     * @param {Object} [params] additional data for rendering\n     * @returns {String}        The translation of the given string if found. Otherwise returns the original string.\n     */\n    PlentyFramework.translate = function( string, params )\n    {\n        var localeString;\n        if ( PlentyFramework.Strings.hasOwnProperty( string ) )\n        {\n            localeString = PlentyFramework.Strings[string];\n        }\n        else\n        {\n            localeString = string;\n            console.warn( 'No translation found for \"' + localeString + '\".' );\n        }\n\n        if ( !!params )\n        {\n            localeString = Mustache.render( localeString, params );\n        }\n\n        return localeString;\n\n    };\n\n    /**\n     * Compile registered factories & services\n     * @function compile\n     * @static\n     */\n    PlentyFramework.compile = function()\n    {\n\n        for ( var factory in components.factories )\n        {\n            if ( !PlentyFramework.factories.hasOwnProperty( factory ) )\n            {\n                //components.factories[factory].compile();\n                compileComponent( components.factories[factory], 3 );\n            }\n        }\n\n        for ( var service in components.services )\n        {\n            if ( !PlentyFramework.prototype.hasOwnProperty( service ) )\n            {\n                //components.factories[factory].compile();\n                compileComponent( components.services[service], 2 );\n            }\n        }\n\n        for ( var directive in components.directives )\n        {\n            if ( !PlentyFramework.directives.hasOwnProperty( directive ) )\n            {\n                //components.factories[factory].compile();\n                compileComponent( components.directives[directive], 1 );\n            }\n        }\n\n        // opportunity to insert a script path manually through defining\n        // data-plenty-script-path on a DOM element (i.e. a script tag)\n        if ($('[data-plenty-script-path]').length > 0) {\n          PlentyFramework.scriptPath = $('[data-plenty-script-path]').first().data('plenty-script-path');\n        }\n        else {\n          var scripts = document.getElementsByTagName( 'SCRIPT' );\n        \tfor( var i = scripts.length - 1; i >= 0; i-- ) {\n            \tvar path = scripts[i].src.match( /(.*)\\/(.*)\\.js(\\?\\S*)?$/ );\n            \tif( !!path ) {\n                \tPlentyFramework.scriptPath = path[1];\n                \tbreak;\n            \t}\n            }\n        }\n\n    };\n\n    // Level: 1 = directive, 2 = service, 3 = factory\n    function compileComponent( component, componentLevel, dependencyStack )\n    {\n        dependencyStack = dependencyStack || [];\n\n        // resolve dependencies\n        var compiledDependencies = [];\n        for ( var i = 0; i < component.dependencies.length; i++ )\n        {\n            var dependency = component.dependencies[i];\n            if ( $.inArray( dependency, dependencyStack ) < 0 )\n            {\n                // add dependency to stack to avoid cyclic injection\n                dependencyStack.push( dependency );\n\n                if ( components.factories.hasOwnProperty( dependency ) )\n                {\n                    // required dependency is a factory\n                    if ( !PlentyFramework.factories.hasOwnProperty( dependency ) )\n                    {\n                        // factory is not compiled yet\n                        compileComponent( components.factories[dependency], 3, dependencyStack );\n                    }\n                    compiledDependencies.push( PlentyFramework.factories[dependency] );\n                    continue;\n                }\n\n                if ( componentLevel <= 2 && components.services.hasOwnProperty( dependency ) )\n                {\n                    // required dependency is a service\n                    if ( !PlentyFramework.prototype.hasOwnProperty( dependency ) )\n                    {\n                        // service is not compiled yet\n                        compileComponent( components.services[dependency], 2, dependencyStack );\n                    }\n                    compiledDependencies.push( PlentyFramework.prototype[dependency] );\n                    continue;\n                }\n\n                if ( componentLevel <= 1 && components.directives.hasOwnProperty( dependency ) )\n                {\n                    // required dependency is a directive\n                    if ( !PlentyFramework.directives.hasOwnProperty( dependency ) )\n                    {\n                        // directive is not compiled yet\n                        compileComponent( components.directives[dependency], 1, dependencyStack );\n                    }\n                    compiledDependencies.push( PlentyFramework.directives[dependency] );\n                    continue;\n                }\n\n                console.error( 'Cannot inject dependency \"' + dependency + '\": Object not found.' );\n            }\n            else\n            {\n                console.error( 'Cyclic dependency injection: ' + dependencyStack.join( ' -> ' ) + ' -> ' + dependency );\n            }\n        }\n\n        // compile component\n        if ( componentLevel == 3 )\n        {\n            PlentyFramework.factories[component.name] = component.setup.apply( null, compiledDependencies );\n        }\n        else if ( componentLevel == 2 )\n        {\n            PlentyFramework.prototype[component.name] = component.setup.apply( null, compiledDependencies );\n        }\n        else if ( componentLevel == 1 )\n        {\n            PlentyFramework.directives[component.name] = component.setup.apply( null, compiledDependencies );\n        }\n    }\n\n}( jQuery ));\n\n/**\n * Licensed under AGPL v3\n * (https://github.com/plentymarkets/plenty-cms-library/blob/master/LICENSE)\n * =====================================================================================\n * @copyright   Copyright (c) 2015, plentymarkets GmbH (http://www.plentymarkets.com)\n * @author      Felix Dausch <felix.dausch@plentymarkets.com>\n * =====================================================================================\n */\n\n(function( $, pm )\n{\n    pm.directive( 'Authentication', function( AuthenticationService )\n    {\n        return {\n            login: login\n        };\n\n        function login( elem )\n        {\n            pm.getRecentEvent().preventDefault();\n            AuthenticationService.customerLogin( $( elem ) );\n        }\n    }, [\"AuthenticationService\"] );\n\n}( jQuery, PlentyFramework ));\n(function( $, pm )\n{\n    pm.directive( 'Basket', function( BasketService )\n    {\n\n        return {\n            addBasketItem     : addBasketItem,\n            changeItemQuantity: changeItemQuantity,\n            setItemQuantity   : setItemQuantity,\n            updateItemQuantity : updateItemQuantity\n        };\n\n        function addBasketItem( elem )\n        {\n            pm.getRecentEvent().preventDefault();\n            //init\n            var basketItemsList = {};\n            var scheduler       = {};\n            var $elem           = $( elem );\n            var parentForm      = $elem.parents( 'form' );\n            var $p_id           = parentForm.find( '[name=\"P_ID\"]:checked' );\n\n            scheduler.SchedulerInterval = parentForm.find( '[name=\"scheduler_interval\"]' ).val();\n            scheduler.SchedulerRepeating = parentForm.find( '[name=\"scheduler_repeating\"]' ).val();\n            scheduler.SchedulerDate = parentForm.find( '[name=\"scheduler_dateselector\"]' ).val();\n\n            basketItemsList.BasketItemItemID   = parentForm.find( '[name=\"ArticleID\"]' ).val();\n            basketItemsList.BasketItemPriceID  = parentForm.find( '[name=\"SYS_P_ID\"]' ).val();\n            basketItemsList.BasketItemQuantity = parentForm.find( '[name^=\"ArticleQuantity\"]' ).val();\n            basketItemsList.BasketItemBranchID = parentForm.find( '[name=\"source_category\"]' ).val();\n\n            // look for occurrences of unit combination and take price id of combination, if available.\n            if ( $p_id.length > 0\n                && $p_id.val() > 0 )\n            {\n                basketItemsList.BasketItemPriceID = $p_id.val();\n            }\n\n            //attributes\n            var attributeInputsList = parentForm.find( '[name^=\"ArticleAttribute\"]' );\n            var attributesList      = [];\n\n            $.each( attributeInputsList, function( idx, elem )\n            {\n                var match = elem.name.match( /^ArticleAttribute\\[\\d+]\\[\\d+]\\[(\\d+)]$/ );\n                if ( match && match[1] )\n                {\n                    attributesList.push( {\n                        BasketItemAttributeID     : match[1],\n                        BasketItemAttributeValueID: $( elem ).val()\n                    } );\n                }\n            } );\n\n            if ( attributesList.length != 0 )\n            {\n                basketItemsList.BasketItemAttributesList = attributesList;\n            }\n\n            if(typeof scheduler.SchedulerInterval !== \"undefined\"\n                && scheduler.SchedulerInterval > 0)\n            {\n                BasketService.setScheduler( scheduler );\n            }\n\n            //add basketItem and refresh previewLists\n            BasketService.addItem( [basketItemsList] );\n\n        }\n\n        function changeItemQuantity( elem, increment )\n        {\n            var $elem          = $( elem );\n            var $quantityInput = $elem.parents('[data-plenty=quantityInputWrapper]').find( '[name^=\"ArticleQuantity\"]' );\n            var maxLength      = parseInt( $quantityInput.attr( 'maxlength' ) ) || 5;\n            var value          = parseInt( $quantityInput.val() ) + increment;\n\n            setItemQuantityToNewValue( $elem, $quantityInput, maxLength, value)\n        }\n\n        function updateItemQuantity( elem )\n        {\n            var $elem = $( elem );\n            var $quantityInput = $elem;\n            var maxLength      = parseInt( $quantityInput.attr( 'maxlength' ) ) || 5;\n            var value          = convertToFloat( $quantityInput.val() );\n\n            setItemQuantityToNewValue($elem, $quantityInput, maxLength, value);\n        }\n\n        function setItemQuantity( basketItemID, input )\n        {\n            BasketService.setItemQuantity(\n                basketItemID,\n                parseInt( $( input ).val() )\n            ).fail( function()\n            {\n                // reset input's value on cancel\n                var basketItem = BasketService.getItem( basketItemID );\n                $( input ).val( basketItem.BasketItemQuantity );\n            } );\n        }\n\n        function setItemQuantityToNewValue(element, quantityInput, maxLength, value)\n        {\n            var isBasketView = element.parents( '[data-basket-item-id]' ).length > 0;\n\n            if ( isBasketView )\n            {\n                if ( (value + '').length <= maxLength && value >= 0 )\n                {\n                    quantityInput.val( value );\n                }\n\n                var timeout = element.data( 'timeout' );\n\n                if ( !!timeout )\n                {\n                    window.clearTimeout( timeout );\n                }\n\n                timeout = window.setTimeout( function()\n                {\n                    quantityInput.trigger( 'change' );\n                }, 1000 );\n\n                element.data( 'timeout', timeout );\n            }\n            else\n            {\n                if ( (value + '').length <= maxLength && value >= 1 )\n                {\n                    quantityInput.val( value );\n                    element.parents( 'form' ).find( '[name^=\"ArticleQuantity\"]' ).val( value );\n                }\n            }\n        }\n\n\n        function convertToFloat(n) {\n            n = n.replace(',', '.');\n            if(!isNaN(parseFloat(n)) && isFinite(n))\n            {\n              return parseFloat(n);\n            }\n            return 1;\n        }\n\n    }, ['BasketService'] );\n}( jQuery, PlentyFramework ));\n\n(function( $, pm )\n{\n    pm.directive( 'Checkout', function( CheckoutService )\n    {\n\n        return {\n            setMethodOfPayment: setMethodOfPayment,\n            confirmAtrigaPaymax: confirmAtrigaPaymax\n        };\n\n        function setMethodOfPayment( paymentID )\n        {\n            CheckoutService.setMethodOfPayment( paymentID );\n        }\n\n        function confirmAtrigaPaymax( atrigaPaymaxConfirmed )\n        {\n            CheckoutService.confirmAtrigaPaymax( atrigaPaymaxConfirmed );\n        }\n    }, ['CheckoutService'] );\n})( jQuery, PlentyFramework );\n/**\n * Mobile dropdowns\n * Toggles dropdowns using css class 'open' instead of pseudo class :hover\n * Usage:\n * <li class=\"dropdown\">\n *     <a data-plenty-enable=\"CONDITION\">...</a>\n * </li>\n *\n * possible values for CONDITION\n * \"touch\"                        : use 'open'-class if device is touch-device AND media size is 'md' or 'lg'\n * \"toggle-xs-sm-or-touch\" : use 'open'-class if device is \"touch\" (as above) OR media size is 'xs' or 'sm'\n *\n */\n(function( $, pm )\n{\n    pm.directive( 'MobileDropdown', function( MediaSize )\n    {\n        // store all dropdown elements\n        var dropdownElements = [];\n\n        // store dropdown elements which should be closed by clicking outside the element itself\n        var closableDropdownElements = [];\n\n        return {\n            initDropdowns: initDropdowns,\n            openDropdown : openDropdown,\n            slideDropdown: slideDropdown\n        };\n\n        function initDropdowns()\n        {\n            $( window ).on( 'orientationchange sizeChange', function()\n            {\n                if ( !$( \"input\" ).is( \":focus\" ) )\n                {\n                    resetDropdowns( dropdownElements );\n                    resetDropdowns( closableDropdownElements );\n                }\n            } );\n        }\n\n        function resetDropdowns( dropdownList, event )\n        {\n            var $current;\n            for ( var i = 0; i < dropdownList.length; i++ )\n            {\n                $current = $( dropdownList[i] );\n                if ( !!event )\n                {\n                    if ( $current.find( $( event.target ) ).length === 0\n                        && !$( \"input\" ).is( \":focus\" ) )\n                    {\n                        $current.removeClass( 'open' );\n                        $( 'html' ).unbind( \"click touchstart\", resetEvent );\n                    }\n                }\n                else\n                {\n                    if ( !$( \"input\" ).is( \":focus\" ) )\n                    {\n                        $current.removeClass( 'open' );\n                        $( 'html' ).unbind( \"click touchstart\", resetEvent );\n                    }\n                }\n            }\n\n        }\n\n        function openDropdown( elem, alwaysClickable )\n        {\n            var $elem   = $( elem );\n            var $parent = $elem.parent();\n\n            // case 1: xs || sm || ( touch && ( md || lg ) ) -> open/close via click on small devices, open/close via\n            // css-hover on desktop, open/close via click on touch-desktop (e.g. top navigation)\n\n            if ( !!alwaysClickable && ( MediaSize.isInterval( 'xs, sm' ) || ( Modernizr.touch && MediaSize.isInterval( 'md, lg' ) ) ) )\n            {\n                if ( !$parent.is( '.open' ) )\n                {\n                    showDropdownHideOthers( $elem, $parent );\n\n                    // if href\n                    if ( !$elem.attr( 'href' ) )\n                    {\n                        avoidRedirectinStopPropagation( $parent.not( $elem ) );\n                    }\n                }\n                else\n                {\n                    if ( !$elem.attr( 'href' ) )\n                    {\n                        // hide dropdown\n                        $parent.removeClass( 'open' );\n                    }\n                }\n            }\n\n            // case 2: touch && ( md || lg ) -> open via 1st click on touch-desktop, return false (e.g. main navigation)\n\n            if ( !alwaysClickable && ( Modernizr.touch && MediaSize.isInterval( 'md, lg' ) ) )\n            {\n                if ( !$parent.is( '.open' ) )\n                {\n                    showDropdownHideOthers( $elem, $parent );\n\n                    avoidRedirectinStopPropagation( $parent );\n                }\n                else\n                {\n                    // redirect to href if dropdown is already open\n                    // do nothing\n                }\n            }\n\n            // handle \"close menu on click outside\"\n            $( 'html' ).on( \"click touchstart\", resetEvent );\n        }\n\n        function showDropdownHideOthers( elem, parent )\n        {\n            var $parent = $( parent );\n\n            // hide other dropdowns\n            resetDropdowns( closableDropdownElements, elem );\n\n            // remember opened dropdown\n            if ( $.inArray( $parent[0], closableDropdownElements ) < 0 )\n            {\n                closableDropdownElements.push( $parent[0] );\n            }\n\n            // show dropdown\n            $parent.addClass( 'open' );\n        }\n\n        function avoidRedirectinStopPropagation( elem )\n        {\n            var $elem = $( elem );\n\n            // avoid redirecting\n            pm.getRecentEvent().preventDefault();\n\n            // avoid closing popup by clicking itself\n            $elem.off( 'click' );\n            $elem.on( 'click', function( e )\n            {\n                e.stopPropagation();\n            } );\n        }\n\n        function slideDropdown( elem )\n        {\n            var $elem       = $( elem );\n            var $elemParent = $elem.parent();\n\n            // size interval query is required since function is used on document ready to initial open active\n            // navigation (on small devices)\n            if ( MediaSize.isInterval( 'xs, sm' ) )\n            {\n                $elemParent.addClass( 'animating' );\n                $elem.siblings( 'ul' ).slideToggle( 400, function()\n                {\n                    if ( $elemParent.is( '.open' ) && !$( \"input\" ).is( \":focus\" ) )\n                    {\n                        $elemParent.removeClass( 'open' );\n                        $elem.siblings( 'ul' ).removeAttr( 'style' );\n                        $elemParent.removeClass( 'animating' );\n                    }\n                    else\n                    {\n                        $elemParent.addClass( 'open' );\n                        if ( $.inArray( $elemParent[0], dropdownElements ) < 0 )\n                        {\n                            dropdownElements.push( $elemParent[0] );\n                        }\n                    }\n                } );\n            }\n\n            // handle \"close menu on click outside\"\n            $( 'html' ).on( \"click touchstart\", resetEvent );\n        }\n\n        function resetEvent( event )\n        {\n            resetDropdowns( closableDropdownElements, event );\n        }\n\n    }, ['MediaSizeService'] );\n}( jQuery, PlentyFramework ));\n(function( $, pm )\n{\n    pm.directive( 'Redirect', function( MediaSizeService, NavigatorService )\n    {\n\n        return {\n            to           : to,\n            toCheckoutTab: toCheckoutTab\n        };\n\n        function to( href )\n        {\n            if ( MediaSizeService.interval() != 'xs' )\n            {\n                if ( typeof href === 'string' && href.indexOf('/') == -1 && $( href ).length > 0 )\n                {\n                    window.location.assign( $( href ).attr( 'href' ) );\n                }\n                else\n                {\n                    window.location.assign( href );\n                }\n            }\n        }\n\n        function toCheckoutTab( tabID )\n        {\n            NavigatorService.goToID( tabID );\n        }\n\n    }, ['MediaSizeService', 'NavigatorService'] );\n}( jQuery, PlentyFramework ));\n(function( $, pm )\n{\n    pm.directive( 'Tab', function( MediaSize )\n    {\n\n        var tabGroups = {};\n\n        return {\n            showTab        : showTab,\n            initRemoteLabel: initRemoteLabel,\n            initRemoteTab  : initRemoteTab,\n            showRemoteTab  : showRemoteTab\n        };\n\n        function showTab( tabSelector )\n        {\n            $( tabSelector ).tab( 'show' );\n        }\n\n        function initRemoteLabel( $elem, tabID, groupID )\n        {\n            if ( !tabGroups[groupID] )\n            {\n                tabGroups[groupID] = new TabGroup();\n            }\n\n            if ( !tabGroups[groupID].getTab( tabID ) )\n            {\n                tabGroups[groupID].addTab( tabID );\n            }\n\n            tabGroups[groupID].getTab( tabID ).addLabel( $elem );\n        }\n\n        function initRemoteTab( $elem, tabID, groupID )\n        {\n            if ( !tabGroups[groupID] )\n            {\n                tabGroups[groupID] = new TabGroup();\n            }\n\n            if ( !tabGroups[groupID].getTab( tabID ) )\n            {\n                tabGroups[groupID].addTab( tabID );\n            }\n\n            tabGroups[groupID].getTab( tabID ).setContent( $elem );\n        }\n\n        function showRemoteTab( tabID, groupID, interval )\n        {\n            if ( MediaSize.isInterval( interval ) )\n            {\n                pm.getRecentEvent().preventDefault();\n\n                if ( !!tabGroups[groupID] && !!tabGroups[groupID].getTab( tabID ) )\n                {\n                    tabGroups[groupID].showTab( tabID );\n                }\n\n            }\n        }\n\n        function TabGroup()\n        {\n            var tabs = {};\n            var activeTab;\n\n            return {\n                addTab   : addTab,\n                showTab  : showTab,\n                getTab   : getTab,\n                resetTabs: resetTabs\n            };\n\n            function addTab( tabID )\n            {\n                tabs[tabID] = new Tab( tabID );\n                return tabs[tabID];\n            }\n\n            function showTab( tabID )\n            {\n                var zIndex = 0;\n                if ( !!activeTab )\n                {\n                    // activeTab is set\n                    zIndex = parseInt( activeTab.getContent().parent().css( 'zIndex' ) );\n                    activeTab.hide();\n                    activeTab.getContent().parent().css( 'zIndex', zIndex - 1 );\n                }\n                else\n                {\n                    // activeTab not set before\n                    for ( var tab in tabs )\n                    {\n                        if ( !!tabs[tab].getContent() )\n                        {\n                            var currentZ = parseInt( tabs[tab].getContent().parent().css( 'zIndex' ) );\n                            if ( zIndex == 0 || currentZ < zIndex )\n                            {\n                                zIndex = currentZ;\n                            }\n                            tabs[tab].hide();\n                        }\n                    }\n\n                    for ( var tab in tabs )\n                    {\n                        if ( !!tabs[tab].getContent() )\n                        {\n                            tabs[tab].getContent().parent().css( 'zIndex', zIndex - 1 );\n                        }\n                    }\n\n                    //$( window ).on( 'sizeChange', resetTabs );\n                }\n\n                activeTab = tabs[tabID];\n                activeTab.getContent().parent().css( 'zIndex', zIndex );\n                activeTab.show();\n            }\n\n            function getTab( tabID )\n            {\n                return tabs[tabID];\n            }\n\n            function resetTabs()\n            {\n                for ( var tab in tabs )\n                {\n                    if ( !!tabs[tab].getContent() )\n                    {\n                        tabs[tab].show();\n                    }\n                }\n\n                activeTab = null;\n            }\n        }\n\n        function Tab( id )\n        {\n            var $content;\n            var $labels = [];\n            var tabID   = id;\n\n            return {\n                addLabel  : addLabel,\n                setContent: setContent,\n                getContent: getContent,\n                getID     : getID,\n                show      : show,\n                hide      : hide\n            };\n\n            function getID()\n            {\n                return tabID;\n            }\n\n            function addLabel( label )\n            {\n                $labels.push( label );\n                return this;\n            }\n\n            function setContent( content )\n            {\n                $content = content;\n                return this;\n            }\n\n            function getContent()\n            {\n                return $content;\n            }\n\n            function show()\n            {\n                for ( var i = 0; i < $labels.length; i++ )\n                {\n                    $labels[i].addClass( 'active' );\n                }\n\n                if ( !!$content )\n                {\n                    $content.show().addClass( 'in' );\n                }\n\n            }\n\n            function hide()\n            {\n                for ( var i = 0; i < $labels.length; i++ )\n                {\n                    $labels[i].removeClass( 'active' );\n                }\n\n                if ( !!$content )\n                {\n                    $content.hide().removeClass( 'in' );\n                }\n            }\n        }\n\n    }, ['MediaSizeService'] );\n})( jQuery, PlentyFramework );\n/**\n * Add fancy ui modifications - the visual stuff - here.\n * Respond functionality like 'event':UI.myFunctionality(currentElement)\n *\n * Example:\n *      <button type=\"button\" data-plenty=\"click:UI.addTooltip(this)\">go to top</button>\n *\n */\n(function( $, pm )\n{\n    pm.directive( 'UI', function( MediaSizeService, SocialShareService, UIFactory )\n    {\n        // elements to calculate height.\n        var equalHeightElementList = [];\n        var toTopButtonList        = [];\n\n        return {\n            initUIWindowEvents  : initUIWindowEvents,\n            showWaitscreen      : showWaitscreen,\n            hideWaitscreen      : hideWaitscreen,\n            addContentPageSlider: addContentPageSlider,\n            equalHeight         : equalHeight,\n            initToTop           : initToTop,\n            initLazyload        : initLazyload,\n            initSlideToggle     : initSlideToggle,\n            slideDown           : slideDown,\n            slideUp             : slideUp,\n            slideToggle         : slideToggle,\n            toggleHideShow      : toggleHideShow,\n            toggleSocialShare   : toggleSocialShare,\n            toggleClass         : toggleClass,\n            addClass            : addClass,\n            removeClass         : removeClass\n        };\n\n        function initUIWindowEvents()\n        {\n            // resize elements on window size change.\n            $( window ).on( 'sizeChange contentChanged', function()\n            {\n                fireEqualHeight();\n            } );\n\n            $( window ).on( \"scroll resize\", function()\n            {\n                if ( toTopButtonList.length > 0 )\n                {\n                    if ( $( document ).scrollTop() > 100 )\n                    {\n                        doToArrayElements( toTopButtonList, \"addClass\", \"visible\" );\n                    }\n                    else\n                    {\n                        doToArrayElements( toTopButtonList, \"removeClass\", \"visible\" );\n                    }\n                }\n            } );\n        }\n\n        /**\n         * Display waitscreen on page e.g. for requests.\n         * Use with care and don't forget to hide waitscreen, if your calls are done or broke!!\n         */\n        function showWaitscreen()\n        {\n            UIFactory.showWaitscreen();\n        }\n\n        /**\n         * Just hide the waitscreen.\n         * @param forceClose\n         */\n        function hideWaitscreen( forceClose )\n        {\n            UIFactory.hideWaitscreen( forceClose );\n        }\n\n        /**\n         * Adds content page slider (owlCarousel)\n         *\n         * usage:\n         * <div class=\"contentpageSlider\" data-plenty=\"contentpageSlider\">\n         *     <div class=\"slide\">\n         *         ...\n         *     </div>\n         *     <div class=\"slide\">\n         *         ...\n         *     </div>\n         *     ...\n         * </div>\n         *\n         * Legacy directive selector: data-plenty=\"contentpageSlider\"\n         *\n         * @param elem\n         */\n        function addContentPageSlider( elem )\n        {\n            $( elem ).owlCarousel( {\n                navigation     : true,\n                navigationText : false,\n                slideSpeed     : 1000,\n                paginationSpeed: 1000,\n                singleItem     : true,\n                autoPlay       : 6000,\n                stopOnHover    : true,\n                afterMove      : function( current )\n                {\n                    $( current ).find( '[data-plenty-rel=\"lazyload\"]' ).trigger( 'appear' );\n                }\n            } );\n        }\n\n        /**\n         * Equal Box height\n         * Calculates equal box height for chosen elements.\n         *\n         * Legacy directive selector: data-plenty-equal\n         *\n         * @param elem\n         * @param elementExists - default false\n         */\n        function equalHeight( elem, mediaSizes, elementExists )\n        {\n            var $elem            = $( elem );\n            var maxHeight        = 0;\n            var $equalTarget     = {};\n            var $equalTargetList = $elem.find( '[data-plenty-rel=\"equal-target\"]' ).length > 0 ? $elem.find( '[data-plenty-rel=\"equal-target\"]' ) : $elem.children();\n\n            // if element wasn't pushed before.\n            if ( elementExists !== true )\n            {\n                equalHeightElementList.push( elem );\n            }\n\n            for ( var i = $equalTargetList.length; i >= 0; i-- )\n            {\n                $equalTarget = $( $equalTargetList[i] );\n                $equalTarget.css( 'height', '' );\n\n                if ( $equalTarget.outerHeight( true ) > maxHeight )\n                {\n                    maxHeight = $equalTarget.outerHeight( true );\n                }\n            }\n\n            if ( !mediaSizes || MediaSizeService.isInterval( mediaSizes ) )\n            {\n                $equalTargetList.height( maxHeight );\n            }\n        }\n\n        /**\n         * Scroll page to top.\n         * Just add without events.\n         *\n         * Legacy directive selector: data-plenty=\"toTop\"\n         *\n         * @param elem\n         */\n        function initToTop( elem )\n        {\n            var $elem = $( elem );\n\n            $elem.click( function()\n            {\n                $( 'html, body' ).animate( {\n                    scrollTop: 0\n                }, 400 );\n                return false;\n            } );\n\n            if ( !!$.inArray( $elem, toTopButtonList ) )\n            {\n                toTopButtonList.push( $elem );\n            }\n        }\n\n        /**\n         * lazy load on ready.\n         *\n         * Legacy directive selector: img[data-plenty-lazyload]\n         *\n         * @param elem\n         */\n        function initLazyload( elem, effect )\n        {\n            var $elem = $( elem );\n\n            $elem.lazyload( {\n                effect: effect\n            } );\n            if ( $elem.is( 'img' ) )\n            {\n                $elem.on( 'loaded', function()\n                {\n                    $elem.css( 'display', 'inline-block' );\n                } );\n            }\n        }\n\n        /**\n         * Toggle show and hide animation.\n         *\n         * Legacy directive selector: data-plenty=\"openCloseToggle\"\n         *\n         * @param elem\n         */\n        function toggleHideShow( elem )\n        {\n\n            console.log( elem );\n\n            var $elem       = $( elem );\n            var $elemParent = $elem.parent();\n\n            $elemParent.addClass( 'animating' );\n            $elem.siblings( 'ul' ).slideToggle( 200, function()\n            {\n                if ( $elemParent.is( '.open' ) )\n                {\n                    $elemParent.removeClass( 'open' );\n                }\n                else\n                {\n                    $elemParent.addClass( 'open' );\n                }\n                $elem.siblings( 'ul' ).removeAttr( 'style' );\n                $elemParent.removeClass( 'animating' );\n            } );\n        }\n\n        /**\n         * Toggle target content on click.\n         * Bind to checked-/ unchecked-property of radio buttons\n         *\n         * Legacy directive selector: data-plenty-slidetoggle\n         *\n         * @param elem\n         */\n        function initSlideToggle( elem, checked )\n        {\n            var $elem          = $( elem );\n            var $targetElement = $( $elem.attr( 'data-plenty-rel' ) );\n\n            if ( $elem.is( 'input[type=\"radio\"]' ) )\n            {\n                // is radio button\n                var $radioGroupList  = $( 'input[type=\"radio\"][name=\"' + ( $elem.attr( 'name' ) ) + '\"]' );\n                var visibleOnChecked = !checked || checked == 'checked';\n\n                $radioGroupList.change( function()\n                {\n                    var $self = $( this );\n                    $targetElement.parents( '[data-plenty-rel=\"equal-target\"]' ).css( 'height', 'auto' );\n\n                    if ( $self.is( ':checked' ) && $self[0] === $elem[0] && visibleOnChecked == true )\n                    {\n                        // checked\n                        $targetElement.slideDown( 400, function()\n                        {\n                            fireEqualHeight();\n                        } );\n                    }\n                    else\n                    {\n                        // unchecked (since other radio button has been checked)\n                        $targetElement.slideUp( 400, function()\n                        {\n                            fireEqualHeight();\n                        } );\n                    }\n                } );\n            }\n            else\n            {\n                // is not radio button\n                $elem.click( function()\n                {\n                    //$targetElement.parents( '[data-plenty-rel=\"equal-target\"]' ).css( 'height', 'auto' );\n\n                    $elem.addClass( 'animating' );\n                    $targetElement.slideToggle( 400, function()\n                    {\n                        $elem.removeClass( 'animating' );\n                        $elem.toggleClass( 'active' );\n                        fireEqualHeight();\n                    } );\n                } );\n            }\n        }\n\n        function slideDown( target, duration )\n        {\n            slideAction( $( target ), duration, 'slideDown' );\n        }\n\n        function slideUp( target, duration )\n        {\n            slideAction( $( target ), duration, 'slideUp' );\n        }\n\n        function slideToggle( target, duration )\n        {\n            slideAction( $( target ), duration, 'slideToggle' );\n        }\n\n        function slideAction( $target, duration, callbackString )\n        {\n            duration = duration || 400;\n            $target.parents( '[data-plenty-rel=\"equal-target\"]' ).css( 'height', 'auto' );\n            $target[callbackString]( duration, function()\n            {\n                fireEqualHeight();\n            } );\n        }\n\n        /**\n         * TODO check comment\n         * Social Share Activation\n         * Activate and load share-buttons manually by clicking a separate button\n         * Usage / data-attributes:\n         * <div data-plenty-social=\"twitter\">\n         *    <span data-plenty=\"switch\"></span>        Will be used to activate the service set in\n         * data-plenty-social=\"\"\n         *    <span data-plenty=\"placeholder\"></span>   Will be replaced with loaded share button\n         * </div>\n         *\n         * possible values for data-plenty-social:\n         * \"facebook-like\"            : Load Facebooks \"Like\"-Button\n         * \"facebook-recommend\"        : Load Facebooks \"Recommend\"-Button\n         * \"twitter\"                : Load Twitter Button\n         * \"google-plus\"            : Load google \"+1\"-Button\n         *\n         * Additional Tooltips\n         * You can extend the parent element with a (bootstrap) tooltip by adding data-toggle=\"tooltip\" and\n         * title=\"TOOLTIP CONTENT\" Tooltip will be destroyed after activating a social service\n         * (!) Requires bootstrap.js\n         *\n         * Legacy directive selector: data-plenty-social\n         *\n         * @param elem\n         */\n        function toggleSocialShare( elem, socialShareService )\n        {\n            var $elem   = $( elem );\n            var $toggle = $elem.find( '[data-plenty-rel=\"social-switch\"]' );\n\n            // append container to put / delete service.html\n            $elem.append( '<div class=\"social-container\"></div>' );\n\n            // add \"off\" class to switch, if neither \"off\" or \"on\" is set\n            // replaced hasClass() with is() benchmark: http://jsperf.com/hasclasstest\n            if ( !$toggle.is( 'off, on' ) )\n            {\n                $toggle.addClass( 'off' );\n            }\n\n            // toggle switch\n            $toggle.on( 'click', function()\n            {\n                if ( $toggle.hasClass( 'off' ) )\n                {\n                    // TODO remove bootstrap dependency\n                    if ( $elem.attr( \"data-toggle\" ) == \"tooltip\" )\n                    {\n                        $elem.tooltip( 'destroy' )\n                    }\n                    $toggle.removeClass( 'off' ).addClass( 'on' );\n                    // hide dummy button\n                    $elem.find( '[data-plenty-rel=\"social-placeholder\"]' ).hide();\n                    // load HTML defined in 'api'\n                    $elem.find( '.social-container' ).append( SocialShareService.getSocialService( socialShareService ) );\n                }\n                // do not disable social medias after activation\n            } );\n        }\n\n        /**\n         * Toggle Class\n         * toggle style-classes on click\n         * Usage / data-attribute:\n         * <div data-plenty-toggle=\"{target: 'body', class: 'toggledClass', media: 'xs sm'}\"></div>\n         * target    :    jQuery selector to toggle the class at.\n         * class        :  class(es) to toggle at target element\n         * media        :  only toggle class on given media sizes (optional)\n         *\n         * (!) using data-plenty-toggle on <a>-elements will prevent redirecting to href=\"\"\n         *\n         * Legacy directive selector: data-plenty-toggle\n         *\n         * @param cssClass\n         * @param target\n         * @param interval\n         */\n        function toggleClass( cssClass, target, interval )\n        {\n            var $target = $( target );\n            /* FIXME\n             * Callisto 3.1 Design adaption:\n             * NavigationCategoriesList\n             * Line 8\n             * BEFORE:\n             * <li class=\"cat-$CategoryId{% if $CategoryLevel == 1 && $SubCategoryExists %} dropdown{% endif %}{% if $SubCategoryExists %} hasSublevel{% endif %}{% if $CategoryLevel == 1 && in_array($CategoryId, $_useBigMenu) %} bigmenu{% endif %}{% if $CategoryIsOpen || $CategoryIsCurrent %} active{% endif %}\"{% if $CategoryIsOpen || $CategoryIsCurrent %} data-plenty=\"UI.toggleClass('open', this, 'xs, sm')\"{% endif %}>\n             * AFTER:\n             * <li class=\"cat-$CategoryId{% if $CategoryLevel == 1 && $SubCategoryExists %} dropdown{% endif %}{% if $SubCategoryExists %} hasSublevel{% endif %}{% if $CategoryLevel == 1 && in_array($CategoryId, $_useBigMenu) %} bigmenu{% endif %}{% if $CategoryIsOpen || $CategoryIsCurrent %} active{% endif %}\">\n             *\n             * Line 10\n             * BEFORE:\n             * <span class=\"openCloseToggle\" data-plenty=\"click:MobileDropdown.slideDropdown(this)\"></span>\n             * AFTER:\n             * <span class=\"openCloseToggle\" data-plenty=\"{% if $CategoryIsOpen || $CategoryIsCurrent %}MobileDropdown.slideDropdown(this); {% endif %}click:MobileDropdown.slideDropdown(this)\"></span>\n             *\n             * */\n            if ( $target.parents( \".navbar-main\" ).length > 0 )\n            {\n                var $elem = $target.children( \"span\" );\n                pm.directives[\"MobileDropdown\"].slideDropdown( $elem );\n                return true;\n            }\n\n            if ( !!target && !!cssClass && ( !interval || MediaSizeService.isInterval( interval ) ) )\n            {\n                var e = pm.getRecentEvent();\n                if ( !!e )\n                {\n                    e.preventDefault();\n                }\n\n                $target.toggleClass( cssClass );\n                return false;\n            }\n        }\n\n        function addClass( cssClass, target, interval )\n        {\n            if ( !!target && !!cssClass && ( !interval || MediaSizeService.isInterval( interval ) ) )\n            {\n                var e = pm.getRecentEvent();\n                if ( !!e )\n                {\n                    e.preventDefault();\n                }\n\n                $( target ).addClass( cssClass );\n                return false;\n            }\n        }\n\n        function removeClass( cssClass, target, interval )\n        {\n            if ( !!target && !!cssClass && ( !interval || MediaSizeService.isInterval( interval ) ) )\n            {\n                var e = pm.getRecentEvent();\n                if ( !!e )\n                {\n                    e.preventDefault();\n                }\n\n                $( target ).removeClass( cssClass );\n                return false;\n            }\n        }\n\n        /*\n         ##### PRIVATE FUNCTIONS ######\n         */\n\n        function fireEqualHeight()\n        {\n            for ( var i = equalHeightElementList.length - 1; i >= 0; i-- )\n            {\n                equalHeight( equalHeightElementList[i], '', true );\n            }\n        }\n\n        function doToArrayElements( array, func, params )\n        {\n            for ( var i = array.length - 1; i >= 0; i-- )\n            {\n                array[i][func]( params );\n            }\n        }\n\n    }, ['MediaSizeService', 'SocialShareService', 'UIFactory'] );\n}( jQuery, PlentyFramework ));\n(function( $, pm )\n{\n    pm.directive( 'Validator', function( ValidationService )\n    {\n\n        return {\n            validate: validate\n        };\n\n        function validate( form, errorClass )\n        {\n            return ValidationService.validate( form, errorClass );\n        }\n\n    }, ['ValidationService'] );\n}( jQuery, PlentyFramework ));\n/**\n * Licensed under AGPL v3\n * (https://github.com/plentymarkets/plenty-cms-library/blob/master/LICENSE)\n * =====================================================================================\n * @copyright   Copyright (c) 2015, plentymarkets GmbH (http://www.plentymarkets.com)\n * @author      Felix Dausch <felix.dausch@plentymarkets.com>\n * =====================================================================================\n */\n\n/**\n * @module Factories\n */\n(function( $, pm )\n{\n\n    /**\n     * Handles requests to ReST API. Provides a {{#crossLink \"APIFactory/handleError:method\"}}default\n     * error-handling{{/crossLink}}. Request parameters will be parsed to json internally<br>\n     * <b>Requires:</b>\n     * <ul>\n     *     <li>{{#crossLink \"UIFactory\"}}UIFactory{{/crossLink}}</li>\n     * </ul>\n     * @class APIFactory\n     * @static\n     */\n    pm.factory( 'APIFactory', function( UI, Modal )\n    {\n\n        var sessionExpirationTimeout = null;\n        $( document ).ready( function()\n        {\n            renewLoginSession();\n        } );\n\n        return {\n            get   : _get,\n            post  : _post,\n            put   : _put,\n            delete: _delete,\n            idle  : _idle\n        };\n\n        function renewLoginSession()\n        {\n            if ( !pm.getGlobal( 'LoginSession' ) )\n            {\n                return;\n            }\n\n            if ( !!sessionExpirationTimeout )\n            {\n                clearTimeout( sessionExpirationTimeout );\n            }\n\n            sessionExpirationTimeout = setTimeout( function()\n            {\n                $( window ).trigger( 'login-expired' );\n\n                if ( pm.getGlobal( 'PageDesign' ) === \"Checkout\" )\n                {\n                    Modal.prepare()\n                        .setTitle( pm.translate( 'Your session has expired.' ) )\n                        .setContent( pm.translate( 'Please log in again to continue shopping.' ) )\n                        .setLabelDismiss( null )\n                        .setLabelConfirm( pm.translate( 'OK' ) )\n                        .onConfirm( function()\n                        {\n                            window.location.assign( '/' );\n                        } )\n                        .onDismiss( function()\n                        {\n                            window.location.assign( '/' );\n                        } )\n                        .show();\n                }\n\n            }, pm.getGlobal( 'LoginSessionExpiration' ) );\n        }\n\n        /**\n         * Is called by default if a request failed.<br>\n         * Can be prevented by setting the requests last parameter to false.\n         *\n         * @function handleError\n         * @private\n         *\n         * @param {object} jqXHR   <a href=\"http://api.jquery.com/category/deferred-object/\" target=\"_blank\">jQuery\n         *     deferred Object</a>\n         */\n        function handleError( jqXHR )\n        {\n            try\n            {\n                var responseText = $.parseJSON( jqXHR.responseText );\n                UI.printErrors( responseText.error.error_stack );\n            }\n            catch ( e )\n            {\n                UI.throwError( jqXHR.status, jqXHR.statusText );\n            }\n        }\n\n        /**\n         * Sends a GET request to ReST-API\n         *\n         * @function get\n         *\n         * @param   {string}    url                     The URL to send the request to\n         * @param   {object}    params                  The data to append to requests body. Will be converted to JSON\n         *     internally\n         * @param   {boolean}   [ignoreErrors=false]    disable/ enable defaults error handling\n         * @param   {boolean}   [runInBackground=false] show wait screen while request is in progress.\n         * @return  {object}    <a href=\"http://api.jquery.com/category/deferred-object/\" target=\"_blank\">jQuery\n         *     deferred Object</a>\n         */\n        function _get( url, params, ignoreErrors, runInBackground, sync )\n        {\n\n            if ( !runInBackground )\n            {\n                UI.showWaitScreen();\n            }\n\n            return $.ajax(\n                url,\n                {\n                    type    : 'GET',\n                    data    : params,\n                    dataType: 'json',\n                    async   : !sync,\n                    error   : function( jqXHR )\n                    {\n                        if ( !ignoreErrors )\n                        {\n                            handleError( jqXHR )\n                        }\n                    }\n                }\n            ).always( function()\n            {\n                if ( !runInBackground )\n                {\n                    UI.hideWaitScreen();\n                }\n                renewLoginSession();\n            } );\n\n        }\n\n        /**\n         * Sends a POST request to ReST-API\n         *\n         * @function post\n         *\n         * @param   {string}    url                     The URL to send the request to\n         * @param   {object}    data                    The data to append to requests body. Will be converted to JSON\n         *     internally\n         * @param   {boolean}   [ignoreErrors=false]    disable/ enable defaults error handling\n         * @param   {boolean}   [runInBackground=false] show wait screen while request is in progress.\n         * @return  {object}    <a href=\"http://api.jquery.com/category/deferred-object/\" target=\"_blank\">jQuery\n         *     deferred Object</a>\n         */\n        function _post( url, data, ignoreErrors, runInBackground )\n        {\n\n            var params = {\n                type    : 'POST',\n                dataType: 'json',\n                error   : function( jqXHR )\n                {\n                    if ( !ignoreErrors )\n                    {\n                        handleError( jqXHR )\n                    }\n                }\n            };\n\n            if ( !!data && data.isFile )\n            {\n                params.cache       = data.cache;\n                params.processData = data.processData;\n                params.data        = data.data;\n                params.contentType = false;\n            }\n            else\n            {\n                params.data        = JSON.stringify( data );\n                params.contentType = 'application/json';\n            }\n\n            if ( !runInBackground )\n            {\n                UI.showWaitScreen();\n            }\n\n            return $.ajax(\n                url, params\n            ).always( function()\n            {\n                if ( !runInBackground )\n                {\n                    UI.hideWaitScreen();\n                }\n                renewLoginSession();\n            } );\n        }\n\n        /**\n         * Sends a PUT request to ReST-API\n         *\n         * @function put\n         *\n         * @param   {string}    url                     The URL to send the request to\n         * @param   {object}    data                    The data to append to requests body. Will be converted to JSON\n         *     internally\n         * @param   {boolean}   [ignoreErrors=false]    disable/ enable defaults error handling\n         * @param   {boolean}   [runInBackground=false] show wait screen while request is in progress.\n         * @return  {object}    <a href=\"http://api.jquery.com/category/deferred-object/\" target=\"_blank\">jQuery\n         *     deferred Object</a>\n         */\n        function _put( url, data, ignoreErrors, runInBackground )\n        {\n\n            if ( !runInBackground )\n            {\n                UI.showWaitScreen();\n            }\n\n            return $.ajax(\n                url,\n                {\n                    type       : 'PUT',\n                    data       : JSON.stringify( data ),\n                    dataType   : 'json',\n                    contentType: 'application/json',\n                    error      : function( jqXHR )\n                    {\n                        if ( !ignoreErrors )\n                        {\n                            handleError( jqXHR )\n                        }\n                    }\n                }\n            ).always( function()\n            {\n                if ( !runInBackground )\n                {\n                    UI.hideWaitScreen();\n                }\n                renewLoginSession();\n            } );\n\n        }\n\n        /**\n         * Sends a DELETE request to ReST-API\n         *\n         * @function delete\n         *\n         * @param   {string}    url                     The URL to send the request to\n         * @param   {object}    data                    The data to append to requests body. Will be converted to JSON\n         *     internally\n         * @param   {boolean}   [ignoreErrors=false]    disable/ enable defaults error handling\n         * @param   {boolean}   [runInBackground=false] show wait screen while request is in progress.\n         * @returns {object}    <a href=\"http://api.jquery.com/category/deferred-object/\" target=\"_blank\">jQuery\n         *     deferred Object</a>\n         */\n        function _delete( url, data, ignoreErrors, runInBackground )\n        {\n\n            if ( !runInBackground )\n            {\n                UI.showWaitScreen();\n            }\n\n            return $.ajax(\n                url,\n                {\n                    type       : 'DELETE',\n                    data       : JSON.stringify( data ),\n                    dataType   : 'json',\n                    contentType: 'application/json',\n                    error      : function( jqXHR )\n                    {\n                        if ( !ignoreErrors )\n                        {\n                            handleError( jqXHR )\n                        }\n                    }\n                }\n            ).always( function()\n            {\n                if ( !runInBackground )\n                {\n                    UI.hideWaitScreen();\n                }\n                renewLoginSession();\n            } );\n\n        }\n\n        /**\n         * Get a idle request doing nothing for chaining methods\n         * @returns {object}    <a href=\"http://api.jquery.com/category/deferred-object/\" target=\"_blank\">jQuery\n         *     deferred Object</a>\n         */\n        function _idle()\n        {\n            return $.Deferred().resolve();\n        }\n\n    }, ['UIFactory', 'ModalFactory'] );\n}( jQuery, PlentyFramework ));\n\n/**\n * Licensed under AGPL v3\n * (https://github.com/plentymarkets/plenty-cms-library/blob/master/LICENSE)\n * =====================================================================================\n * @copyright   Copyright (c) 2015, plentymarkets GmbH (http://www.plentymarkets.com)\n * @author      Felix Dausch <felix.dausch@plentymarkets.com>\n * =====================================================================================\n */\n\n/**\n * @module Factories\n */\n(function( pm )\n{\n\n    /**\n     * Provide methods for receiving layout containers, layout parameters\n     * or category content from API<br>\n     * <b>Requires:</b>\n     * <ul>\n     *     <li>{{#crossLink \"APIFactory\"}}APIFactory{{/crossLink}}</li>\n     * </ul>\n     * @class CMSFactory\n     * @static\n     */\n    pm.factory( 'CMSFactory', function( API )\n    {\n\n        return {\n            getContainer      : getContainer,\n            getParams         : getParams,\n            getCategoryContent: getCategoryContent\n        };\n\n        /**\n         * Prepare the request to receive HTML-Content from CMS\n         * @function getContainer\n         * @param   {string}    containerName The Layoutcontainer to receive.\n         * @param   {object}    params Additional GET-parameters.\n         * @returns {object}    The prepared request. Call <code>.from( layoutGroup )</code> to specify the location in\n         *     the CMS\n         *                      (e.g. 'Checkout')\n         * @example\n         *          CMSFactory.getContainer( 'CheckoutTotals' ).from( 'Checkout' )\n         *              .done(function( response ) {\n         *                  // container content\n         *                  var html = response.data[0]\n         *              });\n         */\n        function getContainer( containerName, params )\n        {\n\n            function from( layoutGroup )\n            {\n                return API.get( '/rest/' + layoutGroup.toLowerCase() + '/container_' + containerName.toLowerCase() + '/', params );\n            }\n\n            return {\n                from: from\n            }\n\n        }\n\n        /**\n         * Prepare the request to receive Layout parameters for a template\n         * @function getParams\n         * @param   {string} containerName The Layoutcontainer to receive the parameteres of.\n         * @param   {object} params   Additional GET-parameters.\n         * @returns {object}               The prepared request. Call <code>.from( layoutGroup )</code> to specify the\n         *     location in the CMS\n         *                                 (e.g. 'ItemView')\n         * @example\n         *          CMSFactory.getParams( 'BasketItemsList' ).from( 'ItemView' )\n         *              .done(function( response ) {\n         *                  // BasketItems\n         *                  var items = response.data;\n         *              });\n         */\n        function getParams( containerName, params )\n        {\n\n            function from( layoutGroup )\n            {\n                return API.get( '/rest/' + layoutGroup.toLowerCase() + '/' + containerName.toLowerCase() + '/', params );\n            }\n\n            return {\n                from: from\n            }\n        }\n\n        /**\n         * Get the content of a category specified by its ID\n         * @function getCategoryContent\n         * @param   {number} categoryID    The ID of the category to get the content from\n         * @returns {object} <a href=\"http://api.jquery.com/category/deferred-object/\" target=\"_blank\">jQuery deferred\n         *     Object</a>\n         */\n        function getCategoryContent( categoryID )\n        {\n            return API.get( '/rest/categoryview/categorycontentbody/?categoryID=' + categoryID );\n        }\n\n    }, ['APIFactory'] );\n}( PlentyFramework ));\n/**\n * Licensed under AGPL v3\n * (https://github.com/plentymarkets/plenty-cms-library/blob/master/LICENSE)\n * =====================================================================================\n * @copyright   Copyright (c) 2015, plentymarkets GmbH (http://www.plentymarkets.com)\n * @author      Felix Dausch <felix.dausch@plentymarkets.com>\n * =====================================================================================\n */\n\n/**\n * @module Factories\n */\n(function( pm )\n{\n\n    /**\n     * Holds checkout data for global access and provides methods\n     * for reloading content dynamically-<br>\n     * <b>Requires:</b>\n     * <ul>\n     *     <li>{{#crossLink \"APIFactory\"}}APIFactory{{/crossLink}}</li>\n     *     <li>{{#crossLink \"CMSFactory\"}}CMSFactory{{/crossLink}}</li>\n     *     <li>{{#crossLink \"UIFactory\"}}UIFactory{{/crossLink}}</li>\n     * </ul>\n     * @class CheckoutFactory\n     * @static\n     */\n    pm.factory( 'CheckoutFactory', function( API, CMS, UI )\n    {\n\n        // data received from ReST API\n        var checkoutData;\n\n        // instance wrapped checkout object for global access\n        var checkout;\n\n        return {\n            getCheckout        : getCheckout,\n            setCheckout        : setCheckout,\n            loadCheckout       : loadCheckout,\n            reloadContainer    : reloadContainer,\n            reloadCatContent   : reloadCatContent,\n            reloadItemContainer: reloadItemContainer\n        };\n\n        function Checkout()\n        {\n            return checkoutData;\n        }\n\n        /**\n         * Returns instance of wrapped checkout object\n         * @function getCheckout\n         * @returns {Checkout} Instance of checkout object\n         */\n        function getCheckout( copy )\n        {\n            if ( !checkout || !checkoutData )\n            {\n                loadCheckout( true );\n            }\n\n            if ( !!copy )\n            {\n                return $.extend( true, {}, checkoutData );\n            }\n            return checkout;\n        }\n\n        /**\n         * Receive global checkout data from ReST-API\n         * @function loadCheckout\n         * @return {object} <a href=\"http://api.jquery.com/category/deferred-object/\" target=\"_blank\">jQuery deferred\n         *     Object</a>\n         */\n        function loadCheckout( sync )\n        {\n\n            return API.get( '/rest/checkout/', null, false, false, sync )\n                .done( function( response )\n                {\n                    if ( !!response )\n                    {\n                        checkoutData = response.data;\n                        checkout     = new Checkout();\n                    }\n                    else\n                    {\n                        UI.throwError( 0, 'Could not receive checkout data [GET \"/rest/checkout/\" receives null value]' );\n                    }\n                } );\n        }\n\n        /**\n         * Update checkout data on server\n         * @function setCheckout\n         * @return {object} <a href=\"http://api.jquery.com/category/deferred-object/\" target=\"_blank\">jQuery deferred\n         *     Object</a>\n         */\n        function setCheckout()\n        {\n\n            return API.put( '/rest/checkout', checkout )\n                .done( function( response )\n                {\n                    if ( !!response )\n                    {\n                        checkoutData = response.data;\n                        checkout     = new Checkout();\n                    }\n                    else\n                    {\n                        UI.throwError( 0, 'Could not receive checkout data [GET \"/rest/checkout/\" receives null value]' );\n                    }\n                } );\n\n        }\n\n        /**\n         * Get layout container from server and replace received HTML\n         * in containers marked with <b>data-plenty-checkout-template=\"...\"</b>\n         * @function reloadContainer\n         * @param  {string} container Name of the template to load from server\n         * @return {object} <a href=\"http://api.jquery.com/category/deferred-object/\" target=\"_blank\">jQuery deferred\n         *     Object</a>\n         */\n        function reloadContainer( container )\n        {\n\n            return CMS.getContainer( \"checkout\" + container ).from( 'checkout' )\n                .done( function( response )\n                {\n                    $( '[data-plenty-checkout-template=\"' + container + '\"]' )\n                        .each( function( i, elem )\n                        {\n                            $( elem ).html( response.data[0] );\n                            pm.getInstance().bindDirectives( elem );\n                            $( window ).trigger( 'contentChanged' );\n                        } );\n                } );\n        }\n\n        /**\n         * Get category content from server and replace received HTML\n         * in containers marked with <b>data-plenty-checkout-catcontent=\"...\"</b>\n         * @function reloadCatContent\n         * @param    {number} catId    ID of the category to load content (description 1) from server\n         * @return  {object} <a href=\"http://api.jquery.com/category/deferred-object/\" target=\"_blank\">jQuery deferred\n         *     Object</a>\n         * @deprecated\n         */\n        function reloadCatContent( catId )\n        {\n\n            return CMS.getCategoryContent( catId )\n                .done( function( response )\n                {\n                    $( '[data-plenty-checkout-catcontent=\"' + catId + '\"]' )\n                        .each( function( i, elem )\n                        {\n                            $( elem ).html( response.data[0] );\n                            pm.getInstance().bindDirectives( elem );\n                            $( window ).trigger( 'contentChanged' );\n\n                        } );\n                } );\n\n        }\n\n        /**\n         * Get layout container from server and replace received HTML\n         * in containers marked with <b>data-plenty-itemview-template=\"...\"</b>\n         * @function reloadItemContainer\n         * @param    {string} container    Name of the (item view) template to load from server\n         * @return  {object} <a href=\"http://api.jquery.com/category/deferred-object/\" target=\"_blank\">jQuery deferred\n         *     Object</a>\n         */\n        function reloadItemContainer( container )\n        {\n\n            return CMS.getContainer( 'itemview' + container ).from( 'itemview' )\n                .done( function( response )\n                {\n                    $( '[data-plenty-itemview-template=\"' + container + '\"]' )\n                        .each( function( i, elem )\n                        {\n                            $( elem ).html( response.data[0] );\n                            pm.getInstance().bindDirectives( elem );\n                            $( window ).trigger( 'contentChanged' );\n\n                        } );\n                } );\n\n        }\n\n    }, ['APIFactory', 'CMSFactory', 'UIFactory'] );\n}( PlentyFramework ));\n/**\n * Licensed under AGPL v3\n * (https://github.com/plentymarkets/plenty-cms-library/blob/master/LICENSE)\n * =====================================================================================\n * @copyright   Copyright (c) 2015, plentymarkets GmbH (http://www.plentymarkets.com)\n * @author      Felix Dausch <felix.dausch@plentymarkets.com>\n * =====================================================================================\n */\n\n/**\n * @module Factories\n */\n(function( $, pm )\n{\n\n    /**\n     * Provides methods for creating and displaying modal popups.\n     * @class ModalFactory\n     * @static\n     */\n    pm.factory( 'ModalFactory', function()\n    {\n\n        return {\n            prepare: prepare,\n            isModal: isModal\n        };\n\n        /**\n         * Detect if given html contains a valid modal\n         * @function isModal\n         * @param {string} html\n         * @returns {boolean}\n         */\n        function isModal( html )\n        {\n            return PlentyFramework.partials.Modal.isModal( html );\n        }\n\n        /**\n         * Create a new Instance of {{#crossLink \"ModalFactory.Modal\"}}Modal{{/crossLink}}\n         * @function prepare\n         * @returns {Modal}\n         */\n        function prepare( selector )\n        {\n            return new Modal( selector );\n        }\n\n        /**\n         * Holds configuration of a modal and provides methods for displaying and hiding the modal\n         * @class Modal\n         * @for ModalFactory\n         * @returns {Modal}\n         * @constructor\n         */\n        function Modal( selector )\n        {\n\n            var modal      = this;\n            modal.selector = selector;\n\n            /**\n             * The UID of the modal\n             * @attribute uid\n             * @type {string}\n             * @private\n             * @default \"\"\n             */\n            modal.uid      = '';\n\n            /**\n             * The title of the modal\n             * @attribute title\n             * @type {string}\n             * @private\n             * @default \"\"\n             */\n            modal.title = '';\n\n            modal.cssClass = '';\n\n            /**\n             * The content of the modal\n             * @attribute content\n             * @type {string}\n             * @private\n             * @default \"\"\n             */\n            modal.content = '';\n\n            /**\n             * The content of the dismiss-button\n             * @attribute labelDismiss\n             * @type {string}\n             * @private\n             * @default \"Abbrechen\"\n             */\n            modal.labelDismiss = pm.translate( \"Cancel\" );\n\n            /**\n             * the label of the confirmation button\n             * @attribute labelConfirm\n             * @type {string}\n             * @private\n             * @default \"Besttigen\"\n             */\n            modal.labelConfirm = pm.translate( \"Confirm\" );\n\n            /**\n             * Callback when modal is confirmed by clicking confirmation button.\n             * Modal will not be dismissed if callback returns false.\n             * @attribute onConfirm\n             * @type {function}\n             * @private\n             * @default function() {}\n             */\n            modal.onConfirm = function()\n            {\n            };\n\n            /**\n             * Callback when modal is dismissed by closing the modal\n             * @attribute onDismiss\n             * @type {function}\n             * @private\n             * @default function() {}\n             */\n            modal.onDismiss = function()\n            {\n            };\n\n            /**\n             * jQuery selector of the container element to display the modal in.\n             * @attribute container\n             * @type {string}\n             * @private\n             * @default \"body\"\n             */\n            modal.container = 'body';\n\n            /**\n             * Timeout to close the modal automatically. Set &lt;0 to disable.\n             * @attribute timeout\n             * @type {number}\n             * @private\n             * @default -1\n             */\n            modal.timeout = -1;\n\n            modal.hide            = hide;\n            modal.startTimeout    = startTimeout;\n            modal.stopTimeout     = stopTimeout;\n            modal.pauseTimeout    = pauseTimeout;\n            modal.continueTimeout = continueTimeout;\n\n            var bsModal;\n            var timeout, interval;\n            var timeRemaining, timeStart;\n            var paused = false;\n\n            return {\n                setTitle       : setTitle,\n                setClass       : setClass,\n                setContent     : setContent,\n                setContainer   : setContainer,\n                setLabelConfirm: setLabelConfirm,\n                setLabelDismiss: setLabelDismiss,\n                onConfirm      : onConfirm,\n                onDismiss      : onDismiss,\n                setTimeout     : setTimeout,\n                show           : show,\n                hide           : hide,\n                setStatic      : setStatic\n            };\n\n            /**\n             * Set the {{#crossLink \"ModalFactory.Modal/title:attribute}}title{{/crossLink}} of the modal\n             * @function setTitle\n             * @param   {string}    title The title\n             * @returns {Modal}     Modal object for chaining methods\n             */\n            function setTitle( title )\n            {\n                modal.title = title;\n                return this;\n            }\n\n            function setClass( cssClass )\n            {\n                modal.cssClass = cssClass;\n                return this;\n            }\n\n            /**\n             * Fire this function to make the modal a modal. ;)\n             * Modal only\n             *\n             * @returns {setStatic}\n             */\n            function setStatic( isStatic )\n            {\n                if ( isStatic )\n                {\n                    modal.backdrop = 'static';\n                    modal.keyboard = false;\n                }\n                return this;\n            }\n\n            /**\n             * Set the {{#crossLink \"ModalFactory.Modal/content:attribute}}content{{/crossLink}} of the modal\n             * @function setContent\n             * @param   {string}    content The content\n             * @returns {Modal}     Modal object for chaining methods\n             */\n            function setContent( content )\n            {\n                modal.content = content;\n                return this;\n            }\n\n            /**\n             * Set the {{#crossLink \"ModalFactory.Modal/labelConfirm:attribute}}label of the confirmation\n             * button{{/crossLink}} of the modal\n             * @function setLabelConfirm\n             * @param   {string}    label The label\n             * @returns {Modal}     Modal object for chaining methods\n             */\n            function setLabelConfirm( label )\n            {\n                modal.labelConfirm = label;\n                return this;\n            }\n\n            /**\n             * Set the {{#crossLink \"ModalFactory.Modal/labelDismiss:attribute}}label if the dismiss\n             * button{{/crossLink}} of the modal\n             * @function setLabelDismiss\n             * @param   {string}    label The label\n             * @returns {Modal}     Modal object for chaining methods\n             */\n            function setLabelDismiss( label )\n            {\n                modal.labelDismiss = label;\n                return this;\n            }\n\n            /**\n             * Set the {{#crossLink \"ModalFactory.Modal/onConfirm:attribute}}confirmation callback{{/crossLink}} of the\n             * modal\n             * @function onConfirm\n             * @param   {function}  callback The callback if modal is confirmed\n             * @returns {Modal}     Modal object for chaining methods\n             */\n            function onConfirm( callback )\n            {\n                modal.onConfirm = callback;\n                return this;\n            }\n\n            /**\n             * Set the {{#crossLink \"ModalFactory.Modal/onDismiss:attribute}}dismiss callback{{/crossLink}} of the modal\n             * @function onDismiss\n             * @param   {function}  callback The callback if modal is dismissed\n             * @returns {Modal}     Modal object for chaining methods\n             */\n            function onDismiss( callback )\n            {\n                modal.onDismiss = callback;\n                return this;\n            }\n\n            /**\n             * Set the {{#crossLink \"ModalFactory.Modal/container:attribute}}container{{/crossLink}} of the modal\n             * @function setContainer\n             * @param   {string}    container The jQuery selector of the container to display the modal in\n             * @returns {Modal}     Modal object for chaining methods\n             */\n            function setContainer( container )\n            {\n                modal.container = container;\n                return this;\n            }\n\n            /**\n             * Set the {{#crossLink \"ModalFactory.Modal/timeout:attribute}}timeout{{/crossLink}} of the modal\n             * @function setTimeout\n             * @param   {number}    timeout The timeout to close the modal automatically. Set &lt;0 to disable\n             * @returns {Modal}     Modal object for chaining methods\n             */\n            function setTimeout( timeout )\n            {\n                modal.timeout = timeout;\n                return this;\n            }\n\n            /**\n             * Inject modal data in default template if not template is given\n             * and display the modal inside the configured container.<br>\n             * Start timer to hide the modal automatically if timeout is set.\n             * @function show\n             */\n            function show()\n            {\n                if ( !!modal.selector )\n                {\n                    bsModal = $( modal.selector );\n                }\n                else\n                {\n                    if ( isModal( modal.content ) )\n                    {\n                        bsModal = PlentyFramework.partials.Modal.getModal( modal.content );\n                    }\n                    else\n                    {\n                        modal.uid = '_' + Math.random().toString(36).substr(2, 9);\n                        bsModal = $( PlentyFramework.compileTemplate( 'modal/modal.html', modal ) );\n                        if ( bsModal.modal )\n                        {\n                            bsModal.modal( modal );\n                        }\n                    }\n\n                    $( modal.container ).append( bsModal );\n\n                    // append additional scripts executable\n                    var scripts = $( modal.content ).filter( 'script' );\n                    if ( scripts.length > 0 )\n                    {\n                        scripts.each( function( i, script )\n                        {\n                            var element       = document.createElement( 'script' );\n                            element.type      = 'text/javascript';\n                            element.innerHTML = $( script ).text();\n                            $( modal.container ).append( element );\n                        } );\n                    }\n                }\n\n                // bind callback functions\n                PlentyFramework.partials.Modal.init( bsModal, modal );\n                bsModal.find( '[data-plenty-modal=\"confirm\"]' ).click( function()\n                {\n                    var close = modal.onConfirm();\n\n                    if ( typeof close == \"undefined\" )\n                    {\n                        close = true;\n                    }\n\n                    if ( close )\n                    {\n                        hide( true );\n                    }\n                } );\n\n                $(document).on('close.fndtn.reveal', bsModal, function () {\n                    modal.onDismiss();\n                });\n\n                PlentyFramework.partials.Modal.show( bsModal );\n\n                if ( modal.timeout > 0 )\n                {\n                    startTimeout();\n                }\n\n            }\n\n            /**\n             * Hide the modal.\n             * @function hide\n             * @param {boolean} confirmed Flag indicating of modal is closed by confirmation button or dismissed\n             */\n            function hide( confirmed )\n            {\n                PlentyFramework.partials.Modal.hide( bsModal );\n\n                if ( !confirmed )\n                {\n                    modal.onDismiss();\n                }\n            }\n\n            /**\n             * Start the configured timeout initially\n             * @function startTimeout\n             * @private\n             */\n            function startTimeout()\n            {\n                timeRemaining = modal.timeout;\n                timeStart     = (new Date()).getTime();\n\n                timeout = window.setTimeout( function()\n                {\n                    window.clearInterval( interval );\n                    hide();\n                }, modal.timeout );\n\n                bsModal.find( '[data-plenty-modal=\"timer\"]' ).text( timeRemaining / 1000 );\n                interval = window.setInterval( function()\n                {\n                    if ( !paused )\n                    {\n                        var secondsRemaining = timeRemaining - (new Date()).getTime() + timeStart;\n                        secondsRemaining     = Math.round( secondsRemaining / 1000 );\n                        bsModal.find( '[data-plenty-modal=\"timer\"]' ).text( secondsRemaining );\n                    }\n                }, 1000 )\n            }\n\n            /**\n             * Pause the timeout (e.g. on hover)\n             * @function pauseTimeout\n             * @private\n             */\n            function pauseTimeout()\n            {\n                paused = true;\n                timeRemaining -= (new Date()).getTime() - timeStart;\n                window.clearTimeout( timeout );\n            }\n\n            /**\n             * Continue paused timeout\n             * @function continueTimeout\n             * @private\n             */\n            function continueTimeout()\n            {\n                paused    = false;\n                timeStart = (new Date()).getTime();\n                timeout   = window.setTimeout( function()\n                {\n                    hide();\n                    window.clearInterval( interval );\n                }, timeRemaining );\n            }\n\n            /**\n             * Stop timeout. Stopped timeouts cannot be continued.\n             * @function stopTimeout\n             * @private\n             */\n            function stopTimeout()\n            {\n                window.clearTimeout( timeout );\n                window.clearInterval( interval );\n            }\n\n        }\n    } );\n}( jQuery, PlentyFramework ));\n\n/**\n * Licensed under AGPL v3\n * (https://github.com/plentymarkets/plenty-cms-library/blob/master/LICENSE)\n * =====================================================================================\n * @copyright   Copyright (c) 2015, plentymarkets GmbH (http://www.plentymarkets.com)\n * @author      Felix Dausch <felix.dausch@plentymarkets.com>\n * =====================================================================================\n */\n\n/**\n * @module Factories\n */\n(function( $, pm )\n{\n\n    /**\n     * Displaying error messages and handling wait screen\n     * @class UIFactory\n     * @static\n     */\n    pm.factory( 'UIFactory', function()\n    {\n        /**\n         * Increased/ decreased when showing/ hiding wait screen to avoid stacking\n         * multiple instances of overlays.\n         * @attribute waitScreenCount\n         * @private\n         * @type {number}\n         * @default 0\n         */\n        var waitScreenCount = 0;\n        var waitScreen;\n        var errorPopup      = null;\n\n        return {\n            throwError    : throwError,\n            printErrors   : printErrors,\n            showWaitScreen: showWaitScreen,\n            hideWaitScreen: hideWaitScreen\n        };\n\n        /**\n         * Display a single error message.\n         * @function throwError\n         * @param {number} code A code identifying this error\n         * @param {string} msg  The error message to display\n         */\n        function throwError( code, msg )\n        {\n            printErrors( [{code: code, message: msg}] );\n        }\n\n        /**\n         * Wrap error messages in error popup, if popup doesn't already contain this error\n         * If popup is already visible, append new errors to popup's inner HTML\n         * otherwise create new popup\n         * @function printErrors\n         * @param {Array} errorMessages A list of errors to display\n         */\n        function printErrors(errorMessages) {\n            var errorContainer = $('body');\n            if ($('body').has('.alert-box-container').length) {\n              errorContainer = $('.alert-box-container').first();\n            }\n            // create error-popup if not exist\n            if( !errorPopup || errorContainer.has(errorPopup ).length <= 0 ) {\n                errorPopup = $( pm.compileTemplate('error/errorPopup.html') );\n                errorContainer.append( errorPopup );\n                pm.partials.Error.init( errorPopup );\n            }\n\n            $.each( errorMessages, function( key, error )\n            {\n                // add additional error, if not exist.\n                pm.partials.Error.addError( errorPopup, $( pm.compileTemplate( 'error/errorMessage.html', error ) ) );\n            } );\n\n            pm.partials.Error.show( errorPopup );\n\n            hideWaitScreen( true );\n        }\n\n        /**\n         * Show wait screen if not visible and increase\n         * {{#crossLink \"UIFactory/waitScreenCount:attribute\"}}waitScreenCount{{/crossLink}}\n         * @function showWaitScreen\n         */\n        function showWaitScreen()\n        {\n            waitScreenCount = waitScreenCount || 0;\n\n            // create wait-overlay if not exist\n            if ( !waitScreen || $( 'body' ).has( waitScreen ).length <= 0 )\n            {\n                waitScreen = $( pm.compileTemplate( 'waitscreen/waitscreen.html' ) );\n                $( 'body' ).append( waitScreen );\n            }\n\n            pm.partials.WaitScreen.show( waitScreen );\n\n            // increase instance counter to avoid showing multiple overlays\n            waitScreenCount++;\n            return waitScreenCount;\n        }\n\n        /**\n         * Decrease {{#crossLink \"UIFactory/waitScreenCount:attribute\"}}waitScreenCount{{/crossLink}}\n         * and hide wait screen if waitScreenCount is 0\n         * @function hideWaitScreen\n         * @param {boolean} forceClose set true to hide wait screen independent from the value of waitScreenCount.\n         */\n        function hideWaitScreen( forceClose )\n        {\n\n            // decrease overlay count\n            waitScreenCount--;\n\n            // hide if all instances of overlays has been closed\n            // or if closing is forced by user\n            if ( waitScreenCount <= 0 || !!forceClose )\n            {\n                waitScreenCount = 0;\n                pm.partials.WaitScreen.hide( waitScreen );\n            }\n            return waitScreenCount;\n        }\n\n    } );\n}( jQuery, PlentyFramework ));\n\n/**\n * Factories provide static functions and can be injected into\n * {{#crossLinkModule \"Services\"}}services{{/crossLinkModule}}.<br>\n * Factories also can inject other factories. Compared to services,\n * factories are not visible in instances of {{#crossLinkModule \"PlentyFramework\"}}PlentyFramework{{/crossLinkModule}}.\n *\n * @module Factories\n * @main Factories\n */\nObject.equals = function( a, b )\n{\n    if ( a === b )\n    {\n        return true;\n    }\n    if ( !(a instanceof Object) || !(b instanceof Object) )\n    {\n        return false;\n    }\n    if ( a.constructor !== b.constructor )\n    {\n        return false;\n    }\n\n    for ( var key in a )\n    {\n        if ( !a.hasOwnProperty( key ) )\n        {\n            continue;\n        }\n        if ( !b.hasOwnProperty( key ) )\n        {\n            return false;\n        }\n        if ( a[key] === b[key] )\n        {\n            continue;\n        }\n        if ( typeof( a[key] ) !== \"object\" )\n        {\n            return false;\n        }\n        if ( !Object.equals( a[key], b[key] ) )\n        {\n            return false;\n        }\n    }\n\n    for ( var key in b )\n    {\n        if ( b.hasOwnProperty( key ) && !a.hasOwnProperty( key ) )\n        {\n            return false;\n        }\n    }\n\n    return true;\n\n};\nPlentyFramework.cssClasses = {\n\n    active: \"active\"\n\n};\n(function( $, pm )\n{\n\n    pm.partials.Error = {\n\n        /**\n         * Will be called, after the error popup was created and injected in DOM.\n         * @param {HTMLElement} popup   The injected element of the popup\n         */\n        init: function( popup )\n        {\n            $( popup ).find( '.close' ).click( function()\n            {\n                pm.partials.Error.hideAll();\n            } );\n        },\n\n        /**\n         * Will be called for each thrown error. Has to be injected in DOM manually.\n         * @param {HTMLElement} popup   The error popup element\n         * @param {HTMLElement} error   The error message element\n         */\n        addError: function( popup, error )\n        {\n            var errorCode = $( error ).attr( 'data-plenty-error-code' );\n\n            if ( $( popup ).find( '[data-plenty-error-code=\"' + errorCode + '\"]' ).length <= 0 )\n            {\n                $( popup ).find( '.plentyErrorBoxInner' ).append( error );\n            }\n        },\n\n        /**\n         * Will be called, after initialization and injection of all errors\n         * @param {HTMLElement} popup The error popup element\n         */\n        show: function( popup )\n        {\n            $( popup ).show();\n        },\n\n        hideAll: function() {\n            $( '#CheckoutErrorPane' ).hide();\n            $( '#CheckoutErrorPane' ).find( '.plentyErrorBoxInner' ).html( '' );\n        }\n\n    }\n\n})( jQuery, PlentyFramework );\n(function( $, pm )\n{\n\n    pm.partials.Modal = {\n\n        /**\n         * Will be called after a new modal was created and injected into DOM\n         * @param {HTMLElement} element The injected modal element\n         * @param {Modal} modal         The instance of the current modal\n         */\n        init: function ( element, modal )\n        {\n            element.on('closed.fndtn.reveal', '[data-reveal]', function ()\n            {\n                modal.hide();\n                if( !modal.selector )\n                {\n                    //Do not remove static modals\n                    // element.remove();\n                }\n            } );\n\n            if( modal.timeout > 0 )\n            {\n                // modal.startTimeout();\n                element.on('close.fndtn.reveal', '[data-reveal]', modal.stopTimeout);\n                element.hover( function()\n                {\n                    modal.pauseTimeout();\n                }, function ()\n                {\n                    if( element.is('.open') )\n                    {\n                        modal.continueTimeout();\n                    }\n                } );\n            }\n        },\n\n        /**\n         * Will be called if a Modal requests to show.\n         * @param {HTMLElement} element The injected modal element\n         */\n        show: function ( element )\n        {\n            element.foundation('reveal','open');\n        },\n\n        /**\n         * Will be called if a Modal requests to hide.\n         * @param {HTMLElement} element The injected modal element\n         */\n        hide: function ( element )\n        {\n            element.foundation('reveal', 'close');\n        },\n\n        /**\n         * Detect if a given HTML string contains a modal\n         * @param {HTMLElement} html the element to search a modal in.\n         * @returns {boolean}   true if a modal was found\n         */\n        isModal: function ( html )\n        {\n            return $(html).filter('.reveal-modal' ).length + $(html).find('.reveal-modal' ).length > 0;\n        },\n\n        /**\n         * Filter a modal from a given HTML string\n         * @param {HTMLElement}     html the element to get a modal from.\n         * @returns {HTMLElement}   the filtered modal element\n         */\n        getModal: function( html )\n        {\n            var modal = $( html );\n            if ( modal.length > 1 )\n            {\n                modal = $( html ).filter( '.reveal-modal' ) || $( html ).find( '.reveal-modal' );\n            }\n\n            return modal;\n        }\n\n    };\n\n}( jQuery, PlentyFramework ));\n\n(function( $ )\n{\n\n    $( document ).on( 'initPartials', function( e, root )\n    {\n\n        //$( root ).find( '[data-toggle=\"tooltip\"]' ).tooltip( {\n        //    container: 'body'\n        //} );\n\n    } );\n\n})( jQuery );\n\n(function( $, pm )\n{\n\n    pm.partials.WaitScreen = {\n\n        /**\n         * Will be called if the wait screen should be shown\n         * @param {HTMLElement} element The wait screen element\n         */\n        show: function( element )\n        {\n            element.addClass( 'in' );\n        },\n\n        /**\n         * Will be called if the wait screen should be hidden\n         * @param {HTMLElement} element The wait screen element\n         */\n        hide: function( element )\n        {\n            element.removeClass( 'in' );\n        }\n\n    };\n\n})( jQuery, PlentyFramework );\n/**\n * Licensed under AGPL v3\n * (https://github.com/plentymarkets/plenty-cms-library/blob/master/LICENSE)\n * =====================================================================================\n * @copyright   Copyright (c) 2015, plentymarkets GmbH (http://www.plentymarkets.com)\n * @author      Felix Dausch <felix.dausch@plentymarkets.com>\n * =====================================================================================\n */\n\n(function( $, pm )\n{\n    pm.service( 'AddressDoctorService', function( API )\n    {\n        return {\n            validateAddress: validateAddress\n        };\n\n        function validateAddress( addressForms )\n        {\n            var addressIsValid = true;\n            addressForms       = addressForms || '[data-plenty-address-doctor]';\n            $( addressForms ).filter( '[data-plenty-address-doctor]:visible' ).each( function( i, form )\n            {\n                var addressDoctor  = new AddressDoctor( form );\n                var requiredFields = $( form ).attr( 'data-plenty-address-doctor' ).replace( /\\s/g, '' ).split( ',' );\n                if ( !addressDoctor.isValid( requiredFields ) )\n                {\n                    addressIsValid = false;\n                }\n\n            } );\n\n            return addressIsValid;\n        }\n\n        function AddressDoctor( form )\n        {\n            var $form                = $( form );\n            var $inputs              = {\n                Street : $form.find( 'input[name=\"Street\"]' ),\n                ZIP    : $form.find( 'input[name=\"ZIP\"]' ),\n                City   : $form.find( 'input[name=\"City\"]' ),\n                HouseNo: $form.find( 'input[name=\"HouseNo\"]' )\n            };\n            var $suggestionContainer = {};\n\n            var suggestions;\n            var requiredFields;\n\n            return {\n                isValid: isValid\n            };\n\n            function isValid( fields )\n            {\n\n                if ( isPackstation() )\n                {\n                    return true;\n                }\n\n                suggestions    = new AddressList( $form.getFormValues() );\n                requiredFields = fields;\n\n                refreshView();\n\n                return suggestions.getAddresses().length == 1;\n            }\n\n            function refreshView()\n            {\n                $( '.suggestion-list' ).remove();\n\n                var suggestionListVisible = false;\n                for ( var i = 0; i < requiredFields.length; i++ )\n                {\n                    if ( !validateInput( requiredFields[i], suggestionListVisible ) )\n                    {\n                        $form.trigger( 'validationFailed' );\n                        suggestionListVisible = true;\n                    }\n                }\n\n                if ( suggestions.houseNoAllowed( $inputs.HouseNo.val() ) || suggestions.getAddresses().length == 1 )\n                {\n                    $inputs.HouseNo.removeClass( 'error' );\n                    $form.find( 'label[for=\"' + $inputs.HouseNo.attr( 'id' ) + '\"]' ).removeClass( 'error' );\n\n                    $inputs.HouseNo.addClass( 'success' );\n                    $form.find( 'label[for=\"' + $inputs.HouseNo.attr( 'id' ) + '\"]' ).addClass( 'success' );\n                }\n                else\n                {\n                    $inputs.HouseNo.removeClass( 'success' );\n                    $form.find( 'label[for=\"' + $inputs.HouseNo.attr( 'id' ) + '\"]' ).removeClass( 'success' );\n\n                    $inputs.HouseNo.addClass( 'error' );\n                    $form.find( 'label[for=\"' + $inputs.HouseNo.attr( 'id' ) + '\"]' ).addClass( 'error' );\n                }\n            }\n\n            function validateInput( key, suggestionListVisible )\n            {\n                var valueList = suggestions.getList( key );\n\n                if ( !!$suggestionContainer[key] )\n                {\n                    $suggestionContainer[key].remove();\n                }\n\n                if ( !$inputs[key] )\n                {\n                    return true;\n                }\n\n                if ( valueList.length == 1 )\n                {\n                    $inputs[key].val( valueList[0] );\n\n                    $inputs[key].removeClass( 'error' );\n                    $form.find( 'label[for=\"' + $inputs[key].attr( 'id' ) + '\"]' ).removeClass( 'error' );\n\n                    $inputs[key].addClass( 'success' );\n                    $form.find( 'label[for=\"' + $inputs[key].attr( 'id' ) + '\"]' ).addClass( 'success' );\n                    return true;\n                }\n                else\n                {\n                    $inputs[key].removeClass( 'success' );\n                    $form.find( 'label[for=\"' + $inputs[key].attr( 'id' ) + '\"]' ).removeClass( 'success' );\n\n                    $inputs[key].addClass( 'error' );\n                    $form.find( 'label[for=\"' + $inputs[key].attr( 'id' ) + '\"]' ).addClass( 'error' );\n\n                    if ( !suggestionListVisible )\n                    {\n                        buildSuggestionList( $inputs[key], valueList );\n                    }\n                    $inputs[key].off( 'focus' );\n                    $inputs[key].focus();\n                    return false;\n\n                }\n            }\n\n            function positionSuggestionList( $parent, suggestionKey )\n            {\n                $suggestionContainer[suggestionKey].css( {\n                    'width': $parent.outerWidth( true ),\n                    'left' : $parent.position().left,\n                    'top'  : $parent.position().top + $parent.outerHeight( true )\n                } );\n            }\n\n            function buildSuggestionList( $parent, values )\n            {\n                var suggestionKey = $parent.attr( 'name' );\n\n                // render html content\n                $suggestionContainer[suggestionKey] = $( pm.compileTemplate( 'addressSuggestions/addressDoctor.html', {values: values} ) );\n\n                positionSuggestionList( $parent, suggestionKey );\n\n                $( window ).on( 'sizeChange', function()\n                {\n                    positionSuggestionList( $parent, suggestionKey );\n                } );\n\n                // bind click event to list elements\n                $suggestionContainer[suggestionKey].find( '[data-address-value]' ).each( function( i, elem )\n                {\n\n                    var $elem = $( elem );\n                    var value = $elem.attr( 'data-address-value' );\n\n                    $elem.click( function()\n                    {\n                        // insert clicked value in input\n                        $parent.val( value );\n\n                        // filter addresses and show remaining suggestions\n                        var filterAddress                     = {};\n                        filterAddress[$parent.attr( 'name' )] = value;\n                        suggestions.filter( filterAddress );\n\n                        // refresh suggestion lists\n                        refreshView();\n\n                    } );\n\n                } );\n\n                // inject html\n                $parent.parent().append( $suggestionContainer[suggestionKey] );\n            }\n\n            function isPackstation()\n            {\n                return ( $inputs.Street.val().toUpperCase() == \"PACKSTATION\" || $inputs.Street.val().toUpperCase() == \"POSTFILIALE\" );\n            }\n\n        }\n\n        function AddressList( addressInput )\n        {\n            var addresses = [];\n\n            init();\n\n            return {\n                getAddresses  : getAddresses,\n                getList       : getList,\n                filter        : filter,\n                houseNoAllowed: houseNoAllowed\n            };\n\n            function init()\n            {\n                API.get( '/rest/checkout/addresssuggestionresultslist/', {\n                    suggestionType: \"addressdoctor\",\n                    street        : addressInput.Street,\n                    ZIP           : addressInput.ZIP,\n                    city          : addressInput.City,\n                    houseNo       : addressInput.HouseNo,\n                    country       : addressInput.CountryID\n                }, false, false, true ).done( function( response )\n                {\n\n                    var responseLength = response.data.length;\n\n                    for ( var i = 0; i < responseLength; i++ )\n                    {\n                        var currentResponse = response.data[i];\n\n                        var address = getAddress( currentResponse )\n                        if ( !address )\n                        {\n                            currentResponse.HouseNo = [currentResponse.HouseNo];\n                            addresses.push( currentResponse );\n                        }\n                        else\n                        {\n                            address.HouseNo.push( currentResponse.HouseNo );\n                        }\n\n                    }\n\n                } );\n            }\n\n            function getAddress( suggestion )\n            {\n                var addressCount = addresses.length;\n\n                for ( var j = 0; j < addressCount; j++ )\n                {\n                    if ( suggestion.Street == addresses[j].Street && addresses.ZIP == addresses[j].ZIP && suggestion.City == addresses[j].City )\n                    {\n                        return addresses[j];\n                    }\n                }\n\n                return null;\n\n            }\n\n            function getAddresses()\n            {\n                return addresses;\n            }\n\n            function getList( key )\n            {\n                var results      = [];\n                var addressCount = addresses.length;\n\n                for ( var i = 0; i < addressCount; i++ )\n                {\n                    var address = addresses[i];\n                    if ( $.inArray( address[key], results ) < 0 )\n                    {\n                        results.push( address[key] );\n                    }\n                }\n\n                return results;\n            }\n\n            function filter( filterAddress )\n            {\n                var filteredAddresses = [];\n                var addressCount      = addresses.length;\n\n                for ( var i = 0; i < addressCount; i++ )\n                {\n                    var address = addresses[i];\n                    if ( (!!filterAddress.Street && filterAddress.Street == address.Street)\n                        || (!!filterAddress.ZIP && filterAddress.ZIP == address.ZIP)\n                        || (!!filterAddress.City && filterAddress.City == address.City) )\n                    {\n                        filteredAddresses.push( address );\n                    }\n                }\n\n                addresses = filteredAddresses;\n            }\n\n            function houseNoAllowed( houseNo )\n            {\n                houseNo = parseInt( houseNo );\n\n                var addressCount = addresses.length;\n\n                for ( var i = 0; i < addressCount; i++ )\n                {\n                    var address = addresses[i];\n\n                    for ( var j = 0; j < address.HouseNo.length; j++ )\n                    {\n                        var range = address.HouseNo[j].split( '-' );\n                        if ( ( range.length == 1 && houseNo == range[0] )\n                            || range.length == 2 && houseNo >= range[0] && houseNo <= range[1] )\n                        {\n                            return true;\n                        }\n                    }\n                }\n\n                return false;\n            }\n        }\n\n    }, ['APIFactory'] );\n}( jQuery, PlentyFramework ));\n\n/**\n * Licensed under AGPL v3\n * (https://github.com/plentymarkets/plenty-cms-library/blob/master/LICENSE)\n * =====================================================================================\n * @copyright   Copyright (c) 2015, plentymarkets GmbH (http://www.plentymarkets.com)\n * @author      Felix Dausch <felix.dausch@plentymarkets.com>\n * =====================================================================================\n */\n\n/**\n * @module Services\n */\n(function( $, pm )\n{\n\n    /**\n     * Providing methods for logging in and out and registering new customers.<br>\n     * <b>Requires:</b>\n     * <ul>\n     *     <li>{{#crossLink \"APIFactory\"}}APIFactory{{/crossLink}}</li>\n     *     <li>{{#crossLink \"CheckoutFactory\"}}CheckoutFactory{{/crossLink}}</li>\n     * </ul>\n     * @class AuthenticationService\n     * @static\n     */\n    pm.service( 'AuthenticationService', function( API, Checkout, UI )\n    {\n\n        return {\n            resetPassword    : resetPassword,\n            customerLogin    : customerLogin,\n            setInvoiceAddress: setInvoiceAddress,\n            registerCustomer : registerCustomer\n        };\n\n        /**\n         * Reading E-Mail from form marked with <b>data-plenty-checkout=\"lostPasswordForm\"</b>\n         * and sends request to provide a new password to the entered E-Mail-Address.\n         *\n         * @function resetPasswort\n         * @return {object} <a href=\"http://api.jquery.com/category/deferred-object/\" target=\"_blank\">jQuery deferred\n         *     Object</a>\n         */\n        function resetPassword()\n        {\n\n            var form = $( '[data-plenty-checkout=\"lostPasswordForm\"]' );\n\n            if ( form.validateForm() )\n            {\n\n                var values = form.getFormValues();\n\n                var params = {\n                    Email: values.Email\n                };\n\n                return API.post( \"/rest/checkout/lostpassword/\", params )\n                    .done( function( response )\n                    {\n                        if ( response.data.IsMailSend == true )\n                        {\n                            $( '[data-plenty-checkout=\"lostPasswordTextContainer\"]' ).hide();\n                            $( '[data-plenty-checkout=\"lostPasswordSuccessMessage\"]' ).show();\n                        }\n                    } );\n\n            }\n        }\n\n        /**\n         * Try to login in with credentials read from given &ltform> - element.\n         * On success redirect to forms 'action' attribute.\n         *\n         * @function customerLogin\n         * @param {object} form The jQuery-wrapped form-element to read the credentials from\n         * @return {object} <a href=\"http://api.jquery.com/category/deferred-object/\" target=\"_blank\">jQuery deferred\n         *     Object</a>\n         */\n        function customerLogin( form )\n        {\n            if ( form.validateForm() )\n            {\n                var values = form.getFormValues();\n\n                var params = {\n                    Email   : values.loginMail,\n                    Password: values.loginPassword\n                };\n\n                UI.showWaitScreen();\n                return API.post( \"/rest/checkout/login/\", params )\n                    .done( function()\n                    {\n                        // successful login -> go to form's target referenced by action-attribute\n                        window.location.assign( form.attr( 'action' ) );\n\n                    } );\n            }\n        }\n\n        /**\n         * Setting the invoice address of a newly registered customer or a guest.\n         *\n         * @function setInvoiceAddress\n         * @param {object} invoiceAddress containing address-data sent to server\n         * @return {object} <a href=\"http://api.jquery.com/category/deferred-object/\" target=\"_blank\">jQuery deferred\n         *     Object</a>\n         */\n        function setInvoiceAddress( invoiceAddress )\n        {\n\n            return API.post( \"/rest/checkout/customerinvoiceaddress/\", invoiceAddress )\n                .done( function( response )\n                {\n                    Checkout.getCheckout().CustomerInvoiceAddress = response.data;\n                } );\n        }\n\n        /**\n         * Prepare address-data to register new customer. Read the address-data from a &lt;form> marked with\n         * <b>data-plenty-checkout-form=\"customerRegistration\"</b><br>\n         * On success, redirect to forms target referenced by action-attribute\n         *\n         * @function registerCustomer\n         * @return {object} <a href=\"http://api.jquery.com/category/deferred-object/\" target=\"_blank\">jQuery deferred\n         *     Object</a>\n         */\n        function registerCustomer()\n        {\n            var form = $( '[data-plenty-checkout-form=\"customerRegistration\"]' );\n\n            if ( form.validateForm() && pm.getInstance().AddressDoctorService.validateAddress() )\n            {\n                var values       = form.getFormValues();\n                var customProp   = $( form ).find( \"[id^='plentyCustomerProperty']\" );\n                values.LoginType = 2;\n\n                if ( values.checkout\n                    && values.checkout.customerInvoiceAddress\n                    && values.checkout.customerInvoiceAddress.CustomerProperty )\n                {\n                    var tmpProperties             = values.checkout.customerInvoiceAddress.CustomerProperty;\n                    values.CustomerPropertiesList = values.CustomerPropertiesList || [];\n\n                    for ( var property in tmpProperties )\n                    {\n                        if ( tmpProperties[property] )\n                        {\n                            values.CustomerPropertiesList.push( {\n                                PropertyID   : property,\n                                PropertyValue: tmpProperties[property]\n                            } );\n                        }\n                    }\n                }\n                else if ( customProp.length > 0 )\n                {\n                    values.CustomerPropertiesList = [];\n                    for ( var i = customProp.length - 1; i >= 0; i-- )\n                    {\n                        var $tmpEl = $( customProp[i] );\n                        values.CustomerPropertiesList.push(\n                            {\n                                PropertyID   : $tmpEl.attr( \"data-plenty-property-id\" ),\n                                PropertyValue: $tmpEl.val()\n                            } );\n                    }\n                }\n\n                return setInvoiceAddress( values )\n                    .done( function()\n                    {\n                        window.location.assign( form.attr( 'action' ) );\n                    } );\n            }\n        }\n    }, ['APIFactory', 'CheckoutFactory', 'UIFactory'] );\n\n}( jQuery, PlentyFramework ));\n/**\n * Licensed under AGPL v3\n * (https://github.com/plentymarkets/plenty-cms-library/blob/master/LICENSE)\n * =====================================================================================\n * @copyright   Copyright (c) 2015, plentymarkets GmbH (http://www.plentymarkets.com)\n * @author      Felix Dausch <felix.dausch@plentymarkets.com>\n * =====================================================================================\n */\n\n/**\n * @module Services\n */\n(function( $, pm )\n{\n\n    /**\n     * Providing methods for adding, editing or removing basket items and coupon codes<br>\n     * <b>Requires:</b>\n     * <ul>\n     *     <li>{{#crossLink \"APIFactory\"}}APIFactory{{/crossLink}}</li>\n     *     <li>{{#crossLink \"UIFactory\"}}UIFactory{{/crossLink}}</li>\n     *     <li>{{#crossLink \"CMSFactory\"}}CMSFactory{{/crossLink}}</li>\n     *     <li>{{#crossLink \"CheckoutFactory\"}}CheckoutFactory{{/crossLink}}</li>\n     *     <li>{{#crossLink \"ModalFactory\"}}ModalFactory{{/crossLink}}</li>\n     * </ul>\n     * @class BasketService\n     * @static\n     */\n    pm.service( 'BasketService', function( API, UI, CMS, Checkout, Modal )\n    {\n\n        return {\n            addItem           : addBasketItem,\n            removeItem        : removeBasketItem,\n            getItem           : getBasketItem,\n            setItemQuantity   : setItemQuantity,\n            editItemAttributes: editItemAttributes,\n            editOrderParams   : editOrderParams,\n            addCoupon         : addCoupon,\n            removeCoupon      : removeCoupon,\n            setScheduler      : setScheduler\n        };\n\n        /**\n         * Add item to basket. Will fail and show a popup if item has order params\n         * @function addBasketItem\n         * @param   {Array}     article         Array containing the item to add\n         * @param   {boolean}   [isUpdate=false]      Indicating if item's OrderParams are updated\n         * @return {object} <a href=\"http://api.jquery.com/category/deferred-object/\" target=\"_blank\">jQuery deferred\n         *     Object</a>\n         */\n        function addBasketItem( article )\n        {\n\n            if ( !!article )\n            {\n                // checking for order params!\n                if ( $( \"#BasketItemOrderParamsContainer_0\" ).find( \"[name^='ItemOrderParams']\" ).length > 0 )\n                {\n                    // save order params\n                    addArticle( saveOrderParams( article ) );\n                }\n                else\n                {\n                    API.get( '/rest/checkout/container_' + 'CheckoutOrderParamsList'.toLowerCase() + '/',\n                        {\n                            itemID  : article[0].BasketItemItemID,\n                            quantity: article[0].BasketItemQuantity\n                        }, false, true ).done( function( resp )\n                    {\n                        // checking for order params!\n                        if ( resp.data[0].indexOf( \"form-group\" ) > 0 )\n                        {\n                            Modal.prepare()\n                                .setContent( resp.data[0] )\n                                .setTitle( pm.translate( \"Select order parameters\" ) )\n                                .setLabelConfirm( pm.translate( \"Save\" ) )\n                                .onConfirm( function()\n                                {\n                                    // validate form\n                                    if ( $( '[data-plenty-checkout-form=\"OrderParamsForm\"]' ).validateForm() )\n                                    {\n                                        // save order params\n                                        addArticle( saveOrderParams( article ) );\n\n                                        // close modal after saving order params\n                                        return true;\n                                    }\n                                    else\n                                    {\n                                        return false;\n                                    }\n                                } )\n                                .show();\n                        }\n                        else\n                        {\n                            addArticle( article );\n                        }\n                    } );\n                }\n            }\n        }\n\n        /**\n         * Read OrderParams from &lt;form> marked with <b>data-plenty-checkout-form=\"OrderParamsForm\"</b> and inject\n         * read values in 'addBasketList'. Update item by calling <code>addBasketItem()</code> again\n         * @function saveOrderParams\n         * @private\n         * @param {Array} articleWithParams Containing the current item to add. Read OrderParams will be injected\n         */\n        function saveOrderParams( articleWithParams )\n        {\n            //TODO use $(\"[data-plenty-checkout-form='OrderParamsForm']\").serializeArray() to get order params\n            var orderParamsForm = $( '[data-plenty-checkout-form=\"OrderParamsForm\"]' );\n            var $self           = {};\n            var attrType        = \"\";\n            var match;\n\n            //Groups\n            orderParamsForm.find( '[name^=\"ParamGroup\"]' ).each( function()\n            {\n                match             = this.name.match( /^ParamGroup\\[(\\d+)]\\[(\\d+)]$/ );\n                articleWithParams = addOrderParamValue( articleWithParams, match[1], $( this ).val(), $( this ).val() );\n            } );\n\n            //Values\n            orderParamsForm.find( '[name^=\"ParamValue\"]' ).each( function()\n            {\n                getValues( \"ParamValue\", this );\n            } );\n\n            //Values\n            $( '[id^=\"BasketItemOrderParamsContainer\"]' ).find( '[name^=\"ItemOrderParams\"]' ).each( function()\n            {\n                getValues( \"ItemOrderParams\", this );\n            } );\n\n            function getValues( type, el )\n            {\n                $self    = $( el );\n                attrType = $self.attr( 'type' );\n\n                if ( ((attrType == 'checkbox' && $self.is( ':checked' )) ||\n                    (attrType == 'radio' && $self.is( ':checked' )) ||\n                    (attrType != 'radio' && attrType != 'checkbox')) && attrType != 'file' && attrType != 'hidden' )\n                {\n\n                    if ( type === \"ParamValue\" )\n                    {\n                        var match = $self[0].name.match( /^ParamValue\\[(\\d+)]\\[(\\d+)]$/ );\n                    }\n                    if ( type === \"ItemOrderParams\" )\n                    {\n                        var match = $self[0].name.match( /^ItemOrderParams\\[(\\d+)]\\[(\\w+)]$/ );\n                    }\n                    articleWithParams = addOrderParamValue( articleWithParams, match[1], match[2], $self.val() );\n\n                }\n                else if ( attrType == 'file' )\n                {\n                    if ( $self[0].files && $self[0].files.length > 0 )\n                    {\n                        articleWithParams = orderParamFileUpload( $self, articleWithParams );\n                    }\n                    else\n                    {\n                        if ( type === \"ParamValue\" )\n                        {\n                            var match      = $self[0].name.match( /^ParamValueFile\\[(\\d+)]\\[(\\d+)]$/ );\n                            var paramValue = $( 'input[type=\"hidden\"][name=\"ParamValue[' + match[1] + '][' + match[2] + ']\"]' ).val();\n                        }\n                        if ( type === \"ItemOrderParams\" )\n                        {\n                            var match      = $self[0].name.match( /^ItemOrderParamsFile\\[(\\d+)]\\[(\\d+)]$/ );\n                            var paramValue = $( 'input[type=\"hidden\"][name=\"ItemOrderParamsFile[' + match[1] + '][' + match[2] + ']\"]' ).val();\n                        }\n\n                        articleWithParams = addOrderParamValue( articleWithParams, match[1], match[2], paramValue );\n                    }\n                }\n            }\n\n            return articleWithParams;\n        }\n\n        function addArticle( article )\n        {\n            API.post( '/rest/checkout/basketitemslist/', article, true )\n                .done( function()\n                {\n                    // Item has no OrderParams -> Refresh Checkout & BasketPreview\n                    Checkout.loadCheckout()\n                        .done( function()\n                        {\n                            var $artAttr           = $( \"[name^=ArticleAttribute]\" );\n                            var $unitCombinationId = article[0].BasketItemPriceID;\n                            var requestData        = {ArticleID: article[0].BasketItemItemID};\n\n                            if ( $artAttr.val() > 0 )\n                            {\n                                $artAttr.each( function( i, value )\n                                {\n                                    value                             = $( value );\n                                    requestData[value.attr( \"name\" )] = value.val();\n                                } );\n                            }\n                            else if ( $unitCombinationId && $unitCombinationId > 0 )\n                            {\n                                requestData[\"UnitCombinationId\"] = $unitCombinationId;\n                            }\n\n                            refreshBasketPreview();\n\n                            // Show confirmation popup\n                            CMS.getContainer( 'ItemViewItemToBasketConfirmationOverlay', requestData ).from( 'ItemView' )\n                                .done( function( response )\n                                {\n                                    var timeout = pm.getGlobal( 'TimeoutItemToBasketOverlay', 5000 );\n                                    var modal   = Modal.prepare().setContent( response.data[0] );\n\n                                    if ( timeout > 0 )\n                                    {\n                                        modal.setTimeout( timeout );\n                                    }\n\n                                    modal.show();\n                                } );\n                        } );\n                } ).fail( function( jqXHR )\n            {\n                // some other error occured\n                UI.printErrors( JSON.parse( jqXHR.responseText ).error.error_stack );\n            } );\n        }\n\n        function updateArticle( article )\n        {\n            API.put( '/rest/checkout/basketitemslist/', article )\n                .done( function()\n                {\n                    // Item has no OrderParams -> Refresh Checkout & BasketPreview\n                    Checkout.reloadCatContent( pm.getGlobal( 'basketCatID' ) );\n                    Checkout.loadCheckout()\n                        .done( function()\n                        {\n                            refreshBasketPreview();\n                        } );\n                } )\n        }\n\n        function orderParamFileUpload( $input, articleWithParams )\n        {\n            var key                   = $input[0].id;\n            var orderParamUploadFiles = {};\n            var orderParamFileIdStack = [];\n            var formData;\n            var fileData;\n            var params                = {\n                type       : 'POST',\n                data       : {},\n                isFile     : true,\n                cache      : false,\n                dataType   : 'json',\n                processData: false,\n                contentType: false\n            };\n\n            orderParamUploadFiles[key] = $input[0].files;\n\n            // if input not pushed before.\n            if ( orderParamFileIdStack.indexOf( key ) == -1 )\n            {\n                orderParamFileIdStack.push( key );\n            }\n\n            for ( var i = 0, length = orderParamFileIdStack.length; i < length; ++i )\n            {\n                formData = new FormData();\n                fileData = orderParamUploadFiles[orderParamFileIdStack[i]];\n                formData.append( \"0\", fileData[0], fileData[0].name );\n\n                params.data = formData;\n\n                API.post( \"/rest/checkout/orderparamfile/\", params );\n            }\n\n            var match = $input[0].name.match( /^ParamValueFile\\[(\\d+)]\\[(\\d+)]$/ );\n            if ( !match )\n            {\n                match = $input[0].name.match( /^ItemOrderParamsFile\\[(\\d+)]\\[(\\d+)]$/ );\n            }\n\n            return addOrderParamValue( articleWithParams, match[1], match[2], orderParamUploadFiles[key][0]['name'] );\n        }\n\n        /**\n         * Inject an OrderParam.\n         * @function addOrderParamValue\n         * @private\n         * @param {Array} basketList The target to inject the value in.\n         * @param {number} position Position where to inject the value\n         * @param {number} paramId The ID of the OrderParam to inject\n         * @param {string|number} paramValue the value of the OrderParam to inject\n         * @returns {Array} Containing the item and the injected OrderParam\n         */\n        function addOrderParamValue( basketList, position, paramId, paramValue )\n        {\n            if ( position > 0 && basketList[position] == undefined )\n            {\n                basketList[position]                           = $.extend( true, {}, basketList[0] );\n                basketList[position].BasketItemOrderParamsList = [];\n            }\n\n            if ( basketList[position] != undefined )\n            {\n                basketList[position].BasketItemQuantity = 1;\n                if ( basketList[position].BasketItemOrderParamsList == undefined )\n                {\n                    basketList[position].BasketItemOrderParamsList = [];\n                }\n                if ( paramValue )\n                {\n                    basketList[position].BasketItemOrderParamsList.push( {\n                        BasketItemOrderParamID   : paramId,\n                        BasketItemOrderParamValue: paramValue\n                    } );\n                }\n            }\n\n            return basketList;\n        }\n\n        function editItemAttributes( BasketItemID )\n        {\n            var modal = $( '[data-plenty-basket-item=\"' + BasketItemID + '\"]' );\n            modal.foundation('reveal','open');\n            modal.find( '[data-plenty-modal=\"confirm\"]' ).on( 'click', function()\n            {\n                var basketItem     = getBasketItem( BasketItemID );\n                var attributesList = [];\n\n                // check for select or list of images\n                modal.find( 'select, .PlentyFormContainer.AttrImage > input[type=\"hidden\"]' ).each( function( i, attributeSelect )\n                {\n                    var match = attributeSelect.name.match( /^ArticleAttribute\\[\\d+]\\[\\d+]\\[(\\d+)]$/ );\n                    if ( match && match[1] )\n                    {\n                        attributesList.push( {\n                            BasketItemAttributeID     : match[1],\n                            BasketItemAttributeValueID: $( attributeSelect ).val()\n                        } );\n                    }\n\n                } );\n\n                if ( attributesList.length != 0 )\n                {\n                    basketItem.BasketItemAttributesList = attributesList;\n                }\n                //update basketItem and refresh previewLists\n                updateArticle( [basketItem] );\n\n            } );\n        }\n\n        function editOrderParams( BasketItemID )\n        {\n\n            var basketItem = getBasketItem( BasketItemID );\n            // FIX: unset old order params\n\n            basketItem.BasketItemOrderParamsList = [];\n\n            API.get( '/rest/checkout/container_' + 'CheckoutOrderParamsList'.toLowerCase() + '/', {\n                itemID      : basketItem.BasketItemItemID,\n                quantity    : basketItem.BasketItemQuantity,\n                basketItemID: BasketItemID\n            } ).done( function( resp )\n            {\n                // checking for order params!\n                Modal.prepare()\n                    .setContent( resp.data[0] )\n                    .setTitle( pm.translate( \"Edit order parameters\" ) )\n                    .setLabelConfirm( pm.translate( \"Save\" ) )\n                    .onConfirm( function()\n                    {\n                        // validate form\n                        if ( $( '[data-plenty-checkout-form=\"OrderParamsForm\"]' ).validateForm() )\n                        {\n                            // save order params\n                            updateArticle( saveOrderParams( [basketItem] ) );\n\n                            // close modal after saving order params\n                            return true;\n                        }\n                        else\n                        {\n                            return false;\n                        }\n                    } )\n                    .show();\n            } );\n        }\n\n        function getBasketItem( BasketItemID )\n        {\n            var basketItems = Checkout.getCheckout().BasketItemsList;\n            for ( var i = 0; i < basketItems.length; i++ )\n            {\n                if ( basketItems[i].BasketItemID == BasketItemID )\n                {\n                    return basketItems[i];\n                }\n            }\n\n            return null;\n        }\n\n        /**\n         * Remove item from basket. Will show a confirmation popup at first.\n         * @function removeBasketItem\n         * @param {number}  BasketItemID The ID of the basket item to remove\n         * @param {boolean} [forceDelete=false]  Set true to remove the basket item without showing a confirmation popup\n         * @return Promise\n         */\n        function removeBasketItem( BasketItemID, forceDelete )\n        {\n\n            var deferred = $.Deferred();\n\n            // get item name\n            var itemName = getBasketItem( BasketItemID ).BasketItemNameMap[1];\n\n            // calling the delete request\n            function doDelete()\n            {\n                API.delete( '/rest/checkout/basketitemslist/?basketItemIdsList[0]=' + BasketItemID )\n                    .done( function()\n                    {\n                        Checkout.loadCheckout().done( function()\n                        {\n                            //$( '[data-basket-item-id=\"' + BasketItemID + '\"]' ).remove();\n\n                            if ( !Checkout.getCheckout().BasketItemsList || Checkout.getCheckout().BasketItemsList.length <= 0 )\n                            {\n                                Checkout.reloadCatContent( pm.getGlobal( 'basketCatID' ) );\n                            }\n                            else\n                            {\n                                // FALLBACK if design not support selector\n                                // [data-plenty-checkout-template=\"BasketItemsList\"]\n                                if ( $( '[data-plenty-checkout-template=\"BasketItemsList\"]' ).length === 0 )\n                                {\n                                    API.get( \"/rest/checkout/container_checkoutbasketitemslist/\" ).done( function( response )\n                                    {\n                                        var $oldBasketList       = $( '[data-basket-item-id]' ).parents( \"ul\" );\n                                        var $basketListContainer = $oldBasketList.parents( \".panel-body\" );\n                                        $oldBasketList.fadeOut( function()\n                                        {\n                                            $( this ).siblings( \":not('[data-plenty-checkout-template]')\" ).remove();\n                                            $( this ).remove();\n                                            $basketListContainer.prepend( $( response.data[0] ) ).hide().fadeIn( function()\n                                            {\n                                                pm.getInstance().bindDirectives( $basketListContainer );\n                                            } );\n                                        } );\n                                    } );\n                                }\n                                else\n                                {\n                                    Checkout.reloadContainer( 'BasketItemsList' );\n                                }\n                                Checkout.reloadContainer( 'Totals' );\n                            }\n\n                            refreshBasketPreview();\n\n                            deferred.resolve();\n                        } );\n                    } );\n            }\n\n            if ( !forceDelete )\n            {\n                // show confirmation popup\n                Modal.prepare()\n                    .setTitle( pm.translate( 'Please confirm' ) )\n                    .setContent( '<p>' + pm.translate( \"Do you really want to remove \\\"{{item}}\\\" from your basket?\", {item: itemName} ) + '</p>' )\n                    .onDismiss( function()\n                    {\n                        //$('[data-basket-item-id=\"' + BasketItemID +\n                        // '\"]').find('[data-plenty=\"quantityInput\"]').val(originalItemQuantity);\n                        deferred.reject();\n                    } )\n                    .onConfirm( function()\n                    {\n                        doDelete();\n                    } )\n                    .setLabelConfirm( pm.translate( \"Delete\" ) )\n                    .show();\n            }\n            else\n            {\n                doDelete();\n            }\n\n            return deferred;\n        }\n\n        /**\n         * Set a new quantity for the given BasketItem. If quantity is set to 0,\n         * remove the item.\n         * @function setItemQuantity\n         * @param {number} BasketItemID The ID of the basket item to change the quantity of\n         * @param {number} BasketItemQuantity  The new quantity to set or 0 to remove the item\n         */\n        function setItemQuantity( BasketItemID, BasketItemQuantity )\n        {\n            // delete item if quantity is 0\n            if ( BasketItemQuantity <= 0 )\n            {\n                return removeBasketItem( BasketItemID );\n            }\n\n            var deferred = $.Deferred();\n            var params   = Checkout.getCheckout().BasketItemsList;\n            var basketItem;\n            var basketItemIndex;\n\n            for ( var i = 0; i < params.length; i++ )\n            {\n                if ( params[i].BasketItemID == BasketItemID )\n                {\n                    basketItemIndex = i;\n                    basketItem      = params[i];\n                    break;\n\n                }\n            }\n\n            if ( !!basketItem && basketItem.BasketItemQuantity != BasketItemQuantity )\n            {\n                params[basketItemIndex].BasketItemQuantity = parseInt( BasketItemQuantity );\n\n                return API.post( \"/rest/checkout/basketitemslist/\", params )\n                    .done( function()\n                    {\n                        Checkout.setCheckout().done( function()\n                        {\n                            Checkout.reloadCatContent( pm.getGlobal( 'basketCatID' ) );\n                            refreshBasketPreview();\n                            deferred.resolve();\n                        } );\n                    } ).fail( function(response)\n                    {\n                      Checkout.reloadCatContent( pm.getGlobal( 'basketCatID' ) );\n                      refreshBasketPreview();\n                      deferred.resolve();\n                    } );\n            }\n\n            return deferred;\n        }\n\n        /**\n         * Reload BasketPreview-Template and update basket totals\n         * @function refreshBasketPreview\n         * @private\n         */\n        function refreshBasketPreview()\n        {\n\n            Checkout.reloadItemContainer( 'BasketPreviewList' )\n                .done( function()\n                {\n\n                    $( '[data-plenty-basket-empty]' ).each( function( i, elem )\n                    {\n                        var toggleClass = $( elem ).attr( 'data-plenty-basket-empty' );\n                        if ( Checkout.getCheckout().BasketItemsList.length <= 0 )\n                        {\n                            $( elem ).addClass( toggleClass );\n                        }\n                        else\n                        {\n                            $( elem ).removeClass( toggleClass );\n                        }\n                    } );\n\n                } );\n\n            //update quantity\n            var itemQuantityTotal = 0;\n            $.each( Checkout.getCheckout().BasketItemsList, function( i, basketItem )\n            {\n                itemQuantityTotal += convertToFloat( basketItem.BasketItemQuantity );\n            } );\n\n            $( '[data-plenty-basket-preview=\"basketItemCount\"]').text( Checkout.getCheckout().BasketItemsList.length );\n            $( '[data-plenty-basket-preview=\"itemQuantityTotal\"]' ).text( itemQuantityTotal );\n            $( '[data-plenty-basket-preview=\"totalsItemSum\"]' ).text( Checkout.getCheckout().Totals.TotalsItemSum );\n        }\n\n        function convertToFloat(n) {\n\n            if ( typeof n === \"number\" )\n            {\n                return n;\n            }\n            n = n.replace(',', '.');\n            if(!isNaN(parseFloat(n)) && isFinite(n))\n            {\n                return parseFloat(n);\n            }\n            return 0;\n        }\n\n        /**\n         * Read the coupon code from an &lt;input> element marked with <b>data-plenty-checkout-form=\"couponCode\"</b>\n         * and try to add this coupon.\n         * @function addCoupon\n         * @param {object} input triggering HTML element (optional)\n         * @return {object} <a href=\"http://api.jquery.com/category/deferred-object/\" target=\"_blank\">jQuery deferred\n         *     Object</a>\n         */\n        function addCoupon(input)\n        {\n            var couponInput = $( '[data-plenty-checkout-form=\"couponCode\"]' );\n            if (typeof input !== 'undefined') {\n              if ($(input).parents('[data-plenty-checkout-template=\"Coupon\"]').length) {\n                couponInput = $(input).parents('[data-plenty-checkout-template=\"Coupon\"]').find('[data-plenty-checkout-form=\"couponCode\"]');\n              }\n            }\n\n            var params = {\n                CouponActiveCouponCode: couponInput.val()\n            };\n\n            return API.post( \"/rest/checkout/coupon/\", params )\n                .done( function()\n                {\n                    Checkout.setCheckout()\n                        .done( function()\n                        {\n\n                            updateContainer();\n                        } );\n                } );\n        }\n\n        /**\n         * Remove the currently added coupon\n         * @function removeCoupon\n         * @return {object} <a href=\"http://api.jquery.com/category/deferred-object/\" target=\"_blank\">jQuery deferred\n         *     Object</a>\n         */\n        function removeCoupon()\n        {\n            var params = {\n                CouponActiveCouponCode: Checkout.getCheckout().Coupon.CouponActiveCouponCode\n            };\n\n            return API.delete( \"/rest/checkout/coupon/\", params )\n                .done( function()\n                {\n                    Checkout.setCheckout()\n                        .done( function()\n                        {\n                            delete Checkout.getCheckout().Coupon;\n\n                            updateContainer();\n                        } );\n                } );\n        }\n\n        // update container\n        function updateContainer()\n        {\n            Checkout.reloadContainer( 'Coupon' );\n            // reload totals, if we are at basket\n            if ( $( '[data-plenty-checkout-template=\"Totals\"]' ).length > 0 )\n            {\n                Checkout.reloadContainer( 'Totals' );\n            }\n        }\n\n        /**\n         * Set scheduler in checkout.\n         * @function setScheduler\n         * @param   {Array}     scheduler         Array containing the scheduler data\n         * @return {object} <a href=\"http://api.jquery.com/category/deferred-object/\" target=\"_blank\">jQuery deferred\n         *     Object</a>\n         */\n        function setScheduler(scheduler)\n        {\n            return API.put(\"/rest/checkout/scheduler\", scheduler)\n                .done( function()\n                {\n                    updateContainer();\n                } );\n        }\n\n    }, ['APIFactory', 'UIFactory', 'CMSFactory', 'CheckoutFactory', 'ModalFactory'] );\n}( jQuery, PlentyFramework ));\n\n/**\n * Licensed under AGPL v3\n * (https://github.com/plentymarkets/plenty-cms-library/blob/master/LICENSE)\n * =====================================================================================\n * @copyright   Copyright (c) 2015, plentymarkets GmbH (http://www.plentymarkets.com)\n * @author      Felix Dausch <felix.dausch@plentymarkets.com>\n * =====================================================================================\n */\n\n/**\n * @module Services\n */\n(function( $, pm )\n{\n\n    /**\n     * Providing methods for checkout process like setting shipping & payment information and placing the order.<br>\n     * <b>Requires:</b>\n     * <ul>\n     *     <li>{{#crossLink \"APIFactory\"}}APIFactory{{/crossLink}}</li>\n     *     <li>{{#crossLink \"CMSFactory\"}}CMSFactory{{/crossLink}}</li>\n     *     <li>{{#crossLink \"CheckoutFactory\"}}CheckoutFactory{{/crossLink}}</li>\n     *     <li>{{#crossLink \"ModalFactory\"}}ModalFactory{{/crossLink}}</li>\n     * </ul>\n     * @class CheckoutService\n     * @static\n     */\n    pm.service( 'CheckoutService', function( API, UI, CMS, Checkout, Modal )\n    {\n\n        return {\n            init                  : init,\n            setCustomerSignAndInfo: setCustomerSignAndInfo,\n            registerGuest         : registerGuest,\n            setShippingProfile    : setShippingProfile,\n            saveShippingAddress   : saveShippingAddress,\n            loadAddressSuggestion : loadAddressSuggestion,\n            preparePayment        : preparePayment,\n            setMethodOfPayment    : setMethodOfPayment,\n            confirmAtrigaPaymax   : confirmAtrigaPaymax,\n            editBankDetails       : editBankDetails,\n            editCreditCard        : editCreditCard,\n            placeOrder            : placeOrder\n        };\n\n        /**\n         * Load checkout data initially on page load\n         * @function init\n         */\n        function init()\n        {\n            Checkout.loadCheckout( true );\n        }\n\n        /**\n         * Read customer sign and order information text from &lt;form> marked with\n         * <b>data-plenty-checkout-form=\"details\"</b> and update checkout.\n         * @function setCustomerSignAndInfo\n         * @return {object} <a href=\"http://api.jquery.com/category/deferred-object/\" target=\"_blank\">jQuery deferred\n         *     Object</a>\n         */\n        function setCustomerSignAndInfo()\n        {\n            var form   = $( '[data-plenty-checkout-form=\"details\"]' );\n            var values = form.getFormValues();\n\n            // initialize CustomerSign & InfoText to avoid updating empty values\n            if ( !Checkout.getCheckout().CheckoutCustomerSign )\n            {\n                Checkout.getCheckout().CheckoutCustomerSign = \"\";\n            }\n            if ( !Checkout.getCheckout().CheckoutOrderInfoText )\n            {\n                Checkout.getCheckout().CheckoutOrderInfoText = \"\";\n            }\n\n            if ( ( Checkout.getCheckout().CheckoutCustomerSign !== values.CustomerSign && $( form ).find( '[name=\"CustomerSign\"]' ).length > 0 )\n                || ( Checkout.getCheckout().CheckoutOrderInfoText !== values.OrderInfoText && $( form ).find( '[name=\"OrderInfoText\"]' ).length > 0 ) )\n            {\n\n                Checkout.getCheckout().CheckoutCustomerSign  = values.CustomerSign;\n                Checkout.getCheckout().CheckoutOrderInfoText = values.OrderInfoText;\n\n                return Checkout.setCheckout();\n\n            }\n            else\n            {\n                // No changes detected -> Do nothing\n                return API.idle();\n            }\n        }\n\n        /**\n         * Read address data from &lt;form> marked with <b>data-plenty-checkout-form=\"shippingAddress\"</b>.\n         * Create new shipping address or update the shipping address ID.\n         * @function saveShippingAddress\n         * @param {boolean} [validateForm = false] validate form before processing requests\n         * @return {object} <a href=\"http://api.jquery.com/category/deferred-object/\" target=\"_blank\">jQuery deferred\n         *     Object</a>\n         */\n        function saveShippingAddress( validateForm )\n        {\n            var form = $( '[data-plenty-checkout-form=\"shippingAddress\"]' );\n\n            if ( !validateForm && !form.validateForm() )\n            {\n                return false;\n            }\n\n            if ( !validateForm && !pm.getInstance().AddressDoctorService.validateAddress( form ) )\n            {\n                return false;\n            }\n\n            var values            = form.getFormValues();\n            var shippingAddressID = $( '[name=\"shippingAddressID\"]:checked' ).val();\n\n            form.foundation('reveal', 'close');\n\n            if ( shippingAddressID < 0 )\n            {\n                // save separate\n                var shippingAddress = values;\n\n                if ( !addressesAreEqual( shippingAddress, Checkout.getCheckout().CustomerShippingAddress ) )\n                {\n                    if ( shippingAddress.Street == \"PACKSTATION\" )\n                    {\n                        shippingAddress.IsPackstation = 1;\n                        shippingAddress.PackstationNo = shippingAddress.HouseNo;\n                    }\n                    else if ( shippingAddress.Street == \"POSTFILIALE\" )\n                    {\n                        shippingAddress.IsPostfiliale = 1;\n                        shippingAddress.PostfilialNo  = shippingAddress.HouseNo;\n                    }\n\n                    // new shipping address\n                    return API.post( \"/rest/checkout/customershippingaddress/\", shippingAddress )\n                        .done( function( response )\n                        {\n\n                            Checkout.getCheckout().CheckoutCustomerShippingAddressID = response.data.ID;\n                            Checkout.getCheckout().CheckoutShippingCountryID         = response.data.CountryID;\n\n                            updatePaymentAndShippingDependencies();\n                        } );\n                }\n                else\n                {\n                    // no changes detected\n                    return API.idle();\n                }\n\n            }\n            else\n            {\n                if ( shippingAddressID != Checkout.getCheckout().CheckoutCustomerShippingAddressID )\n                {\n                    // change shipping address id\n                    Checkout.getCheckout().CheckoutCustomerShippingAddressID = shippingAddressID;\n\n                    updatePaymentAndShippingDependencies();\n                }\n                else\n                {\n                    return API.idle();\n                }\n            }\n        }\n\n        function updatePaymentAndShippingDependencies()\n        {\n            delete Checkout.getCheckout().CheckoutMethodOfPaymentID;\n            delete Checkout.getCheckout().CheckoutShippingProfileID;\n\n            return Checkout.setCheckout().done( function()\n            {\n                Checkout.reloadContainer( \"MethodsOfPaymentList\" );\n                Checkout.reloadContainer( \"ShippingProfilesList\" );\n\n                if ( Checkout.getCheckout().CustomerInvoiceAddress.LoginType == 2 )\n                {\n                    Checkout.reloadContainer( 'CustomerShippingAddress' );\n                }\n            } );\n        }\n\n        /**\n         * Prepare address-data to register a guest. Reads the address-data from a &lt;form> marked with\n         * <b>data-plenty-checkout-form=\"guestRegistration\"</b>\n         * @function registerGuest\n         * @return {object} <a href=\"http://api.jquery.com/category/deferred-object/\" target=\"_blank\">jQuery deferred\n         *     Object</a>\n         */\n        function registerGuest()\n        {\n            var form = $( '[data-plenty-checkout-form=\"guestRegistration\"]' );\n\n            var invoiceAddress       = form.getFormValues();\n            var customProp           = $( form ).find( \"[id^='plentyCustomerProperty']\" );\n            invoiceAddress.LoginType = 1;\n\n            // add custom properties if necessary.\n            if ( invoiceAddress.checkout\n                && invoiceAddress.checkout.customerInvoiceAddress\n                && invoiceAddress.checkout.customerInvoiceAddress.CustomerProperty )\n            {\n                var tmpProperties                     = invoiceAddress.checkout.customerInvoiceAddress.CustomerProperty;\n                invoiceAddress.CustomerPropertiesList = invoiceAddress.CustomerPropertiesList || [];\n\n                for ( var property in tmpProperties )\n                {\n                    if ( tmpProperties[property] )\n                    {\n                        invoiceAddress.CustomerPropertiesList.push( {\n                            PropertyID   : property,\n                            PropertyValue: tmpProperties[property]\n                        } );\n                    }\n                }\n            }\n            else if ( customProp.length > 0 )\n            {\n                invoiceAddress.CustomerPropertiesList = [];\n                for ( var i = customProp.length - 1; i >= 0; i-- )\n                {\n                    var $tmpEl = $( customProp[i] );\n                    invoiceAddress.CustomerPropertiesList.push(\n                        {\n                            PropertyID   : $tmpEl.attr( \"data-plenty-property-id\" ),\n                            PropertyValue: $tmpEl.val()\n                        } );\n                }\n            }\n\n            if ( !addressesAreEqual( invoiceAddress, Checkout.getCheckout().CustomerInvoiceAddress ) )\n            {\n                return API.post( \"/rest/checkout/customerinvoiceaddress/\", invoiceAddress )\n                    .done( function( response )\n                    {\n                        saveShippingAddress().done( Checkout.loadCheckout );\n                    } );\n            }\n            else\n            {\n                return saveShippingAddress();\n            }\n        }\n\n        /**\n         * Check if values of addresses are equal\n         * @function addressesAreEqual\n         * @private\n         * @param {object} address1\n         * @param {object} address2\n         * @returns {boolean}\n         */\n        function addressesAreEqual( address1, address2 )\n        {\n            for ( var key in address1 )\n            {\n                if ( address1[key] + '' !== address2[key] + '' && key !== 'EmailRepeat' )\n                {\n                    return false;\n                }\n            }\n            return true;\n        }\n\n        /**\n         * Set the shipping profile used for this order and update checkout. Selected shipping profile will be\n         * read from &lt;form> marked with <b>data-plenty-checkout-form=\"shippingProfileSelect\"</b>\n         * @function setShippingProfile\n         * @return {object} <a href=\"http://api.jquery.com/category/deferred-object/\" target=\"_blank\">jQuery deferred\n         *     Object</a>\n         */\n        function setShippingProfile()\n        {\n\n            var values = $( '[data-plenty-checkout-form=\"shippingProfileSelect\"]' ).getFormValues();\n\n            Checkout.getCheckout().CheckoutShippingProfileID = values.ShippingProfileID;\n            delete Checkout.getCheckout().CheckoutCustomerShippingAddressID;\n            delete Checkout.getCheckout().CheckoutMethodOfPaymentID;\n\n            return Checkout.setCheckout()\n                .done( function()\n                {\n                    Checkout.reloadContainer( 'MethodsOfPaymentList' );\n                } );\n\n        }\n\n        /**\n         * Prepare method of payment to check if external checkout is used or addition content should be displayed\n         * @function preparePayment\n         * @return {object} <a href=\"http://api.jquery.com/category/deferred-object/\" target=\"_blank\">jQuery deferred\n         *     Object</a>\n         */\n        function preparePayment()\n        {\n            var paymentID   = Checkout.getCheckout().CheckoutMethodOfPaymentID;\n            var paymentData = $( 'input[type=\"radio\"][name=\"MethodOfPaymentID\"][value=\"' + paymentID + '\"]' ).parent().getFormValues();\n            return API.post( \"/rest/checkout/preparepayment/\", paymentData, true )\n                .done( function( response )\n                {\n                    if ( response.data.CheckoutMethodOfPaymentRedirectURL != '' )\n                    {\n\n                        document.location.assign( response.data.CheckoutMethodOfPaymentRedirectURL );\n\n                    }\n                    else if ( !!response.data.CheckoutMethodOfPaymentAdditionalContent )\n                    {\n\n                        var isBankDetails = $( response.data.CheckoutMethodOfPaymentAdditionalContent ).find( '[data-plenty-checkout-form=\"bankDetails\"]' ).length > 0;\n                        Modal.prepare()\n                            .setContent( response.data.CheckoutMethodOfPaymentAdditionalContent )\n                            .onConfirm( function()\n                            {\n                                if ( isBankDetails )\n                                {\n                                    return saveBankDetails();\n                                }\n                                else\n                                {\n                                    return saveCreditCard();\n                                }\n                            } )\n                            .show();\n                    }\n                } )\n                .fail( function( jqXHR )\n                {\n                    try\n                    {\n                        var response = $.parseJSON( jqXHR.responseText );\n\n                        var errorStack = [];\n                        for ( var i = 0; i < response.error.error_stack.length; i++ )\n                        {\n                            if ( response.error.error_stack[i].code == 651 )\n                            {\n                                // notify atriga validation errors\n                                Checkout.reloadContainer( 'MethodsOfPaymentList' ).done( function()\n                                {\n                                    $( document ).trigger( 'plenty.AtrigaValidationFailed' );\n                                } );\n                            }\n                            else\n                            {\n                                errorStack.push( response.error.error_stack[i] );\n                            }\n                        }\n\n                        // display remaining errors\n                        if ( errorStack.length > 0 )\n                        {\n                            UI.printErrors( errorStack );\n                        }\n                    }\n                    catch ( e )\n                    {\n                        UI.throwError( jqXHR.status, jqXHR.statusText );\n                    }\n                } );\n\n        }\n\n        /**\n         * Set the method of payment used for this order.\n         * @function setMethodOfPayment\n         * @param {number|undefined} paymentID  ID of the method of payment to use. Read from &lt;form> marked with\n         *                                      <b>data-plenty-checkout-form=\"methodOfPayment\"</b> if unset.\n         * @return {object} <a href=\"http://api.jquery.com/category/deferred-object/\" target=\"_blank\">jQuery deferred\n         *     Object</a>\n         */\n        function setMethodOfPayment( paymentID )\n        {\n            /*\n             var methodsOfPaymentList = Checkout.getCheckout().MethodsOfPaymentList;\n             var methodOfPayment;\n             for( var i = 0; i < methodsOfPaymentList.length; i++ )\n             {\n             if( methodsOfPaymentList[i].MethodOfPaymentID == paymentID )\n             {\n             methodOfPayment = methodsOfPaymentList[i];\n             break;\n             }\n             }\n             */\n\n            if ( !paymentID )\n            {\n                // FIX for older callisto layouts (< 3.3): get payment id from input field\n                paymentID = $( 'input[name=\"MethodOfPaymentID\"]:checked' ).val();\n            }\n\n            Checkout.getCheckout().CheckoutMethodOfPaymentID = paymentID;\n\n            // checking trusted shop\n            if ( $( \"#PlentyWebPaymentMethodTsBuyerProtection\" ).length > 0 )\n            {\n                var $ts                                        = $( \"#PlentyWebPaymentMethodTsBuyerProtection\" );\n                Checkout\n                    .getCheckout()\n                    .TrustedShopsBuyerProtectionItem\n                    .TrustedShopsBuyerProtectionItemIsSelected = $ts.is( \":checked\" );\n            }\n\n            // checking for atriga\n            if ( !pm.getGlobal( 'Checkout.AtrigaRequireUserConfirmation' ) )\n            {\n                Checkout.getCheckout().CheckoutAtrigapaymaxChecked = true;\n            }\n\n            delete Checkout.getCheckout().CheckoutCustomerShippingAddressID;\n            delete Checkout.getCheckout().CheckoutShippingProfileID;\n\n            return Checkout.setCheckout()\n                .done( function()\n                {\n                    Checkout.reloadContainer( 'ShippingProfilesList' );\n                } );\n        }\n\n        function confirmAtrigaPaymax( atrigaPaymaxChecked )\n        {\n            Checkout.getCheckout().CheckoutAtrigapaymaxChecked = !!atrigaPaymaxChecked;\n            return API.put( '/rest/checkout', {\n                CheckoutAtrigapaymaxChecked: !!atrigaPaymaxChecked\n            } );\n            //return Checkout.setCheckout();\n        }\n\n        /**\n         * Display the popup to enter or edit customers bank details\n         * @function editBankDetails\n         */\n        function editBankDetails()\n        {\n\n            CMS.getContainer( 'CheckoutPaymentInformationBankDetails' ).from( 'Checkout' )\n                .done( function( response )\n                {\n                    Modal.prepare()\n                        .setContent( response.data[0] )\n                        .onDismiss( function()\n                        {\n                            $( 'input[name=\"MethodOfPaymentID\"]' ).each( function( i, radio )\n                            {\n                                if ( $( radio ).val() == Checkout.getCheckout().CheckoutMethodOfPaymentID )\n                                {\n                                    $( radio ).attr( 'checked', 'checked' );\n                                }\n                                else\n                                {\n                                    $( radio ).removeAttr( 'checked' );\n                                }\n                            } );\n                        } ).onConfirm( function()\n                    {\n                        return saveBankDetails();\n                    } )\n                        .show();\n                } );\n\n        }\n\n        /**\n         * Read entered bank details from <b>data-plenty-checkout-form=\"bankDetails\"</b> and update checkout.\n         * @function saveBankDetails\n         * @private\n         * @return {boolean} the result of form validation\n         */\n        function saveBankDetails()\n        {\n            var form = $( '[data-plenty-checkout-form=\"bankDetails\"]' );\n\n            if ( form.validateForm() )\n            {\n                var values = form.getFormValues().checkout.customerBankDetails;\n\n                var bankDetails = {\n                    CustomerBankName     : values.bankName,\n                    CustomerBLZ          : values.blz,\n                    CustomerAccountNumber: values.accountNo,\n                    CustomerAccountOwner : values.accountOwner,\n                    CustomerIBAN         : values.iban,\n                    CustomerBIC          : values.bic\n                };\n\n                API.post( \"/rest/checkout/paymentinformationbankdetails/\", bankDetails )\n                    .done( function()\n                    {\n                        Checkout.loadCheckout().done( function()\n                        {\n                            setMethodOfPayment( 3 );\n                            Checkout.reloadContainer( 'MethodsOfPaymentList' );\n                        } );\n                    } );\n                return true;\n            }\n            else\n            {\n                return false;\n            }\n        }\n\n        /**\n         * Display a popup containing credit card form\n         * @function editCreditCard\n         */\n        function editCreditCard()\n        {\n\n            CMS.getContainer( 'CheckoutPaymentInformationCreditCard' ).from( 'Checkout' )\n                .done( function( response )\n                {\n                    Modal.prepare()\n                        .setContent( response.data[0] )\n                        .onDismiss( function()\n                        {\n                            $( 'input[name=\"MethodOfPaymentID\"]' ).each( function( i, radio )\n                            {\n                                if ( $( radio ).val() == Checkout.getCheckout().CheckoutMethodOfPaymentID )\n                                {\n                                    $( radio ).attr( 'checked', 'checked' );\n                                }\n                                else\n                                {\n                                    $( radio ).removeAttr( 'checked' );\n                                }\n                            } );\n                        } ).onConfirm( function()\n                    {\n                        return saveCreditCard();\n                    } )\n                        .show();\n                } );\n        }\n\n        /**\n         * Read values from &lt;form> marked with <b>data-plenty-checkout-form=\"creditCard\"</b> and update checkout.\n         * @function saveCreditCard\n         * @private\n         * @return {boolean} the result of form validation\n         */\n        function saveCreditCard()\n        {\n            var form = $( '[data-plenty-checkout-form=\"creditCard\"]' );\n\n            if ( form.validateForm() )\n            {\n\n                var values = form.getFormValues().checkout.paymentInformationCC;\n\n                var creditCard = {\n                    Owner   : values.owner,\n                    Cvv2    : values.cvv2,\n                    Number  : values.number,\n                    Year    : values.year,\n                    Month   : values.month,\n                    Provider: values.provider\n                };\n\n                API.post( '/rest/checkout/paymentinformationcreditcard/', creditCard )\n                    .done( function()\n                    {\n                        Checkout.loadCheckout();\n                    } );\n                return true;\n            }\n            else\n            {\n                return false;\n            }\n        }\n\n        /**\n         * Display a popup containing address suggestions\n         * @param {string} type\n         */\n        function loadAddressSuggestion( type )\n        {\n\n            //check login type\n            if ( Checkout.getCheckout().CustomerInvoiceAddress.LoginType == 2 )\n            {\n                var values = $( '[data-plenty-checkout-form=\"shippingAddress\"]' ).getFormValues();\n            }\n            else\n            {\n                var values = $( '[data-plenty-checkout-form=\"guestRegistration\"]' ).getFormValues();\n            }\n\n            var params = {\n                street        : values.Street,\n                houseNo       : values.HouseNo,\n                ZIP           : values.ZIP,\n                city          : values.City,\n                postnummer    : values.Postnummer,\n                suggestionType: 'postfinder'\n            };\n\n            CMS.getContainer( 'CheckoutAddressSuggestionResultsList', params ).from( 'Checkout' )\n                .done( function( response )\n                {\n                    Modal.prepare()\n                        .setContent( response.data[0] )\n                        .show();\n                } );\n        }\n\n        /**\n         * Place the order prepared before and finish the checkout process.<br>\n         * Validate required checkboxes in <b>data-plenty-checkout-form=\"placeOrder\"</b>\n         * @function placeOrder\n         * @return {object} <a href=\"http://api.jquery.com/category/deferred-object/\" target=\"_blank\">jQuery deferred\n         *     Object</a>\n         */\n        function placeOrder()\n        {\n            var form = $( '[data-plenty-checkout-form=\"placeOrder\"]' );\n            if ( form.validateForm() )\n            {\n\n                var values = form.getFormValues();\n\n                // if not shown in layout set default 1 for mandatory fields\n                var params = {\n                    TermsAndConditionsCheck      : values.termsAndConditionsCheck || 0,\n                    WithdrawalCheck              : values.withdrawalCheck || 0,\n                    PrivacyPolicyCheck           : values.privacyPolicyCheck || 0,\n                    AgeRestrictionCheck          : values.ageRestrictionCheck || 0,\n                    NewsletterCheck              : values.newsletterCheck || 0,\n                    KlarnaTermsAndConditionsCheck: values.klarnaTermsAndConditionsCheck || 0,\n                    PayoneDirectDebitMandateCheck: values.payoneDirectDebitMandateCheck || 0,\n                    PayoneInvoiceCheck           : values.payoneInvoiceCheck || 0\n                };\n\n                return API.post( \"/rest/checkout/placeorder/\", params )\n                    .done( function( response )\n                    {\n                        if ( response.data.MethodOfPaymentRedirectURL != '' )\n                        {\n\n                            window.location.assign( response.data.MethodOfPaymentRedirectURL );\n\n                        }\n                        else if ( response.data.MethodOfPaymentAdditionalContent != '' )\n                        {\n                            /*  This is a PayOne fallback. PayOne has its own confirm button.\n                             To prevent a modal with multiple buttons and different functionality,\n                             we have to check of following MethodOfPaymentIDs and set Our confirm button\n                             only if necessary.\n                             */\n                            var confirmLabel       = pm.translate( \"Confirm\" );\n                            var paymentIdsToHandle = [3010, 3020, 3080];\n                            if ( paymentIdsToHandle.indexOf( response.data.MethodOfPaymentID ) >= 0 && response.data.MethodOfPaymentAdditionalContent.indexOf('button_nextPaymentProviderPayoneCreditCheckButton') > -1 )\n                            {\n                                confirmLabel = '';\n                            }\n\n                            Modal.prepare()\n                                .setContent( response.data.MethodOfPaymentAdditionalContent )\n                                .setLabelDismiss( '' )\n                                .setLabelConfirm( confirmLabel )\n                                .setStatic( confirmLabel === '' )\n                                .onDismiss( function()\n                                {\n                                    window.location.assign( form.attr( 'action' ) );\n                                } )\n                                .onConfirm( function()\n                                {\n                                    window.location.assign( form.attr( 'action' ) );\n                                } )\n                                .show();\n\n                        }\n                        else\n                        {\n\n                            window.location.assign( form.attr( 'action' ) );\n\n                        }\n                    } );\n            }\n        }\n\n    }, ['APIFactory', 'UIFactory', 'CMSFactory', 'CheckoutFactory', 'ModalFactory'] );\n}( jQuery, PlentyFramework ));\n\n/**\n * Licensed under AGPL v3\n * (https://github.com/plentymarkets/plenty-cms-library/blob/master/LICENSE)\n * =====================================================================================\n * @copyright   Copyright (c) 2015, plentymarkets GmbH (http://www.plentymarkets.com)\n * @author      Felix Dausch <felix.dausch@plentymarkets.com>\n * =====================================================================================\n */\n\n/**\n * @module Services\n */\n(function( $, pm )\n{\n\n    pm.service( 'FeedbackService', function( API )\n    {\n\n        return {\n            getFeedbacks : getFeedbacks,\n            addFeedback  : addFeedback,\n            ArticleTypes : articleTypes(),\n            FeedbackTypes: feedbackTypes()\n        };\n\n        /*\n         FeedbackService\n         .getFeedbacks().between('2014-12-03', '2015-07-01')\n         .for( FeedbackService.ArticleTypes.ITEM, 2732, FeedbackService.FeedbackTypes.COMMENTS_ONLY );\n         */\n        function getFeedbacks()\n        {\n            var feedbackInterval = {\n                dateStart: null,\n                dateEnd  : null\n            };\n\n            return {\n                between: setFeedbackInterval,\n                for    : listFeedbacks\n            };\n\n            function setFeedbackInterval( start, end )\n            {\n                feedbackInterval.dateStart = start;\n                feedbackInterval.dateEnd   = end;\n                return this;\n            }\n\n            function listFeedbacks( articleType, referenceId, feedbackType )\n            {\n\n                var params = {\n                    ReferenceId : referenceId,\n                    FromDate    : feedbackInterval.dateStart,\n                    ToDate      : feedbackInterval.dateEnd,\n                    FeedbackType: feedbackType || feedbackTypes().COMMENTS_AND_RATINGS\n                };\n                return API.get( '/rest/feedback/' + articleType + '/', params );\n\n            }\n        }\n\n        /*\n         FeedbackService\n         .addFeedback()\n         .withRating( 5 )\n         .withComment( 'Hallo' )\n         .withAuthor( 'Felix', 'felix.dausch@plentymarkets.com', 123456 )\n         .to( FeedbackService.ArticleTypes.ITEM, 2732 );\n         */\n        function addFeedback()\n        {\n\n            var params = {\n                Rating    : 1.0,\n                Text      : '',\n                Author    : '',\n                Email     : '',\n                CustomerId: 0\n            };\n\n            return {\n                withRating : withRating,\n                withComment: withComment,\n                withAuthor : withAuthor,\n                to         : sendFeedback\n            };\n\n            function withRating( rating )\n            {\n                params.Rating = rating;\n                return this;\n            }\n\n            function withComment( comment )\n            {\n                params.Text = comment;\n                return this;\n            }\n\n            function withAuthor( author, mail, customerID )\n            {\n                params.Author = author;\n                if ( !!mail )\n                {\n                    params.Email = mail;\n                }\n                if ( !!customerID )\n                {\n                    params.CustomerId = customerID;\n                }\n                return this;\n            }\n\n            function sendFeedback( articleType, referenceId )\n            {\n                return API.post( '/rest/feedback/' + articleType + '/', params );\n\n            }\n\n        }\n\n        function feedbackTypes()\n        {\n            return {\n                COMMENTS_ONLY       : 'comments_only',\n                RATINGS_ONLY        : 'ratings_only',\n                COMMENTS_AND_RATINGS: 'comments_with_ratings'\n            }\n        }\n\n        function articleTypes()\n        {\n            return {\n                ITEM    : 'item',\n                CATEGORY: 'category',\n                BLOG    : 'blog'\n            }\n        }\n\n    }, ['APIFactory'] );\n}( jQuery, PlentyFramework ));\n/**\n * Licensed under AGPL v3\n * (https://github.com/plentymarkets/plenty-cms-library/blob/master/LICENSE)\n * =====================================================================================\n * @copyright   Copyright (c) 2015, plentymarkets GmbH (http://www.plentymarkets.com)\n * @author      Felix Dausch <felix.dausch@plentymarkets.com>\n * =====================================================================================\n */\n\n/**\n * @module Services\n */\n(function( $, pm )\n{\n\n    /**\n     * Listens to window's size and trigger 'sizeChange' event if the Bootstrap interval changes.\n     * @class MediaSizeService\n     * @static\n     * @example\n     *      $(window).on('sizeChange', function(newValue, oldValue) {\n     *          console.log('The interval changed from ' + oldValue + ' to ' + newValue.');\n     *      });\n     */\n    pm.service( 'MediaSizeService', function()\n    {\n\n        var bsInterval;\n\n        // recalculation of the current interval on window resize\n        $( window ).resize( calculateMediaSize );\n\n        // initially calculation of the interval\n        $( document ).ready( calculateMediaSize );\n\n        return {\n            interval  : getInterval,\n            isInterval: isInterval\n        };\n\n        /**\n         * Get the currently used Bootstrap interval\n         * @function getInterval\n         * @return {\"xs\"|\"sm\"|\"md\"|\"lg\"}\n         */\n        function getInterval()\n        {\n            if ( !!bsInterval )\n            {\n                calculateMediaSize();\n            }\n\n            return bsInterval;\n        }\n\n        /**\n         * Calculate the currently used Bootstrap interval\n         * @function calculateMediaSize\n         * @private\n         */\n        function calculateMediaSize()\n        {\n            var size;\n            if ( !!window.matchMedia )\n            { // FIX IE support\n                if ( window.matchMedia( '(min-width:1200px)' ).matches )\n                {\n                    size = 'lg';\n                }\n                else if ( window.matchMedia( '(min-width:992px)' ).matches )\n                {\n                    size = 'md';\n                }\n                else if ( window.matchMedia( '(min-width:768px)' ).matches )\n                {\n                    size = 'sm';\n                }\n                else\n                {\n                    size = 'xs';\n                }\n            }\n            else\n            {\n                if ( $( window ).width() >= 1200 )\n                {\n                    size = 'lg';\n                }\n                else if ( $( window ).width() >= 992 )\n                {\n                    size = 'md';\n                }\n                else if ( $( window ).width() >= 768 )\n                {\n                    size = 'sm';\n                }\n                else\n                {\n                    size = 'xs';\n                }\n            }\n            if ( size != bsInterval || size === 'xs' )\n            {\n                var oldValue = bsInterval;\n                bsInterval   = size;\n                $( window ).trigger( 'sizeChange', [bsInterval, oldValue] );\n            }\n        }\n\n        function isInterval( interval )\n        {\n            var intervalList = interval.replace( /\\s/g, '' ).split( ',' );\n            for ( var i = 0; i < intervalList.length; i++ )\n            {\n                if ( intervalList[i] == bsInterval )\n                {\n                    return true;\n                }\n            }\n            return false;\n        }\n\n    } );\n\n}( jQuery, PlentyFramework ));\n/**\n * Licensed under AGPL v3\n * (https://github.com/plentymarkets/plenty-cms-library/blob/master/LICENSE)\n * =====================================================================================\n * @copyright   Copyright (c) 2015, plentymarkets GmbH (http://www.plentymarkets.com)\n * @author      Felix Dausch <felix.dausch@plentymarkets.com>\n * =====================================================================================\n */\n\n/**\n * @module Services\n */\n(function( $, pm )\n{\n\n    /**\n     * Handling navigation while checkout processes\n     * @class NavigatorService\n     * @static\n     *\n     */\n    pm.service( 'NavigatorService', function( CMS, Checkout )\n    {\n        var navigation = [];\t\t// contains navigation list elements\n        var container = [];\t\t// content containers\n        var current = -1;\t\t// index of currently shown content container\n        var buttonPrev = {};\t\t// navigation buttons\n        var buttonNext     = {};\n        var interceptors   = {\n            beforeChange: [],\n            afterChange : []\n        };\n        var checkoutStates = [];\n\n        return {\n            init               : init,\n            getCurrentContainer: getCurrentContainer,\n            goTo               : goTo,\n            beforeChange       : beforeChange,\n            afterChange        : afterChange,\n            continueChange     : continueChange,\n            next               : next,\n            previous           : previous,\n            goToID             : goToID,\n            fillNavigation     : fillNavigation\n        };\n\n        /**\n         * Initialize checkout navigation. Shows first container.\n         * @function init\n         * @example\n         * ```html\n         *  <button data-plenty-checkout=\"prev\">zurck</button>\n         *  <ul data-plenty-checkout=\"navigation\">\n         *      <li>Checkout Step 1</li>\n         *      <li>Checkout Step 2</li>\n         *      <li>...</li>\n         *  </ul>\n         *  <button data-plenty-checkout=\"next\">weiter</button>\n         *\n         *  <div data-plenty-checkout=\"container\">\n         *      <div data-plenty-checkout-id=\"step_1\">\n         *          Checkout Step 1 Content\n         *      </div>\n         *      <div data-plenty-checkout-id=\"step_2\">\n         *          Checkout Step 2 Content\n         *      </div>\n         *      <div> ... </div>\n         *  </div>\n         * ```\n         */\n        function init()\n        {\n\n            // get elements from DOM\n            navigation = $( '[data-plenty-checkout=\"navigation\"] > li' );\n            container  = $( '[data-plenty-checkout=\"container\"] > div' );\n            buttonNext = $( '[data-plenty-checkout=\"next\"]' );\n            buttonPrev = $( '[data-plenty-checkout=\"prev\"]' );\n\n            if ( navigation.length == container.length && container.length > 0 )\n            {\n                var checkout = Checkout.getCheckout();\n\n                container.hide();\n\n                // initialize navigation\n                navigation.each( function( i, elem )\n                {\n                    $( elem ).addClass( 'disabled' );\n                    // handle navigation click events\n                    $( elem ).click( function()\n                    {\n                        if ( !$( this ).is( '.disabled' ) )\n                        {\n                            goTo( i );\n                        }\n                    } );\n                } );\n\n                buttonNext.attr( \"disabled\", \"disabled\" );\n                buttonNext.click( function()\n                {\n                    next();\n                } );\n\n                buttonPrev.attr( \"disabled\", \"disabled\" );\n                buttonPrev.click( function()\n                {\n                    previous();\n                } );\n\n                window.addEventListener( 'hashchange', function()\n                {\n                    if ( window.location.hash.length > 0 )\n                    {\n                        goToID( window.location.hash );\n                    }\n                    else\n                    {\n                        goTo( 0 );\n                    }\n                }, false );\n\n                // initialize GUI\n                // check url param for jumping to tab\n                $.urlParam = function( name )\n                {\n                    var results = new RegExp( '[\\?&]' + name + '=([^&#]*)' ).exec( window.location.href );\n                    if ( results == null )\n                    {\n                        return null;\n                    }\n                    else\n                    {\n                        return results[1] || 0;\n                    }\n                };\n\n                var param = $.urlParam( 'gototab' );\n                // jump to hash from url param 'gototab'\n                if ( window.location.hash.length == 0 && !!param && $( '[data-plenty-checkout-id=\"' + param + '\"]' ).length > 0 )\n                {\n                    window.location.hash = param;\n                }\n                // jump to hash\n                else if ( !goToID( window.location.hash ) && current >= 0 )\n                {\n                    goTo( current );\n                }\n                else\n                {\n                    goTo( 0 );\n                }\n\n                fillNavigation();\n                $( window ).on( 'sizeChange', fillNavigation );\n                $( window ).resize( function()\n                {\n                    if ( pm.getInstance().MediaSizeService.interval() == 'xs' )\n                    {\n                        fillNavigation();\n                    }\n                } );\n\n            }\n        }\n\n        /**\n         * Get the currently active checkout container.\n         * @function getCurrentContainer\n         * @return {{id: string, index: number}}\n         */\n        function getCurrentContainer()\n        {\n            if ( current >= 0 )\n            {\n                return {\n                    id   : $( container[current] ).attr( 'data-plenty-checkout-id' ),\n                    index: current\n                };\n            }\n            else\n            {\n                return null;\n            }\n        }\n\n        /**\n         * Register an interceptor called before each tab change.\n         * Tabchange will break if any interceptor returns false.\n         * @param {function} interceptor The interceptor callback to register\n         * @chainable\n         * @returns {NavigatorService}\n         * @example\n         *      plenty.NavigatorService.beforeChange( function(targetContainer) {\n         *          if( targetContainer.id === 'details' ) {\n         *              // stop tabchange if user tries to access checkout container with id \"details\"\n         *              return false;\n         *          }\n         *          return true;\n         *      });\n         */\n        function beforeChange( interceptor )\n        {\n            interceptors.beforeChange.push( interceptor );\n            return pm.getInstance().NavigatorService;\n        }\n\n        /**\n         * Register an interceptor called after each tab change.\n         * @param {function} interceptor The interceptor callback to register\n         * @chainable\n         * @returns {NavigatorService}\n         */\n        function afterChange( interceptor )\n        {\n            interceptors.afterChange.push( interceptor );\n            return pm.getInstance().NavigatorService;\n        }\n\n        /**\n         * Call registered interceptors. Break if any interceptor returns false.\n         * Do not call beforeChange-interceptors on initially tabchange\n         * @function resolveInterceptors\n         * @private\n         * @param {\"beforeChange\"|\"afterChange\"} identifier Describe which interceptors should be called\n         * @param {number} index the index of the target container\n         * @returns {boolean} Conjunction of all interceptor return values\n         */\n        function resolveInterceptors( identifier, index )\n        {\n            var continueTabChange = true;\n\n            if ( current >= 0 || identifier === 'afterChange' )\n            {\n\n                var currentContainer = getCurrentContainer();\n                var targetContainer  = {\n                    index: index,\n                    id   : $( container[index] ).attr( 'data-plenty-checkout-id' )\n                };\n\n                $.each( interceptors[identifier], function( i, interceptor )\n                {\n                    if ( interceptor( currentContainer, targetContainer ) === false )\n                    {\n                        continueTabChange = false;\n                        return false;\n                    }\n                } );\n            }\n\n            return continueTabChange;\n        }\n\n        /**\n         * Show checkout tab given by index\n         * @function goTo\n         * @param {number} index Index of target tab, starting at 0\n         * @param {boolean} [ignoreInterceptors=false] Set true to not call registered interceptors and force changing\n         *     tab\n         */\n        function goTo( index, ignoreInterceptors )\n        {\n\n            var contentChanged = current !== index;\n\n            if ( contentChanged && !ignoreInterceptors )\n            {\n                if ( !resolveInterceptors( \"beforeChange\", index ) )\n                {\n                    return;\n                }\n            }\n\n            current = index;\n\n            if ( !Object.equals( checkoutStates[current], Checkout.getCheckout( true ) ) && contentChanged && !!$( container[current] ).attr( 'data-plenty-checkout-content' ) )\n            {\n                checkoutStates[current] = Checkout.getCheckout( true );\n                // reload tab content\n                CMS.getCategoryContent( $( container[current] ).attr( 'data-plenty-checkout-content' ) )\n                    .done( function( response )\n                    {\n                        $( container[current] ).html( response.data[0] );\n                        // continue tab change\n                        proceedTabChange( contentChanged );\n                        pm.getInstance().bindDirectives( container[current] );\n                        $( window ).trigger( 'contentChanged' );\n                    } );\n            }\n            else\n            {\n                // continue tab change without reloading tab content\n                proceedTabChange( contentChanged );\n                //pm.getInstance().bindDirectives();\n            }\n\n        }\n\n        function proceedTabChange( contentChanged )\n        {\n\n            // hide content containers\n            $( container ).hide();\n\n            // refresh navigation elements\n            var $elem;\n            $( navigation ).each( function( i, elem )\n            {\n                $elem = $( elem );\n                $elem.removeClass( 'disabled active' );\n\n                $elem.find( '[role=\"tab\"]' ).attr( 'aria-selected', 'false' );\n\n                if ( i < current )\n                {\n                    // set current element as active\n                    $elem.addClass( 'visited' );\n                }\n                else\n                {\n                    if ( i == current )\n                    {\n                        $elem.addClass( 'active visited' );\n                        $elem.find( '[role=\"tab\"]' ).attr( 'aria-selected', 'true' );\n                    }\n                    else\n                    {\n                        if ( i > current && !$elem.is( '.visited' ) )\n                        {\n                            // disable elements behind active\n                            $elem.addClass( 'disabled' );\n                        }\n                    }\n                }\n            } );\n            fillNavigation();\n\n            // hide \"previous\"-button if first content container is shown\n            if ( current <= 0 )\n            {\n                buttonPrev.attr( \"disabled\", \"disabled\" );\n            }\n            else\n            {\n                buttonPrev.removeAttr( \"disabled\" );\n            }\n\n            // hide \"next\"-button if last content container is shown\n            if ( current + 1 == navigation.length )\n            {\n                buttonNext.attr( \"disabled\", \"disabled\" );\n            }\n            else\n            {\n                buttonNext.removeAttr( \"disabled\" );\n            }\n\n            // show current content container\n            $( container[current] ).show();\n\n            // set location hash\n            if ( current > 0 )\n            {\n                window.location.hash = $( container[current] ).attr( 'data-plenty-checkout-id' );\n            }\n            else\n            {\n                if ( window.location.hash.length > 0 )\n                {\n                    window.location.hash = '';\n                }\n            }\n\n            if ( contentChanged )\n            {\n                resolveInterceptors( \"afterChange\", current );\n            }\n        }\n\n        /**\n         * Continue interrupted tabchange. Shorthand for: <code>goTo(targetContainer.index, true)</code>\n         * @function continueChange\n         * @param targetContainer The tab-object received from an interceptor\n         */\n        function continueChange( targetContainer )\n        {\n            goTo( targetContainer.index, true );\n        }\n\n        /**\n         * Show next checkout tab if available. Shorthand for\n         * <code>\n         *     if (current < navigation.length - 1) {\n         *        goTo(current + 1);\n         *     }\n         * </code>\n         * @function next\n         */\n        function next()\n        {\n            if ( current < navigation.length - 1 )\n            {\n                goTo( current + 1 );\n            }\n        }\n\n        /**\n         * Show previous checkout tab if available\n         * @function next\n         */\n        function previous()\n        {\n            if ( current > 0 )\n            {\n                goTo( current - 1 );\n            }\n        }\n\n        /**\n         * Show checkout tab given by ID\n         * @function goToID\n         * @param  {string} containerID ID of tab to show. Target tab must be marked with\n         *     <b>data-plenty-checkout-id=\"#...\"</b>\n         */\n        function goToID( containerID )\n        {\n            if ( containerID == 'next' )\n            {\n                next();\n                return true;\n            }\n            else if ( containerID == 'prev' )\n            {\n                previous();\n                return true;\n            }\n            else\n            {\n                containerID = containerID.replace( '#', '' );\n                $( container ).each( function( i, elem )\n                {\n                    if ( $( elem ).attr( 'data-plenty-checkout-id' ) == containerID )\n                    {\n                        goTo( i );\n                        return true;\n                    }\n                } );\n            }\n\n            return false;\n        }\n\n        /**\n         * Calculate navigation's width to match its parent element\n         * by increasing its items padding.\n         * @function fillNavigation\n         */\n        function fillNavigation()\n        {\n            // function not needed because of some nice css.\n            return;\n            // break if manager has not been initialized\n            var navigationCount = navigation.length;\n            if ( navigationCount <= 0 )\n            {\n                return;\n            }\n\n            // reset inline styles\n            $( navigation ).removeAttr( 'style' );\n            $( navigation ).children( 'span' ).removeAttr( 'style' );\n            $( buttonNext ).removeAttr( 'style' );\n            $( buttonPrev ).removeAttr( 'style' );\n\n            var buttonWidth = ($( buttonPrev ).outerWidth() < $( buttonNext ).outerWidth()) ? $( buttonNext ).outerWidth( true ) + 1 : $( buttonPrev ).outerWidth( true ) + 1;\n            $( buttonNext ).css( {width: buttonWidth + 'px'} );\n            $( buttonPrev ).css( {width: buttonWidth + 'px'} );\n\n            // calculate width to fill\n            var width = $( navigation ).parent().parent().outerWidth( true ) - ( 2 * buttonWidth);\n            width -= parseInt( $( navigation ).parent().css( 'marginLeft' ) ) + parseInt( $( navigation ).parent().css( 'marginRight' ) );\n\n            var padding  = width;\n            var tabWidth = [];\n\n            $( navigation ).each( function( i, elem )\n            {\n                padding -= parseInt( $( elem ).css( 'marginLeft' ) );\n                padding -= parseInt( $( elem ).css( 'marginRight' ) );\n\n                tabWidth[i] = $( elem ).children( 'span' ).width();\n                padding -= tabWidth[i];\n\n                padding -= parseInt( $( elem ).children( 'span' ).css( 'marginLeft' ) );\n                padding -= parseInt( $( elem ).children( 'span' ).css( 'marginRight' ) );\n            } );\n\n            var paddingEachItem = parseInt( padding / navigationCount );\n\n            var paddingLeft, paddingRight;\n            if ( paddingEachItem % 2 == 1 )\n            {\n                paddingLeft  = ( paddingEachItem / 2 ) + 0.5;\n                paddingRight = ( paddingEachItem / 2 ) - 0.5;\n            }\n            else\n            {\n                paddingLeft  = paddingEachItem / 2;\n                paddingRight = paddingEachItem / 2;\n            }\n\n            var paddingLastItem = parseInt( padding - ( ( navigationCount - 1 ) * ( paddingLeft + paddingRight ) ) );\n            var paddingLastLeft, paddingLastRight;\n            if ( paddingLastItem % 2 == 1 )\n            {\n                paddingLastLeft  = ( paddingLastItem / 2 ) + 0.5;\n                paddingLastRight = ( paddingLastItem / 2) - 0.5;\n            }\n            else\n            {\n                paddingLastLeft  = paddingLastItem / 2;\n                paddingLastRight = paddingLastItem / 2;\n            }\n\n            var diff = width;\n            $( navigation ).each( function( i, elem )\n            {\n                if ( i < navigationCount - 1 )\n                {\n                    $( elem ).children( 'span' ).css( {'paddingLeft': paddingLeft + 'px', 'paddingRight': paddingRight + 'px'} ); //.parent().css({ width: ( tabWidth[i] + paddingLeft + paddingRight + parseInt( $(elem).children('span').css('marginLeft') ) + parseInt( $(elem).children('span').css('marginRight') ) )+'px' });\n                }\n                else\n                {\n                    $( elem ).children( 'span' ).css( {'paddingLeft': paddingLastLeft + 'px', 'paddingRight': paddingLastRight + 'px'} ); //.parent().css({ width: ( tabWidth[i] + paddingLastLeft + paddingLastRight + parseInt( $(elem).children('span').css('marginLeft') ) + parseInt( $(elem).children('span').css('marginRight') ) )+'px' });\n                }\n            } );\n\n            //$(navigation).parent().css('marginRight', 0);\n        }\n\n    }, ['CMSFactory', 'CheckoutFactory'] );\n\n}( jQuery, PlentyFramework ));\n\n/**\n * Licensed under AGPL v3\n * (https://github.com/plentymarkets/plenty-cms-library/blob/master/LICENSE)\n * =====================================================================================\n * @copyright   Copyright (c) 2015, plentymarkets GmbH (http://www.plentymarkets.com)\n * @author      Magnus Martin <magnus.martin@plentymarkets.com>\n * =====================================================================================\n */\n\n\n(function( $, pm )\n{\n    pm.service( 'PostfinderService', function( API, Modal, UIFactory )\n    {\n        var packstationID   = '';\n        var shippingFields  = {};\n        var numberOfResults = {};\n        var result          = {};\n\n        return {\n            openPostfinderModal: openPostfinderModal,\n            isPackstation      : isPackstation\n        };\n\n        function isPackstation()\n        {\n            var street = $( 'input[name=\"Street\"]' ).val();\n            return ( street.toUpperCase() == \"PACKSTATION\" || street.toUpperCase() == \"POSTFILIALE\" );\n        }\n\n        function openPostfinderModal()\n        {\n            shippingFields = {\n                PostfinderItemStreet : $( 'input[name=\"Street\"]', '[data-plenty-checkout-form=\"shippingAddress\"]' ),\n                PostfinderItemZIP    : $( 'input[name=\"ZIP\"]', '[data-plenty-checkout-form=\"shippingAddress\"]' ),\n                PostfinderItemCity   : $( 'input[name=\"City\"]', '[data-plenty-checkout-form=\"shippingAddress\"]' ),\n                PostfinderItemHouseNo: $( 'input[name=\"HouseNo\"]', '[data-plenty-checkout-form=\"shippingAddress\"]' )\n\n            };\n\n            shippingFields.PostfinderItemStreet.val( '' );\n\n            if ( (shippingFields.PostfinderItemZIP.val().length > 2 || shippingFields.PostfinderItemCity.val().length > 2) )\n            {\n\n                API.get( '/rest/checkout/shippingaddresspostfinderlist/',\n                    {\n                        suggestionType: \"postfinder\",\n                        zip           : shippingFields.PostfinderItemZIP.val(),\n                        city          : shippingFields.PostfinderItemCity.val()\n                    } )\n\n                    .done( function( response )\n                    {\n                        result          = response.data;\n                        numberOfResults = result.length;\n\n                        if ( numberOfResults == 0 )\n                        {\n                            showErrorMessage();\n                        }\n\n                        var params = {\n                            addresses: []\n                        };\n\n                        for ( var i = 0; i < numberOfResults; i++ )\n                        {\n                            var dimension        = 'km';\n                            var distInMeters     = result[i].PostfinderItemDistance;\n                            var distInKilometers = distInMeters / 1000;\n                            distInKilometers     = ((Math.round( distInKilometers * 100 ) / 100).toFixed( 2 )).replace( '.', ',' );\n\n                            if ( distInMeters < 1000 )\n                            {\n                                distInKilometers = distInMeters;\n                                dimension        = 'm';\n                            }\n\n                            params.addresses.push( {\n                                index    : i,\n                                dimension: dimension,\n                                type     : result[i].PostfinderItemIsPackstation ? 'Packstation' : 'Postfiliale',\n                                number   : result[i].PostfinderItemIsPackstation ? result[i].PostfinderItemPackstationNo : result[i].PostfinderItemPostfilialNo,\n                                street   : result[i].PostfinderItemStreet,\n                                houseNo  : result[i].PostfinderItemHouseNo,\n                                zip      : result[i].PostfinderItemZIP,\n                                city     : result[i].PostfinderItemCity,\n                                district : result[i].PostfinderItemDistrict,\n                                distance : distInKilometers,\n                                remark   : result[i].PostfinderItemRemark\n                            } );\n                        }\n\n                        var html = pm.compileTemplate( 'addressSuggestions/postFinder.html', params );\n\n                        Modal.prepare()\n                            .setTitle( pm.translate( 'Packstations and post offices in your area' ) )\n                            .setContent( html )\n                            .setClass( 'checkout' )\n                            .onConfirm( function()\n                            {\n                                shippingFields.PostfinderItemCity.removeClass( 'error' ).addClass( 'success' );\n                                $( 'label[for=\"' + shippingFields.PostfinderItemCity.attr( 'id' ) + '\"]' ).removeClass( 'error' ).addClass( 'success' );\n\n                                shippingFields.PostfinderItemZIP.removeClass( 'error' ).addClass( 'success' );\n                                $( 'label[for=\"' + shippingFields.PostfinderItemZIP.attr( 'id' ) + '\"]' ).removeClass( 'error' ).addClass( 'success' );\n\n                                shippingFields.PostfinderItemStreet.removeClass( 'error' ).addClass( 'success' );\n                                $( 'label[for=\"' + shippingFields.PostfinderItemStreet.attr( 'id' ) + '\"]' ).removeClass( 'error' ).addClass( 'success' );\n\n                                shippingFields.PostfinderItemHouseNo.removeClass( 'error' ).addClass( 'success' );\n                                $( 'label[for=\"' + shippingFields.PostfinderItemHouseNo.attr( 'id' ) + '\"]' ).removeClass( 'error' ).addClass( 'success' );\n\n                                packstationID = $( 'input[type=\"radio\"][name=\"postfinder\"]:checked' ).val();\n\n                                if ( result[packstationID].PostfinderItemIsPackstation )\n                                {\n                                    $( shippingFields.PostfinderItemStreet ).val( 'PACKSTATION' );\n                                    $( shippingFields.PostfinderItemHouseNo ).val( result[packstationID].PostfinderItemPackstationNo );\n                                }\n                                else\n                                {\n                                    $( shippingFields.PostfinderItemStreet ).val( 'POSTFILIALE' );\n                                    $( shippingFields.PostfinderItemHouseNo ).val( result[packstationID].PostfinderItemPostfilialNo );\n                                }\n                                $( shippingFields.PostfinderItemStreet ).trigger( 'change' );\n\n                                $( shippingFields.PostfinderItemCity ).val( result[packstationID].PostfinderItemCity );\n                                $( shippingFields.PostfinderItemZIP ).val( result[packstationID].PostfinderItemZIP );\n                                $( '#shippingAdressSelect' ).foundation('reveal','open');\n                                return true;\n                            } )\n                            .show()\n                    } );\n            }\n            else\n            {\n                showErrorMessage();\n            }\n\n        }\n\n        function showErrorMessage()\n        {\n            UIFactory.throwError( 0, pm.translate( 'Please enter a ZIP code and/or a city.' ) );\n\n            shippingFields.PostfinderItemCity.removeClass( 'success' ).addClass( 'error' );\n            $( 'label[for=\"' + shippingFields.PostfinderItemCity.attr( 'id' ) + '\"]' ).removeClass( 'success' ).addClass( 'error' );\n\n            shippingFields.PostfinderItemZIP.removeClass( 'success' ).addClass( 'error' );\n            $( 'label[for=\"' + shippingFields.PostfinderItemZIP.attr( 'id' ) + '\"]' ).removeClass( 'success' ).addClass( 'error' );\n\n            shippingFields.PostfinderItemCity.focus( function()\n            {\n                $( this ).removeClass( 'error' );\n                var inputId = $( this ).attr( 'id' );\n                $( this ).closest( '.form-group' ).find( '[for=\"' + inputId + '\"]' ).removeClass( 'error' );\n            } );\n\n            shippingFields.PostfinderItemZIP.focus( function()\n            {\n                $( this ).removeClass( 'error' );\n                var inputId = $( this ).attr( 'id' );\n                $( this ).closest( '.form-group' ).find( '[for=\"' + inputId + '\"]' ).removeClass( 'error' );\n            } );\n        }\n    }, ['APIFactory', 'ModalFactory', 'UIFactory'] );\n\n}( jQuery, PlentyFramework ));\n\n/**\n * Licensed under AGPL v3\n * (https://github.com/plentymarkets/plenty-cms-library/blob/master/LICENSE)\n * =====================================================================================\n * @copyright   Copyright (c) 2015, plentymarkets GmbH (http://www.plentymarkets.com)\n * @author      Felix Dausch <felix.dausch@plentymarkets.com>\n * =====================================================================================\n */\n\n/**\n * @module Services\n */\n(function( $, pm )\n{\n\n    /**\n     * Provide templates for social share providers to inject them dynamically.\n     * @class SocialShareService\n     * @static\n     */\n    pm.service( 'SocialShareService', function()\n    {\n\n        //TODO: move to global variables\n        if ( typeof(socialLangLocale) == 'undefined' )\n        {\n            socialLangLocale = 'en_US';\n        }\n        if ( typeof(socialLang) == 'undefined' )\n        {\n            socialLang = 'en';\n        }\n\n        return {\n            getSocialService: getService\n        };\n\n        /**\n         * Get the template for social media provider\n         * @function getService\n         * @param {string} identifier name of the social media provider to get the template for\n         * @returns {string} the template to inject in DOM\n         */\n        function getService( identifier )\n        {\n            var services = {\n                'facebook-like': '<iframe src=\"//www.facebook.com/plugins/like.php'\n                + '?locale=' + socialLangLocale\n                + '&amp;href=' + encodeURIComponent( getURI() )\n                + '&amp;width=130'\n                + '&amp;layout=button_count'\n                + '&amp;action=like'\n                + '&amp;show_faces=false'\n                + '&amp;share=false'\n                + '&amp;height=21'\n                + '&amp;colorscheme=light\" scrolling=\"no\" frameborder=\"0\" style=\"border:none; overflow:hidden; width:130px; height:21px;\" allowTransparency=\"true\"></iframe>',\n\n                'facebook-recommend': '<iframe src=\"//www.facebook.com/plugins/like.php'\n                + '?locale=' + socialLangLocale\n                + '&amp;href=' + encodeURIComponent( getURI() )\n                + '&amp;width=130'\n                + '&amp;layout=button_count'\n                + '&amp;action=recommend'\n                + '&amp;show_faces=false'\n                + '&amp;share=false'\n                + '&amp;height=21'\n                + '&amp;colorscheme=light\" scrolling=\"no\" frameborder=\"0\" style=\"border:none; overflow:hidden; width:130px; height:21px;\" allowTransparency=\"true\"></iframe>',\n\n                'twitter': '<iframe src=\"//platform.twitter.com/widgets/tweet_button.html'\n                + '?url=' + encodeURIComponent( getURI() )\n                + '&amp;text=' + getTweetText()\n                + '&amp;count=horizontal'\n                + '&amp;dnt=true\" allowtransparency=\"true\" frameborder=\"0\" scrolling=\"no\"  style=\"width:130px; height:21px;\"></iframe>',\n\n                'google-plus': '<div '\n                + 'class=\"g-plusone\" '\n                + 'data-size=\"medium\" '\n                + 'data-href=\"' + getURI() + '\"></div>'\n                + '<script type=\"text/javascript\">window.___gcfg = {lang: \"' + socialLang + '\"}; (function() { var po = document.createElement(\"script\"); po.type = \"text/javascript\"; po.async = true; po.src = \"https://apis.google.com/js/platform.js\"; var s = document.getElementsByTagName(\"script\")[0]; s.parentNode.insertBefore(po, s); })(); </script>',\n            };\n\n            return services[identifier];\n        }\n\n        /**\n         * get the canonical URL if defined\n         * @function getURL\n         * @private\n         * @return {string} The Canonical URL if defined or the current URI\n         */\n        function getURI()\n        {\n            var uri       = document.location.href;\n            var canonical = $( \"link[rel=canonical]\" ).attr( \"href\" );\n\n            if ( canonical && canonical.length > 0 )\n            {\n                if ( canonical.indexOf( \"http\" ) < 0 )\n                {\n                    canonical = document.location.protocol + \"//\" + document.location.host + canonical;\n                }\n                uri = canonical;\n            }\n\n            return uri;\n        }\n\n        /**\n         * returns content of &lt;meta name=\"\" content=\"\"> tags or '' if empty/non existant\n         * @function getMeta\n         * @private\n         * @param {string} name The meta name to get the value of;\n         */\n        function getMeta( name )\n        {\n            var metaContent = $( 'meta[name=\"' + name + '\"]' ).attr( 'content' );\n            return metaContent || '';\n        }\n\n        /**\n         * create tweet text from content of &lt;meta name=\"DC.title\"> and &lt;meta name=\"DC.creator\">\n         * fallback to content of &lt;title> tag\n         * @function getTweetText\n         * @private\n         */\n        function getTweetText()\n        {\n            var title   = getMeta( 'DC.title' );\n            var creator = getMeta( 'DC.creator' );\n\n            if ( title.length > 0 && creator.length > 0 )\n            {\n                title += ' - ' + creator;\n            }\n            else\n            {\n                title = $( 'title' ).text();\n            }\n\n            return encodeURIComponent( title );\n        }\n\n    } );\n\n}( jQuery, PlentyFramework ));\n/**\n * Licensed under AGPL v3\n * (https://github.com/plentymarkets/plenty-cms-library/blob/master/LICENSE)\n * =====================================================================================\n * @copyright   Copyright (c) 2015, plentymarkets GmbH (http://www.plentymarkets.com)\n * @author      Felix Dausch <felix.dausch@plentymarkets.com>\n * =====================================================================================\n */\n\n/**\n * @module Services\n */\n(function( $, pm )\n{\n\n    /**\n     * Provide methods for client-side form validation.\n     * @class ValidationService\n     * @static\n     */\n    pm.service( 'ValidationService', function()\n    {\n\n        return {\n            validate: validate\n        };\n\n        /**\n         * Check if element is a form element (input, select, textarea) or search for child form elements\n         * @function getFormControl\n         * @private\n         * @param  {object} element the element to get the form element from\n         * @return {object} a valid form element (input, select, textarea)\n         */\n        function getFormControl( element )\n        {\n            element = $( element );\n            if ( element.is( 'input' ) || element.is( 'select' ) || element.is( 'textarea' ) )\n            {\n                return element;\n            }\n            else\n            {\n                if ( element.find( 'input' ).length > 0 )\n                {\n                    return element.find( 'input' );\n                }\n\n                else if ( element.find( 'select' ).length > 0 )\n                {\n                    return element.find( 'select' );\n                }\n\n                else if ( element.find( 'textarea' ).length > 0 )\n                {\n                    return element.find( 'textarea' );\n                }\n\n                else\n                {\n                    return null;\n                }\n            }\n\n        }\n\n        /**\n         * Check given element has any value\n         * @function validateText\n         * @private\n         * @param {object} formControl the form element to validate\n         * @return {boolean}\n         */\n        function validateText( formControl )\n        {\n            // check if formControl is no checkbox or radio\n            if ( formControl.is( 'input' ) || formControl.is( 'select' ) || formControl.is( 'textarea' ) )\n            {\n                // check if length of trimmed value is greater then zero\n                return $.trim( formControl.val() ).length > 0;\n\n            }\n            else\n            {\n                console.error( 'Validation Error: Cannot validate Text for <' + formControl.prop( \"tagName\" ) + '>' );\n                return false;\n            }\n        }\n\n        /**\n         * Check given element's value is a valid email-address\n         * @function validateMail\n         * @private\n         * @param {object} formControl the form element to validate\n         * @return {boolean}\n         */\n        function validateMail( formControl )\n        {\n            var mailRegExp = /[a-zA-Z0-9!#$%&'*+\\/=?^_`{|}~-]+(?:\\.[a-zA-Z0-9!#$%&'*+\\/=?^_`{|}~-]+)*@(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?\\.)+[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?/;\n            if ( validateText( formControl ) )\n            {\n                return mailRegExp.test( $.trim( formControl.val() ) );\n            }\n            else\n            {\n                return false;\n            }\n        }\n\n        /**\n         * Check given element's value is a valid number\n         * @function validateNumber\n         * @private\n         * @param {object} formControl the form element to validate\n         * @return {boolean}\n         */\n        function validateNumber( formControl )\n        {\n            if ( validateText( formControl ) )\n            {\n                return $.isNumeric( $.trim( formControl.val() ) );\n            }\n            else\n            {\n                return false;\n            }\n        }\n\n        /**\n         * Check given element's value is equal to a references value\n         * @function compareValues\n         * @private\n         * @param {object} formControl the form element to validate\n         * @param {string} reference the required value\n         * @param {boolean} caseSensitive direct compare, without convert to lowerCase\n         * @return {boolean}\n         */\n        function compareValues( formControl, reference, caseSensitive )\n        {\n            formControl = $.trim( formControl.val() );\n            reference   = $.trim(\n                $( reference ).length > 0\n                    ? $( reference ).val()\n                    : reference );\n\n            if ( caseSensitive )\n            {\n                return formControl == reference;\n            }\n            return formControl.toLowerCase() == reference.toLowerCase();\n        }\n\n        function isNotVisibleOrEnabled( formControl )\n        {\n            return (!formControl.is( ':visible' ) || !formControl.is( ':enabled' ));\n        }\n\n        /**\n         * Validate a form. Triggers event 'validationFailed' if any element has an invalid value\n         * @function validate\n         * @param   {object}    form The form element to validate\n         * @returns {boolean}\n         * @example\n         *  ```html\n         *      <!-- add \"error-class\" to invalid elements -->\n         *      <form data-plenty-checkform=\"error-class\">\n         *          <!-- check if value is \"text\" -->\n         *          <input type=\"text\" data-plenty-validate=\"text\">\n         *\n         *          <!-- check if value is a valid email-address -->\n         *          <input type=\"text\" data-plenty-validate=\"mail\">\n         *\n         *          <!-- check if value is a valid number -->\n         *          <input type=\"text\" data-plenty-validate=\"number\">\n         *\n         *          <!-- check if value is \"foo\" -->\n         *          <input type=\"text\" data-plenty-validate=\"value\" data-plenty-validation-value=\"foo\">\n         *\n         *          <!-- check if values are identical -->\n         *          <input type=\"text\" id=\"input1\">\n         *          <input type=\"text\" data-plenty-validate=\"value\" data-plenty-validation-value=\"#input1\">\n         *\n         *          <!-- validate radio buttons -->\n         *          <input type=\"radio\" name=\"radioGroup\" data-plenty-validate>\n         *          <input type=\"radio\" name=\"radioGroup\" data-plenty-validate>\n         *          <input type=\"radio\" name=\"radioGroup\" data-plenty-validate>\n         *\n         *          <!-- validate checkboxes -->\n         *          <input type=\"checkbox\" name=\"checkboxGroup\" data-plenty-validate=\"{min: 1, max: 2}\">\n         *          <input type=\"checkbox\" name=\"checkboxGroup\" data-plenty-validate=\"{min: 1, max: 2}\">\n         *          <input type=\"checkbox\" name=\"checkboxGroup\" data-plenty-validate=\"{min: 1, max: 2}\">\n         *\n         *          <!-- add error class to parent container -->\n         *          <div data-plenty-validate=\"text\">\n         *              <label>An Input</label>\n         *              <input type=\"text\">\n         *          </div>\n         *\n         *       </form>\n         *    ```\n         *\n         * @example\n         *      $(form).on('validationFailed', function(missingFields) {\n         *          // handle missing fields\n         *      });\n         */\n        function validate( form, errorClass )\n        {\n            var $formControl, formControls, validationKey, currentHasError, group, checked, checkedMin, checkedMax, attrValidate, validationKeys, formControlAttrType;\n            var $form         = $( form );\n            errorClass        = errorClass || 'error';\n            var missingFields = [];\n            var hasError      = false;\n\n            // check every required input inside form\n            $form.find( '[data-plenty-validate], :required' ).each( function( i, elem )\n            {\n                attrValidate   = $( elem ).attr( 'data-plenty-validate' );\n                formControls   = getFormControl( elem );\n                // validate text inputs\n                validationKeys = !!attrValidate ? attrValidate : 'text';\n                validationKeys = validationKeys.split( ',' );\n\n                for ( var i = 0, length = formControls.length; i < length; i++ )\n                {\n                    $formControl        = $( formControls[i] );\n                    formControlAttrType = $formControl.attr( 'type' );\n\n                    // skip validation, if input is invisible or disabled\n                    if ( isNotVisibleOrEnabled( $formControl ) )\n                    {\n                        return;\n                    }\n\n                    validationKey   = validationKeys[i].trim() || validationKeys[0].trim();\n                    currentHasError = false;\n\n                    // formControl is textfield (text, mail, password) or textarea\n                    if ( ($formControl.is( 'input' )\n                        && formControlAttrType != 'radio'\n                        && formControlAttrType != 'checkbox')\n                        || $formControl.is( 'textarea' ) )\n                    {\n                        switch ( validationKey )\n                        {\n\n                            case 'text':\n                                currentHasError = !validateText( $formControl );\n                                break;\n\n                            case 'mail':\n                                currentHasError = !validateMail( $formControl );\n                                break;\n\n                            case 'number':\n                                currentHasError = !validateNumber( $formControl );\n                                break;\n\n                            case 'value':\n                                currentHasError = !compareValues( $formControl, $( elem ).attr( 'data-plenty-validation-value' ), ($formControl.context.type === \"password\") );\n                                break;\n\n                            case 'none':\n                                // do not validate\n                                break;\n\n                            default:\n                                console.error( 'Form validation error: unknown validate property: \"' + attrValidate + '\"' );\n                                break;\n                        }\n                    }\n                    else if ( $formControl.is( 'input' )\n                        && (formControlAttrType == 'radio'\n                        || formControlAttrType == 'checkbox') )\n                    {\n                        // validate radio buttons\n                        group   = $formControl.attr( 'name' );\n                        checked = $form.find( 'input[name=\"' + group + '\"]:checked' ).length;\n\n                        if ( formControlAttrType == 'radio' )\n                        {\n                            checkedMin = 1;\n                            checkedMax = 1;\n                        }\n                        else\n                        {\n                            var minMax = (new Function( \"return \" + attrValidate ))() || {min: 1, max: 1};\n                            checkedMin = minMax.min;\n                            checkedMax = minMax.max;\n                        }\n\n                        currentHasError = ( checked < checkedMin || checked > checkedMax );\n\n                    }\n                    else if ( $formControl.is( 'select' ) )\n                    {\n                        // validate selects\n                        currentHasError = ( $formControl.val() == '' || $formControl.val() == '-1' );\n                    }\n                    else\n                    {\n                        console.error( 'Form validation error: ' + $( elem ).prop( \"tagName\" ) + ' does not contain an form element' );\n                        return;\n                    }\n\n                    if ( currentHasError )\n                    {\n                        hasError = true;\n                        missingFields.push( $formControl );\n\n                        if ( formControls.length > 1 )\n                        {\n                            $formControl.addClass( errorClass );\n                            $form.find( 'label[for=\"' + $formControl.attr( 'id' ) + '\"]' ).addClass( errorClass );\n                        }\n                        else\n                        {\n                            $( elem ).addClass( errorClass );\n                        }\n                    }\n                }\n\n            } );\n\n            // scroll to element on 'validationFailed'\n            $form.on( 'validationFailed', function()\n            {\n                var distanceTop   = 50;\n                var $error        = $form.find( '.' + errorClass ).first();\n                var errorOffset   = $error.offset().top;\n                var $scrollTarget = $( 'html, body' );\n\n                // if form is inside of modal, scroll modal instead of body\n                if ( $form.parents( '.modal' ).length > 0 )\n                {\n                    $scrollTarget = $form.parents( '.modal' ).find( '.modal-body' );\n                    errorOffset   = $scrollTarget.scrollTop() - ( $scrollTarget.offset().top - $error.offset().top );\n\n                }\n                else if ( $form.is( '.modal' ) )\n                {\n                    $scrollTarget = $form.find( '.modal-body' );\n                    errorOffset   = $scrollTarget.scrollTop() - ( $scrollTarget.offset().top - $error.offset().top );\n                }\n\n                // only scroll if error is outside of viewport\n                if ( errorOffset - distanceTop < window.pageYOffset || errorOffset > (window.pageYOffset + window.innerHeight) )\n                {\n                    $scrollTarget.animate( {\n                        scrollTop: errorOffset - distanceTop\n                    } );\n                }\n            } );\n\n            if ( hasError )\n            {\n                // remove error class on focus\n                $form.find( '.' + errorClass ).each( function( i, elem )\n                {\n                    $formControl = $( getFormControl( elem ) );\n                    $formControl.on( 'focus click', function()\n                    {\n\t\t\t\t\t\t//formControl.removeClass( errorClass );\n                        var $errorElement = $( elem );\n                        $errorElement.removeClass( errorClass );\n                        $form.find( 'label[for=\"' + $( this ).attr( 'id' ) + '\"]' ).removeClass( errorClass );\n                    } );\n                } );\n\n                $form.trigger( 'validationFailed', [missingFields] );\n            }\n\n            var callback = $form.attr( 'data-plenty-callback' );\n\n            if ( !hasError && !!callback && callback != \"submit\" && typeof window[callback] == \"function\" )\n            {\n\n                var fields = {};\n                $form.find( 'input, textarea, select' ).each( function()\n                {\n                    if ( $( this ).attr( 'type' ) == 'checkbox' )\n                    {\n                        fields[$( this ).attr( 'name' )] = $( this ).is( ':checked' );\n                    }\n                    else\n                    {\n                        fields[$( this ).attr( 'name' )] = $( this ).val();\n                    }\n                } );\n\n                window[callback]( fields );\n                return false;\n            }\n            else\n            {\n                return !hasError;\n            }\n        }\n    } );\n\n    /**\n     * jQuery-Plugin to calling {{#crossLink \"ValidationService/validate\"}}ValidationService.validate{{/crossLink}}\n     * on jQuery wrapped elements.\n     * @return {boolean}\n     */\n    $.fn.validateForm = function()\n    {\n        return pm.getInstance().ValidationService.validate( this );\n    };\n\n    /**\n     * jQuery-Plugin to get the values of contained form elements.\n     * @return {object}\n     */\n    $.fn.getFormValues = function()\n    {\n\n        var form   = this;\n        var values = {};\n\n        function inject( position, value )\n        {\n            var match = position.match( /^([^\\[]+)(.*)/ );\n\n            if ( !!match[2] )\n            {\n                var exp      = /\\[([^\\]]+)]/g;\n                var child;\n                var children = [];\n                children[0]  = match[1];\n                while ( (child = exp.exec( match[2] )) !== null )\n                {\n                    children.push( child[1] );\n                }\n\n                for ( var i = children.length - 1; i >= 0; i-- )\n                {\n                    var val          = {};\n                    val[children[i]] = value;\n                    value            = val;\n                }\n                values = $.extend( true, values, value );\n            }\n            else\n            {\n                values[match[1]] = value;\n            }\n        }\n\n        form.find( 'input, select, textarea' ).each( function( i, elem )\n        {\n            if ( !!$( elem ).attr( 'name' ) )\n            {\n                if ( $( elem ).attr( 'type' ) == \"checkbox\" )\n                {\n                    // get checkbox group\n                    var groupValues = [];\n                    $( form ).find( '[name=\"' + $( elem ).attr( 'name' ) + '\"]:checked' ).each( function( j, checkbox )\n                    {\n                        groupValues.push( $( checkbox ).val() );\n                    } );\n                    inject( $( elem ).attr( 'name' ), groupValues );\n                }\n                else if ( $( elem ).attr( 'type' ) == 'radio' )\n                {\n                    if ( $( elem ).is( ':checked' ) )\n                    {\n                        inject( $( elem ).attr( 'name' ), $( elem ).val() );\n                    }\n                }\n                else\n                {\n                    inject( $( elem ).attr( 'name' ), $( elem ).val() );\n                }\n            }\n\n        } );\n        return values;\n    }\n}( jQuery, PlentyFramework ));\n\n/**\n * Services provide functions to be called from the instanced PlentyFramework.<br>\n * Services can inject Factories and can be injected into Directives. The are also\n * available from the global instance of PlentyFramework\n * @module Services\n * @main Services\n * @example\n *      PlentyFramework.service('ServiceName', serviceFunctions() {\n *          return {\n *              functionInService: function() {}\n *           }\n *      });\n *      //...\n *      plenty.ServiceName.functionInService/();\n */\n/**\n * Licensed under AGPL v3\n * (https://github.com/plentymarkets/plenty-cms-library/blob/master/LICENSE)\n * =====================================================================================\n * @copyright   Copyright (c) 2015, plentymarkets GmbH (http://www.plentymarkets.com)\n * @author      Felix Dausch <felix.dausch@plentymarkets.com>\n * =====================================================================================\n */\n\nPlentyFramework.compile();\n\n// Create global instance of PlentyFramework for usage in Webshop-Layouts\nvar plenty = PlentyFramework.getInstance();\n\n/*\n * initially bind all registered directives\n *\n * will not be tested. reasons:\n * http://stackoverflow.com/questions/29153733/how-to-unit-test-a-document-ready-function-using-jasmine\n */\njQuery( document ).ready( function()\n{\n    plenty.bindDirectives();\n} );"]}